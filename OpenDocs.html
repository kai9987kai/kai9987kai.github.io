<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuraWord – AI-Powered Web Word Processor (2025)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css"/>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            background-color: #f4f7f9;
            color: #333;
        }
        .ribbon {
            background-color: #fff;
            border-bottom: 1px solid #e0e0e0;
            padding: 10px 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .tabs {
            display: flex;
            gap: 5px;
        }
        .tab-button {
            padding: 8px 15px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-bottom: none;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        .tab-button:hover {
            background-color: #e0e0e0;
        }
        .tab-button.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
        }
        .tab-content {
            display: none;
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 5px 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .group {
            display: inline-block;
            vertical-align: top;
            margin-right: 15px;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .group h3 {
            margin: 0 0 8px;
            font-size: 0.85em;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .group button, .group select, .group input {
            margin: 3px;
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
            cursor: pointer;
            background-color: #fff;
            font-size: 0.9em;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .group button:hover, .group select:hover, .group input:hover {
            background-color: #f0f0f0;
            border-color: #b0b0b0;
        }
        .group button.active-format {
            background-color: #e0e0e0;
        }
        .group input[type="number"] {
            width: 40px;
        }
        .document {
            margin: 20px;
            padding: 20px;
            background-color: white;
            min-height: 500px;
            border: 1px solid #ccc;
            box-shadow: 0 0 10px rgba(0,0,0,0.08);
            outline: none;
            border-radius: 5px;
            font-size: 16px;
            line-height: 1.6;
        }
        .right-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .color-picker-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .color-picker-label {
            font-size: 0.9em;
            color: #555;
        }
        .color-picker {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border: 1px solid #ccc;
            border-radius: 3px;
            background-color: #fff;
            cursor: pointer;
            padding: 0;
        }
        .color-picker::-webkit-color-swatch-wrapper {
            padding: 2px;
        } 
        .color-picker::-webkit-color-swatch {
            border: none;
            border-radius: 2px;
        } 
        .color-picker::-moz-color-swatch-wrapper {
            padding: 2px;
        } 
        .color-picker::-moz-color-swatch {
            border: none;
            border-radius: 2px;
        }
        .group button.list-button {
            width: 30px;
            text-align: center;
        }
        .group button.indent-button {
            width: 30px;
            text-align: center;
        }
        .group button#clearFormatting {
            font-size: 0.8em;
        }
        /* --- NEW CSS for Advanced Features --- */ 
        #view-tab-content { /* Specific ID for View Tab Content */ 
            display: none;
        }
        #review-tab-content { /* Specific ID for Review Tab Content */ 
            display: none;
        }
        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .zoom-controls button {
            padding: 5px 10px;
            font-size: 0.9em;
        }
        #zoom-level {
            font-size: 0.9em;
            width: 40px;
            text-align: center;
            border: none;
            background-color: transparent;
        }
        .find-replace-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .find-replace-group input {
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .find-replace-group button {
            padding: 6px 10px;
        }
        .styles-dropdown-group {
            position: relative; /* For dropdown positioning */ 
            display: inline-block;
        }
        .styles-dropdown-button {
            padding: 6px 10px;
        }
        .styles-dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border: 1px solid #ccc;
            border-radius: 3px;
            padding: 5px 0;
        }
        .styles-dropdown-content button {
            display: block;
            width: 100%;
            padding: 8px 16px;
            text-align: left;
            border: none;
            background-color: transparent;
            cursor: pointer;
        }
        .styles-dropdown-content button:hover {
            background-color: #e0e0e0;
        }
        .styles-dropdown-group:hover .styles-dropdown-content {
            display: block;
        }
        .template-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Responsive template grid */ 
            gap: 15px;
            padding: 10px;
        }
        .template-preview {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            background-color: #fff;
            transition: transform 0.2s;
        }
        .template-preview:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        } 
        .template-preview h4 {
            margin-top: 0;
            font-size: 1em;
        }
        /* Track Changes Styling */ 
        .track-changes-highlight {
            background-color: rgba(255, 200, 200, 0.5); /* Light red for deletions */ 
            text-decoration: line-through;
        } 
        .track-changes-insertion {
            background-color: rgba(200, 255, 200, 0.5); /* Light green for insertions */ 
        } 
        .comment-bubble {
            display: inline-block;
            background-color: #ffeb3b; /* Yellow comment bubble */ 
            border-radius: 50%;
            width: 15px;
            height: 15px;
            text-align: center;
            line-height: 15px;
            font-size: 0.8em;
            color: #333;
            cursor: pointer;
            margin-left: 3px;
        }
        /* --- NEW CSS for Advanced Find & Replace --- */ 
        .find-replace-group.advanced {
            flex-direction: row; /* Arrange inputs and button horizontally */ 
            align-items: center; /* Vertically align items */ 
        }
        .find-replace-group.advanced input {
            margin-right: 5px; /* Add some spacing between inputs */ 
        }
        .find-options {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
        .find-options label {
            font-size: 0.85em;
            color: #555;
            display: flex;
            align-items: center;
            gap: 3px;
        }
        /* --- New Styles for AI Features --- */ 
        .ai-suggestion-popup {
            position: absolute;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            padding: 10px;
            z-index: 2;
            display: none; /* Hidden by default */ 
        }
        .ai-suggestion-popup button {
            display: block;
            width: 100%;
            padding: 8px 10px;
            text-align: left;
            border: none;
            background-color: transparent;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .ai-suggestion-popup button:hover {
            background-color: #e0e0e0;
        }
        .smart-compose-highlight {
            background-color: rgba(220, 240, 255, 0.7); /* Light blue highlight for smart compose suggestions */ 
        }
        /* Styles for Collaboration Features */ 
        .collaborator-cursor {
            position: absolute;
            height: 1.2em; /* Adjust to match line height */ 
            width: 2px;
            background-color: blue; /* Example cursor color */ 
            pointer-events: none; /* Prevent interfering with text selection */ 
        } 
        .collaborator-name-tag {
            position: absolute;
            top: -1.5em; /* Position above the cursor */ 
            background-color: blue; /* Match cursor color */ 
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 0.8em;
            pointer-events: none;
        }
        :root {
            --primary: #2563eb;
            --text: #1f2937;
            --bg: #f8fafc;
            --ribbon: #ffffff;
            --border: #e2e8f0;
        }
        body.dark { --text:#e2e8f0; --bg:#0f172a; --ribbon:#1e293b; --border:#334155; background:#0f172a; color:#e2e8f0; }
        body { margin:0; font-family:'Segoe UI',sans-serif; background:var(--bg); color:var(--text); transition:all .3s; overflow-x:hidden; }
        .ribbon { background:var(--ribbon); border-bottom:1px solid var(--border); padding:8px 15px; box-shadow:0 2px 10px rgba(0,0,0,.1); display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px; position:sticky; top:0; z-index:1000; }
        .quick-access { display:flex; gap:8px; align-items:center; }
        .quick-access button { background:transparent; border:none; font-size:1.4em; cursor:pointer; padding:6px; border-radius:4px; }
        .quick-access button:hover { background:rgba(0,0,0,.05); }
        body.dark .quick-access button:hover { background:rgba(255,255,255,.1); }

        .tabs { display:flex; gap:4px; flex-wrap:wrap; }
        .tab-button { padding:8px 16px; background:#f1f5f9; border-radius:6px 6px 0 0; cursor:pointer; font-weight:600; transition:.2s; }
        .tab-button.active { background:#fff; border-bottom:2px solid var(--primary); }
        body.dark .tab-button { background:#334155; }
        body.dark .tab-button.active { background:#1e293b; }

        .document-container { position:relative; margin:20px; background:white; box-shadow:0 10px 30px rgba(0,0,0,.1); border-radius:8px; overflow:hidden; }
        body.dark .document-container { background:#1e293b; }
        #pageCanvas { width:100%; min-height:1056px; background:white; padding:70px 80px; box-sizing:border-box; position:relative; page-break-after:always; }
        body.dark #pageCanvas { background:#1e293b; color:#e2e8f0; }
        .page-header, .page-footer { position:absolute; left:80px; right:80px; height:50px; border-bottom:1px dashed #ddd; text-align:center; font-size:12px; color:#888; }
        .page-footer { bottom:30px; border-top:1px dashed #ddd; border-bottom:none; top:auto; }
        .ruler-h, .ruler-v { background:#f1f5f9; position:absolute; font-size:10px; user-select:none; }
        .ruler-h { height:20px; top:0; left:80px; right:0; border-bottom:1px solid #ccc; }
        .ruler-v { width:20px; left:0; top:70px; bottom:0; border-right:1px solid #ccc; writing-mode:vertical-rl; }

        /* AI Sidebar */
        #aiSidebar { position:fixed; right:-400px; top:0; width:380px; height:100%; background:#fff; box-shadow:-4px 0 20px rgba(0,0,0,.15); transition:right .3s; z-index:2000; display:flex; flex-direction:column; }
        body.dark #aiSidebar { background:#1e293b; }
        #aiSidebar.active { right:0; }
        #aiSidebarHeader { padding:15px; background:var(--primary); color:white; display:flex; justify-content:space-between; align-items:center; }
        #aiChat { flex:1; padding:15px; overflow-y:auto; }
        .message { margin:10px 0; padding:10px 14px; border-radius:12px; max-width:85%; }
        .user { background:#2563eb; color:white; align-self:flex-end; margin-left:auto; }
        .ai { background:#f1f5f9; color:#333; }
        body.dark .ai { background:#334155; }

        /* Focus Mode */
        body.focus-mode .ribbon, body.focus-mode .document-container { filter:blur(8px); pointer-events:none; }
        body.focus-mode #pageCanvas { filter:none; pointer-events:all; transform:scale(1.1); }

        /* New Innovations CSS */
        .theme-selector { display:flex; gap:5px; }
        .theme-selector button { width:20px; height:20px; border-radius:50%; border:1px solid #ccc; cursor:pointer; }
        #theme-light { background:#f8fafc; }
        #theme-dark { background:#0f172a; }
        #theme-sepia { background:#f4eee4; }
        body.sepia { --bg:#f4eee4; --text:#4a3c31; --ribbon:#f0e7db; }
        .auto-outline { position:fixed; left:10px; top:100px; width:250px; background:#fff; padding:10px; border:1px solid #ccc; box-shadow:0 2px 10px rgba(0,0,0,.1); display:none; }
        .auto-outline.active { display:block; }
        .version-history { list-style:none; padding:0; }
        .version-history li { cursor:pointer; padding:5px; border-bottom:1px solid #eee; }
        .version-history li:hover { background:#f0f0f0; }
        .diff-viewer { position:fixed; bottom:10px; right:10px; width:400px; height:300px; background:#fff; overflow:auto; border:1px solid #ccc; display:none; }
        .diff-viewer.active { display:block; }
        .markdown-export { display:none; } /* Hidden textarea for copy */
        .import-url input { width:200px; }
        .pomodoro-timer { font-size:1.5em; color:var(--primary); }
        .voice-note { background:#ffeb3b; padding:5px; border-radius:5px; cursor:pointer; }
        .mention { color:#2563eb; font-weight:bold; }
        .collaborator-avatar { width:30px; height:30px; border-radius:50%; text-align:center; line-height:30px; color:white; font-weight:bold; cursor:pointer; }
    </style>
</head>
<body>

<div class="ribbon">
    <div class="quick-access">
        <button onclick="formatText('bold')" title="Bold"><i class="fas fa-bold"></i></button>
        <button onclick="formatText('italic')" title="Italic"><i class="fas fa-italic"></i></button>
        <button onclick="formatText('underline')" title="Underline"><i class="fas fa-underline"></i></button>
        <button onclick="toggleDarkMode()" title="Dark Mode"><i class="fas fa-moon"></i></button>
        <button onclick="toggleFocusMode()" title="Focus Mode"><i class="fas fa-eye"></i></button>
        <button onclick="toggleAISidebar()" title="Ask AI"><i class="fas fa-robot"></i></button>
        <button onclick="startDictation()" title="Dictation"><i class="fas fa-microphone"></i></button>
        <button onclick="readAloud()" title="Read Aloud"><i class="fas fa-volume-up"></i></button>
        <button onclick="generateAutoOutline()" title="Auto Outline"><i class="fas fa-list"></i></button>
        <button onclick="startPomodoro()" title="Pomodoro"><i class="fas fa-clock"></i></button>
        <button onclick="toggleVersionHistory()" title="Version History"><i class="fas fa-history"></i></button>
        <div class="theme-selector">
            <button id="theme-light" onclick="setTheme('light')"></button>
            <button id="theme-dark" onclick="setTheme('dark')"></button>
            <button id="theme-sepia" onclick="setTheme('sepia')"></button>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-button active" data-tab="file">File</button>
        <button class="tab-button" data-tab="home">Home</button>
        <button class="tab-button" data-tab="insert">Insert</button>
        <button class="tab-button" data-tab="layout">Layout</button>
        <button class="tab-button" data-tab="review">Review</button>
        <button class="tab-button" data-tab="view">View</button>
        <button class="tab-button" data-tab="ai">AI Tools</button>
        <button class="tab-button" data-tab="collaborate">Collaborate</button>
        <button class="tab-button" data-tab="tools">Tools</button>
        <button class="tab-button" data-tab="plugins">Plugins</button>
    </div>

    <div style="display:flex; gap:10px; align-items:center;">
        <div style="display:flex; gap:5px;">
            <div class="collaborator-avatar" title="You" style="background:#10b981;">Y</div>
            <div class="collaborator-avatar" title="Alice" style="background:#f59e0b;">A</div>
        </div>
        <span id="wordCountLive">0 words</span>
        <span id="pomodoroTimer" class="pomodoro-timer">25:00</span>
    </div>
</div>

<div class="tab-content" id="file">
    <div class="group">
        <h3>File Actions</h3>
        <button onclick="newDocument()">New</button>
        <button onclick="saveDocument()">Save</button>
        <button onclick="openDocument()">Open</button>
        <button onclick="exportDocument('docx')">Export as DOCX</button>
        <button onclick="exportDocument('pdf')">Export as PDF</button>
        <button onclick="exportToMarkdown()">Export as Markdown</button>
        <button onclick="printDocument()">Print</button>
    </div>
    <div class="group">
        <h3>Templates</h3>
        <div class="styles-dropdown-group">
            <button class="styles-dropdown-button" onclick="toggleTemplateGallery()">Templates <i class="fas fa-caret-down"></i></button>
            <div class="styles-dropdown-content" id="templatesDropdown">
                <!-- Templates will be loaded here by JavaScript -->
            </div>
        </div>
    </div>
    <div class="group">
        <h3>Document Info</h3>
        <button onclick="wordCount()">Word Count</button>
        <button onclick="characterCount()">Character Count</button>
        <button onclick="pageCount()">Page Count</button>
        <button onclick="documentStats()">Document Stats</button>
    </div>
    <div class="group import-url">
        <h3>Import</h3>
        <input type="text" id="importUrl" placeholder="Enter URL to import">
        <button onclick="importFromUrl()">Import from URL</button>
    </div>
</div>

<div class="tab-content" id="home">
    <div class="group">
        <h3>Font</h3>
        <select onchange="changeFont(this.value)">
            <option value="Arial">Arial</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Courier New">Courier New</option>
            <option value="Verdana">Verdana</option>
            <option value="Georgia">Georgia</option>
            <option value="Calibri">Calibri</option>
            <option value="Segoe UI">Segoe UI</option>
            <option value="Roboto">Roboto</option>
            <option value="Open Sans">Open Sans</option>
        </select>
        <input type="number" value="16" min="8" max="72" style="width: 50px;" onchange="changeFontSize(this.value)">
        <button onclick="formatText('bold')" id="boldButton"><b>B</b></button>
        <button onclick="formatText('italic')" id="italicButton"><i>I</i></button>
        <button onclick="formatText('underline')" id="underlineButton"><u>U</u></button>
        <button onclick="formatText('strikeThrough')" id="strikeButton"><strike>S</strike></button>
        <button onclick="formatText('superscript')" id="superscriptButton">X<sup>2</sup></button>
        <button onclick="formatText('subscript')" id="subscriptButton">X<sub>2</sub></button>
        <button onclick="changeTextCase('uppercase')">Aa <i class="fas fa-arrow-up"></i></button>
        <button onclick="changeTextCase('lowercase')">aa <i class="fas fa-arrow-down"></i></button>
        <button onclick="clearFormatting()" id="clearFormatting">Clear Format</button>
    </div>
    <div class="group">
        <h3>Paragraph</h3>
        <div class="styles-dropdown-group">
            <button class="styles-dropdown-button">Styles <i class="fas fa-caret-down"></i></button>
            <div class="styles-dropdown-content" id="stylesDropdown">
                <button onclick="applyStyle('Heading 1')">Heading 1</button>
                <button onclick="applyStyle('Heading 2')">Heading 2</button>
                <button onclick="applyStyle('Heading 3')">Heading 3</button>
                <button onclick="applyStyle('Heading 4')">Heading 4</button>
                <button onclick="applyStyle('Heading 5')">Heading 5</button>
                <button onclick="applyStyle('Heading 6')">Heading 6</button>
                <button onclick="applyStyle('Normal')">Normal</button>
                <button onclick="applyStyle('Quote')">Quote</button>
                <button onclick="applyStyle('List Paragraph')">List Paragraph</button>
                <button onclick="applyStyle('Code')">Code</button>
                <button onclick="applyStyle('Intense Quote')">Intense Quote</button>
                <button onclick="applyStyle('Subtitle')">Subtitle</button>
            </div>
        </div>
        <button onclick="alignText('left')"><i class="fas fa-align-left"></i></button>
        <button onclick="alignText('center')"><i class="fas fa-align-center"></i></button>
        <button onclick="alignText('right')"><i class="fas fa-align-right"></i></button>
        <button onclick="alignText('justify')"><i class="fas fa-align-justify"></i></button>
        <button onclick="formatText('insertUnorderedList')" class="list-button"><i class="fas fa-list-ul"></i></button>
        <button onclick="formatText('insertOrderedList')" class="list-button"><i class="fas fa-list-ol"></i></button>
        <button onclick="formatText('indent')" class="indent-button"><i class="fas fa-indent"></i></button>
        <button onclick="formatText('outdent')" class="indent-button"><i class="fas fa-outdent"></i></button>
        <button onclick="setLineSpacing('1.0')">1.0x Spacing</button>
        <button onclick="setLineSpacing('1.15')">1.15x Spacing</button>
        <button onclick="setLineSpacing('1.5')">1.5x Spacing</button>
        <button onclick="setLineSpacing('2.0')">2.0x Spacing</button>
        <button onclick="showParagraphSettings()">Paragraph Options</button>
        <button onclick="showBordersAndShading()">Borders & Shading</button>
    </div>
    <div class="group">
        <h3>Clipboard</h3>
        <button onclick="formatText('cut')"><i class="fas fa-cut"></i> Cut</button>
        <button onclick="formatText('copy')"><i class="fas fa-copy"></i> Copy</button>
        <button onclick="formatText('paste')"><i class="fas fa-paste"></i> Paste</button>
        <button onclick="pasteSpecial()">Paste Special</button>
        <button onclick="formatPainter()">Format Painter</button>
    </div>
    <div class="group">
        <h3>Editing</h3>
        <button onclick="formatText('undo')"><i class="fas fa-undo"></i> Undo</button>
        <button onclick="formatText('redo')"><i class="fas fa-redo"></i> Redo</button>
        <div class="find-replace-group advanced">
            <input type="text" id="findText" placeholder="Find">
            <input type="text" id="replaceText" placeholder="Replace">
            <button onclick="findAndReplace()">Find & Replace</button>
        </div>
        <div class="find-options">
            <label><input type="checkbox" id="caseSensitive"> Case Sensitive</label>
            <label><input type="checkbox" id="wholeWord"> Whole Word</label>
            <label><input type="checkbox" id="useRegex"> Use Regex</label>
        </div>
        <button onclick="goToLine()">Go To Line</button>
        <button onclick="selectAll()">Select All</button>
    </div>
</div>

<div class="tab-content" id="insert">
    <div class="group">
        <h3>Pages</h3>
        <button onclick="insertCoverPage()">Cover Page</button>
        <button onclick="insertBlankPage()">Blank Page</button>
        <button onclick="insertPageBreak()">Page Break</button>
    </div>
    <div class="group">
        <h3>Tables</h3>
        <button onclick="insertTable()">Insert Table</button>
        <button onclick="drawTable()">Draw Table</button>
        <button onclick="insertExcelSpreadsheet()">Excel Spreadsheet</button>
        <button onclick="insertPredefinedTable()">Quick Tables</button>
    </div>
    <div class="group">
        <h3>Illustrations</h3>
        <button onclick="insertImage()">Insert Image</button>
        <button onclick="insertOnlineImage()">Online Pictures</button>
        <button onclick="insertShape()">Insert Shape</button>
        <button onclick="insertIcons()">Icons</button>
        <button onclick="insert3DModel()">3D Models</button>
        <button onclick="insertSmartArt()">SmartArt</button>
        <button onclick="insertChart()">Insert Chart</button>
        <button onclick="insertScreenshot()">Screenshot</button>
    </div>
    <div class="group">
        <h3>Add-ins</h3>
        <button onclick="getAddIns()">Get Add-ins</button>
        <button onclick="myAddIns()">My Add-ins</button>
        <button onclick="storeLink()">Store</button>
        <button onclick="wikipediaLink()">Wikipedia</button>
    </div>
    <div class="group">
        <h3>Links & Media</h3>
        <button onclick="insertLink()">Insert Link</button>
        <button onclick="insertBookmark()">Bookmark</button>
        <button onclick="insertComment()">Comment</button>
        <button onclick="insertOnlineVideo()">Online Video</button>
        <button onclick="insertTweet()">Embed Tweet</button>
        <button onclick="insertSpotify()">Embed Spotify</button>
        <button onclick="insertFigma()">Embed Figma</button>
    </div>
    <div class="group">
        <h3>Symbols</h3>
        <button onclick="insertEquation()">Equation</button>
        <button onclick="insertSymbol()">Symbol</button>
    </div>
    <div class="group">
        <h3>Header & Footer & Text</h3>
        <button onclick="insertHeader()">Header</button>
        <button onclick="insertFooter()">Footer</button>
        <button onclick="insertPageNumber()">Page Number</button>
        <button onclick="insertTextBox()">Text Box</button>
        <button onclick="insertQuickParts()">Quick Parts</button>
        <button onclick="insertWordArt()">WordArt</button>
        <button onclick="insertSignatureLine()">Signature Line</button>
        <button onclick="insertDateAndTime()">Date & Time</button>
        <button onclick="insertObject()">Object</button>
    </div>
    <div class="group">
        <h3>Breaks</h3>
        <button onclick="insertPageBreak()">Page Break</button>
        <button onclick="insertSectionBreak()">Section Break</button>
        <button onclick="insertColumnBreak()">Column Break</button>
        <button onclick="insertTextWrappingBreak()">Text Wrapping Break</button>
    </div>
</div>

<div class="tab-content" id="layout">
    <div class="group">
        <h3>Page Setup</h3>
        <select>
            <option>Margins</option>
            <option>Narrow</option>
            <option>Moderate</option>
            <option>Wide</option>
            <option>Custom Margins...</option>
        </select>
        <select>
            <option>Orientation</option>
            <option>Portrait</option>
            <option>Landscape</option>
        </select>
        <select>
            <option>Size</option>
            <option>Letter</option>
            <option>A4</option>
            <option>Legal</option>
            <option>More Paper Sizes...</option>
        </select>
        <select onchange="setColumns(this.value)">
            <option>Columns</option>
            <option value="1">One</option>
            <option value="2">Two</option>
            <option value="3">Three</option>
            <option value="4">Four</option>
            <option>More Columns...</option>
        </select>
        <button onclick="breaksDropdown()">Breaks</button>
        <button onclick="lineNumbering()">Line Numbers</button>
        <button onclick="hyphenation()">Hyphenation</button>
    </div>
    <div class="group">
        <h3>Paragraph (Layout)</h3>
        <input type="number" placeholder="Indent Left" style="width: 80px;">
        <input type="number" placeholder="Indent Right" style="width: 80px;">
        <input type="number" placeholder="Spacing Before" style="width: 90px;">
        <input type="number" placeholder="Spacing After" style="width: 90px;">
        <button onclick="positionSettings()">Position</button>
        <button onclick="wrapTextSettings()">Wrap Text</button>
        <button onclick="bringForward()">Bring Forward</button>
        <button onclick="sendBackward()">Send Backward</button>
        <button onclick="selectionPane()">Selection Pane</button>
        <button onclick="alignObjects()">Align</button>
        <button onclick="groupObjects()">Group</button>
        <button onclick="rotateObjects()">Rotate</button>
    </div>
</div>

<div class="tab-content" id="review">
    <div class="group">
        <h3>Proofing</h3>
        <button onclick="checkSpellingAndGrammar()">Spelling & Grammar</button>
        <button onclick="openThesaurus()">Thesaurus</button>
        <button onclick="smartLookup()">Smart Lookup</button>
        <button onclick="wordCount()">Word Count</button>
        <button onclick="characterCount()">Character Count</button>
        <button onclick="readingLevel()">Reading Level</button>
        <button onclick="translateDocument()">Translate</button>
        <button onclick="languageSettings()">Language</button>
    </div>
    <div class="group">
        <h3>Accessibility & Comments</h3>
        <button onclick="checkAccessibility()">Check Accessibility</button>
        <button onclick="newComment()">New Comment</button>
        <button onclick="showComments()">Show Comments</button>
        <button onclick="trackComments()">Track Comments</button>
        <button onclick="deleteComment()">Delete</button>
        <button onclick="previousComment()">Previous</button>
        <button onclick="nextComment()">Next</button>
        <button onclick="addVoiceNote()">Add Voice Note</button>
    </div>
    <div class="group">
        <h3>Track Changes & Compare</h3>
        <button onclick="toggleTrackChanges()">Track Changes</button>
        <button onclick="reviewChanges()">Reviewing Pane</button>
        <button onclick="acceptChanges()">Accept</button>
        <button onclick="rejectChanges()">Reject</button>
        <button onclick="previousChange()">Previous</button>
        <button onclick="nextChange()">Next</button>
        <button onclick="compareDocuments()">Compare</button>
        <button onclick="combineDocuments()">Combine</button>
    </div>
    <div class="group">
        <h3>Protect</h3>
        <button onclick="protectDocument()">Protect Document</button>
        <button onclick="restrictEditing()">Restrict Editing</button>
    </div>
    <div class="group">
        <h3>Ink</h3>
        <button onclick="startInking()">Start Inking</button>
        <select>
            <option>Ink Color</option>
            <option>Black</option>
            <option>Red</option>
            <option>Blue</option>
        </select>
        <select>
            <option>Ink Thickness</option>
            <option>Thin</option>
            <option>Medium</option>
            <option>Thick</option>
        </select>
        <button onclick="inkEraser()">Eraser</button>
    </div>
</div>

<div class="tab-content" id="view">
    <div class="group">
        <h3>Views</h3>
        <button onclick="toggleReadMode()">Read Mode</button>
        <button onclick="togglePrintLayout()">Print Layout</button>
        <button onclick="toggleWebLayout()">Web Layout</button>
        <button onclick="toggleOutlineView()">Outline</button>
        <button onclick="toggleDraftView()">Draft</button>
        <button onclick="toggleFullScreen()">Full Screen</button>
        <button onclick="immersiveReader()">Immersive Reader</button>
    </div>
    <div class="group">
        <h3>Show</h3>
        <button onclick="showRuler()">Ruler</button>
        <button onclick="showGridlines()">Gridlines</button>
        <button onclick="showNavigationPane()">Navigation Pane</button>
        <button onclick="showStatusBar()">Status Bar</button>
    </div>
    <div class="group">
        <h3>Zoom & Window</h3>
        <div class="zoom-controls">
            <button onclick="zoomIn()">+</button>
            <input type="text" id="zoom-level" value="100%" readonly>
            <button onclick="zoomOut()">-</button>
            <button onclick="resetZoom()">100%</button>
        </div>
        <button onclick="newWindow()">New Window</button>
        <button onclick="arrangeWindows()">Arrange All</button>
        <button onclick="splitWindow()">Split</button>
        <button onclick="viewSideBySide()">View Side by Side</button>
        <button onclick="synchronousScrolling()">Synchronous Scrolling</button>
        <button onclick="resetWindowPosition()">Reset Window Position</button>
        <button onclick="switchWindows()">Switch Windows</button>
    </div>
    <div class="group">
        <h3>Macros</h3>
        <button onclick="recordMacro()">Record Macro</button>
        <button onclick="viewMacros()">View Macros</button>
    </div>
</div>

<div class="tab-content" id="ai">
    <div class="group">
        <h3>AI Assistance</h3>
        <button onclick="smartComposeToggle()">Smart Compose <span id="smartComposeStatus">(Off)</span></button>
        <button onclick="grammarCheckAI()">AI Grammar Check</button>
        <button onclick="styleSuggestionsAI()">Style Suggestions</button>
        <button onclick="summarizeTextAI()">Summarize Text</button>
        <button onclick="translateAI()">Translate with AI</button>
        <button onclick="contentRewriteAI()">Rewrite Content</button>
        <button onclick="toneAdjustAI()">Adjust Tone</button>
        <button onclick="improveWriting()">Improve Writing</button>
        <button onclick="makeLonger()">Make Longer</button>
        <button onclick="makeShorter()">Make Shorter</button>
    </div>
    <div class="group">
        <h3>Research & Ideas</h3>
        <button onclick="researchAI()">Research</button>
        <button onclick="ideasAI()">Ideas & Suggestions</button>
    </div>
</div>

<div class="tab-content" id="collaborate">
    <div class="group">
        <h3>Share & Collaborate</h3>
        <button onclick="shareDocument()">Share</button>
        <button onclick="collaborateRealtimeToggle()">Real-time Collaboration <span id="realtimeStatus">(Off)</span></button>
        <input type="text" placeholder="Invite Collaborators" id="collaboratorInput">
        <button onclick="inviteCollaborator()">Invite</button>
        <button onclick="managePermissions()">Manage Permissions</button>
        <button onclick="trackCollaborators()">Track Collaborators</button>
        <button onclick="startCoAuthoringSession()">Start Co-authoring Session</button>
        <button onclick="joinCoAuthoringSession()">Join Co-authoring Session</button>
    </div>
    <div class="group">
        <h3>Version History & Backup</h3>
        <button onclick="versionHistory()">Version History</button>
        <button onclick="autosaveToggle()">Autosave <span id="autosaveStatus">(On)</span></button>
        <button onclick="manualBackup()">Manual Backup</button>
        <button onclick="cloudSyncToggle()">Cloud Sync <span id="cloudSyncStatus">(Off)</span></button>
    </div>
</div>

<div class="tab-content" id="tools">
    <div class="group">
        <h3>Accessibility</h3>
        <button onclick="checkAccessibility()">Check Accessibility</button>
        <button onclick="accessibilitySettings()">Accessibility Settings</button>
        <button onclick="toggleHighContrast()" title="High Contrast"><i class="fas fa-adjust"></i></button>
    </div>
    <div class="group">
        <h3>Mailings</h3>
        <button onclick="mailMerge()">Mail Merge</button>
        <button onclick="envelopes()">Envelopes</button>
        <button onclick="labels()">Labels</button>
    </div>
    <div class="group">
        <h3>Document Conversion</h3>
        <button onclick="convertToPDF()">Convert to PDF</button>
        <button onclick="convertToDOCX()">Convert to DOCX</button>
        <button onclick="convertToHTML()">Convert to HTML</button>
        <button onclick="convertToPlainText()">Convert to Plain Text</button>
    </div>
    <div class="group">
        <h3>Options</h3>
        <button onclick="optionsDialog()">Options</button>
        <button onclick="customizeRibbon()">Customize Ribbon</button>
        <button onclick="keyboardShortcuts()">Keyboard Shortcuts</button>
    </div>
</div>

<div class="tab-content" id="plugins">
    <div class="group"><h3>Installed Plugins</h3>
        <button onclick="insertMermaid()">Mermaid Diagram</button>
        <button onclick="insertQR()">Insert QR Code</button>
        <button onclick="runPlugin('wordcloud')">Word Cloud</button>
        <button onclick="insertLaTeX()">Insert LaTeX Math</button>
    </div>
</div>

<div class="document-container">
    <div class="ruler-h"></div>
    <div class="ruler-v"></div>
    <div id="pageCanvas" contenteditable="true" spellcheck="true" oncontextmenu="showContextMenu(event)" oninput="handleDocumentInput(event)">
        <div class="page-header" contenteditable="true">Header – Double-click to edit</div>
        Start typing your masterpiece…
        <div class="page-footer" contenteditable="true">Page <span class="page-number">1</span></div>
    </div>
</div>

<!-- Context Menu -->
<div id="contextMenu" style="position: fixed; z-index: 1; display:none; border: 1px solid #ccc; background-color: white; padding: 5px; border-radius: 3px; box-shadow: 2px 2px 5px rgba(0,0,0,0.2);">
    <button onclick="formatText('bold'); hideContextMenu()">Bold</button>
    <button onclick="formatText('italic'); hideContextMenu()">Italic</button>
    <button onclick="formatText('underline'); hideContextMenu()">Underline</button>
    <button onclick="formatText('copy'); hideContextMenu()">Copy</button>
    <button onclick="formatText('cut'); hideContextMenu()">Cut</button>
    <button onclick="pasteInContextMenu(); hideContextMenu()">Paste</button>
    <button onclick="insertComment(); hideContextMenu()">Add Comment</button>
    <button onclick="summarizeSelectionAI(); hideContextMenu()">Summarize (AI)</button>
    <button onclick="translateSelectionAI(); hideContextMenu()">Translate (AI)</button>
</div>

<!-- AI Suggestion Popup -->
<div id="aiSuggestionPopup" class="ai-suggestion-popup">
    <!-- Suggestions will be populated here by JavaScript -->
</div>

<!-- Collaborator Cursors Container -->
<div id="collaboratorCursors"></div>

<!-- AI Sidebar -->
<div id="aiSidebar">
    <div id="aiSidebarHeader">
        <strong>Ask NeuraAI</strong>
        <button style="background:none;border:none;color:white;font-size:1.4em;cursor:pointer;" onclick="toggleAISidebar()">×</button>
    </div>
    <div id="aiChat"></div>
    <div style="padding:10px;border-top:1px solid #ddd;display:flex;">
        <input id="aiPrompt" placeholder="Ask anything about your document…" style="flex:1;padding:10px;border-radius:8px;border:1px solid #ccc;">
        <button onclick="sendToAI()" style="margin-left:8px;padding:10px 16px;background:var(--primary);color:white;border:none;border-radius:8px;">Send</button>
    </div>
</div>

<!-- Auto Outline Sidebar -->
<div id="autoOutline" class="auto-outline">
    <h3>Document Outline</h3>
    <ul id="outlineList"></ul>
</div>

<!-- Version History -->
<div id="versionHistoryPanel" style="display:none; position:fixed; top:50px; right:20px; width:300px; background:#fff; padding:10px; border:1px solid #ccc; box-shadow:0 2px 10px rgba(0,0,0,.1);">
    <h3>Version History</h3>
    <ul class="version-history" id="versionList"></ul>
</div>

<!-- Diff Viewer -->
<div id="diffViewer" class="diff-viewer">
    <h3>Diff View</h3>
    <pre id="diffContent"></pre>
</div>

<!-- Markdown Export Hidden -->
<textarea id="markdownExport" class="markdown-export"></textarea>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/diff/5.1.0/diff.min.js"></script>
<script>
mermaid.initialize({startOnLoad:true});

document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', () => {
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => {
            content.style.display = 'none';
        });
        const tabId = button.getAttribute('data-tab');
        document.getElementById(tabId).style.display = 'block';
        button.classList.add('active');
    });
});
document.getElementById('file').style.display = 'block';
document.querySelector('.tab-button[data-tab="file"]').classList.add('active');

function formatText(command) {
    document.execCommand(command, false, null);
    updateFormatButtons();
}

function alignText(alignment) {
    document.execCommand('justify' + alignment.charAt(0).toUpperCase() + alignment.slice(1), false, null);
}

function changeFont(fontName) {
    document.execCommand('fontName', false, fontName);
}

function changeFontSize(size) {
    document.execCommand('fontSize', false, '7');
    const fontElements = document.querySelectorAll('font[size="7"]');
    fontElements.forEach(el => {
        const span = document.createElement('span');
        span.style.fontSize = size + 'px';
        span.innerHTML = el.innerHTML;
        el.parentNode.replaceChild(span, el);
    });
}

function changeTextColor(color) {
    document.execCommand('foreColor', false, color);
}

function changeHighlightColor(color) {
    document.execCommand('backColor', false, color);
}

function clearFormatting() {
    document.execCommand('removeFormat', false, null);
    updateFormatButtons();
}

function insertTable() {
    const rows = prompt('Enter number of rows:', '2');
    const cols = prompt('Enter number of columns:', '2');
    if (rows && cols) {
        let tableHtml = '<table border="1" style="border-collapse: collapse;">';
        for (let i = 0; i < rows; i++) {
            tableHtml += '<tr>';
            for (let j = 0; j < cols; j++) {
                tableHtml += '<td style="padding: 5px;">Cell</td>';
            }
            tableHtml += '</tr>';
        }
        tableHtml += '</table>';
        document.execCommand('insertHTML', false, tableHtml);
    }
}

function insertImage() {
    const url = prompt('Enter image URL:');
    if (url) {
        document.execCommand('insertImage', false, url);
    }
}

function insertLink() {
    const url = prompt('Enter URL:');
    if (url) {
        document.execCommand('createLink', false, url);
    }
}

function insertHorizontalRule() {
    document.execCommand('insertHorizontalRule', false, null);
}

function newDocument() {
    document.querySelector('#pageCanvas').innerHTML = '<div class="page-header" contenteditable="true">Header – Double-click to edit</div>Start typing here...<div class="page-footer" contenteditable="true">Page <span class="page-number">1</span></div>';
}

function saveDocument() {
    const content = document.querySelector('#pageCanvas').innerHTML;
    const blob = new Blob([content], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'document.html';
    a.click();
    URL.revokeObjectURL(url);
}

function openDocument() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'text/html';
    input.onchange = function(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            document.querySelector('#pageCanvas').innerHTML = e.target.result;
        };
        reader.readAsText(file);
    };
    input.click();
}

function updateFormatButtons() {
    document.querySelectorAll('.group button[onclick^="formatText"]').forEach(button => {
        const command = button.getAttribute('onclick').match(/'([^']+)'/)[1];
        if (command === 'bold' || command === 'italic' || command === 'underline' || command === 'strikeThrough' || command === 'superscript' || command === 'subscript') {
            if (document.queryCommandState(command)) {
                button.classList.add('active-format');
            } else {
                button.classList.remove('active-format');
            }
        }
    });
}
document.addEventListener('selectionchange', updateFormatButtons);
document.addEventListener('DOMContentLoaded', updateFormatButtons);

document.addEventListener('DOMContentLoaded', () => {
    const stylesDropdownContent = document.getElementById('stylesDropdown');
    if (stylesDropdownContent) {
        stylesDropdownContent.style.display = 'none';
    }
});

function applyStyle(styleName) {
    if (styleName === 'Heading 1') {
        applyFormatting('<h1 style="font-size: 2em; margin-bottom: 0.5em;">', '</h1>');
    } else if (styleName === 'Heading 2') {
        applyFormatting('<h2 style="font-size: 1.5em; margin-bottom: 0.5em;">', '</h2>');
    } else if (styleName === 'Heading 3') {
        applyFormatting('<h3 style="font-size: 1.17em; margin-bottom: 0.5em;">', '</h3>');
    } else if (styleName === 'Heading 4') {
        applyFormatting('<h4 style="font-size: 1.0em; margin-bottom: 0.5em; font-weight: bold;">', '</h4>');
    } else if (styleName === 'Heading 5') {
        applyFormatting('<h5 style="font-size: 0.9em; margin-bottom: 0.5em; font-weight: bold; font-style: italic;">', '</h5>');
    } else if (styleName === 'Heading 6') {
        applyFormatting('<h6 style="font-size: 0.8em; margin-bottom: 0.5em; font-weight: bold; color: #777;">', '</h6>');
    } else if (styleName === 'Normal') {
        applyFormatting('<p style="font-size: 1em; line-height: 1.6;">', '</p>');
    } else if (styleName === 'Quote') {
        applyFormatting('<blockquote style="border-left: 3px solid #ccc; margin-left: 10px; padding-left: 10px; font-style: italic;">', '</blockquote>');
    } else if (styleName === 'List Paragraph') {
        applyFormatting('<p style="margin-left: 20px;">', '</p>');
    } else if (styleName === 'Code') {
        applyFormatting('<pre style="background-color: #f4f4f4; border: 1px solid #ddd; padding: 10px; font-family: monospace; font-size: 0.9em; border-radius: 3px; overflow-x: auto;">', '</pre>');
    } else if (styleName === 'Intense Quote') {
        applyFormatting('<blockquote style="border-left: 5px solid #333; margin-left: 15px; padding-left: 15px; font-style: italic; font-weight: bold; color: #555;">', '</blockquote>');
    } else if (styleName === 'Subtitle') {
        applyFormatting('<h4 style="font-size: 1.2em; color: #666; margin-bottom: 0.3em; font-style: italic;">', '</h4>');
    }
}

function applyFormatting(startTag, endTag) {
    const selection = window.getSelection();
    if (!selection.rangeCount) return;
    const range = selection.getRangeAt(0);
    const selectedText = range.toString();
    const formattedText = startTag + selectedText + endTag;
    range.deleteContents();
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = formattedText;
    const fragment = document.createDocumentFragment();
    while (tempDiv.firstChild) {
        fragment.appendChild(tempDiv.firstChild);
    }
    range.insertNode(fragment);
    selection.removeAllRanges();
}

function setLineSpacing(spacing) {
    document.querySelector('#pageCanvas').style.lineHeight = spacing;
}

function findAndReplace() {
    const findText = document.getElementById('findText').value;
    const replaceText = document.getElementById('replaceText').value;
    const documentElement = document.querySelector('#pageCanvas');
    let regex;
    let flags = 'g';
    if (!document.getElementById('caseSensitive').checked) {
        flags += 'i';
    }
    if (document.getElementById('useRegex').checked) {
        try {
            regex = new RegExp(findText, flags);
        } catch (e) {
            alert('Invalid Regular Expression.');
            return;
        }
    } else {
        const escapedFindText = escapeRegExp(findText);
        if (document.getElementById('wholeWord').checked) {
            regex = new RegExp('\\b' + escapedFindText + '\\b', flags);
        } else {
            regex = new RegExp(escapedFindText, flags);
        }
    }
    documentElement.innerHTML = documentElement.innerHTML.replace(regex, replaceText);
}

function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

let currentZoom = 100;
const zoomStep = 10;
const zoomLevelDisplay = document.getElementById('zoom-level');

function zoomIn() {
    currentZoom += zoomStep;
    updateZoom();
}

function zoomOut() {
    currentZoom -= zoomStep;
    if (currentZoom < zoomStep) currentZoom = zoomStep;
    updateZoom();
}

function resetZoom() {
    currentZoom = 100;
    updateZoom();
}

function updateZoom() {
    document.querySelector('#pageCanvas').style.zoom = currentZoom / 100;
    zoomLevelDisplay.value = currentZoom + '%';
}

let isReadMode = false;
function toggleReadMode() {
    isReadMode = !isReadMode;
    const doc = document.querySelector('#pageCanvas');
    const body = document.body;
    if (isReadMode) {
        doc.style.maxWidth = '90%';
        doc.style.margin = '30px auto';
        doc.style.fontSize = '1.1em';
        doc.style.lineHeight = '1.8';
        body.style.backgroundColor = '#fafafa';
        doc.style.boxShadow = 'none';
        doc.style.border = 'none';
    } else {
        doc.style.maxWidth = 'none';
        doc.style.margin = '20px';
        doc.style.fontSize = '1em';
        doc.style.lineHeight = '1.6';
        body.style.backgroundColor = '#f4f7f9';
        doc.style.boxShadow = '0 0 10px rgba(0,0,0,0.08)';
        doc.style.border = '1px solid #ccc';
    }
}

let isFullScreen = false;
function toggleFullScreen() {
    if (!isFullScreen) {
        if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
        } else if (document.documentElement.mozRequestFullScreen) {
            document.documentElement.mozRequestFullScreen();
        } else if (document.documentElement.webkitRequestFullscreen) {
            document.documentElement.webkitRequestFullscreen();
        } else if (document.documentElement.msRequestFullscreen) {
            document.documentElement.msRequestFullscreen();
        }
    } else {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
    }
    isFullScreen = !isFullScreen;
}

function exportDocument(format) {
    const content = document.querySelector('#pageCanvas').innerHTML;
    if (format === 'pdf') {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        pdf.html(content, {
            callback: function (doc) {
                doc.save('document.pdf');
            },
            x: 10,
            y: 10,
            html2canvas: { scale: 0.2 }
        });
    } else if (format === 'docx') {
        const blob = new Blob([content], { type: 'application/msword' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'document.docx';
        a.click();
        URL.revokeObjectURL(url);
    } else if (format === 'html') {
        saveDocument();
    } else if (format === 'txt') {
        const textContent = document.querySelector('#pageCanvas').textContent;
        const blob = new Blob([textContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'document.txt';
        a.click();
        URL.revokeObjectURL(url);
    }
}

function exportToMarkdown() {
    const content = document.querySelector('#pageCanvas').innerHTML;
    const md = htmlToMarkdown(content); // Simple conversion function
    const blob = new Blob([md], { type: 'text/markdown' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'document.md';
    a.click();
    URL.revokeObjectURL(url);
}

function htmlToMarkdown(html) {
    // Basic HTML to MD conversion
    return html.replace(/<h1>(.*?)<\/h1>/g, '# $1\n')
               .replace(/<h2>(.*?)<\/h2>/g, '## $1\n')
               .replace(/<b>(.*?)<\/b>/g, '**$1**')
               .replace(/<i>(.*?)<\/i>/g, '*$1*')
               .replace(/<p>(.*?)<\/p>/g, '$1\n\n');
}

function printDocument() {
    window.print();
}

document.addEventListener('DOMContentLoaded', loadTemplates);
let isTemplateGalleryVisible = false;

function loadTemplates() {
    const templates = [
        { name: 'Blank Document', content: 'Start typing here...' },
        { name: 'Report Template', content: '<h1>Report Title</h1><p>Introduction...</p>' },
        { name: 'Memo Template', content: '<h2>MEMORANDUM</h2><p>To: ...</p><p>From: ...</p>' },
        { name: 'Resume Template', content: '<h1>[Your Name]</h1><h2>[Your Profession]</h2><p>[Contact Information]</p><hr><h3>Summary</h3><p>[Your Professional Summary]</p><hr><h3>Experience</h3><ul><li>[Job Title] - [Company] - [Dates]</li></ul>' },
        { name: 'Newsletter Template', content: '<h1>[Newsletter Title]</h1><p>Issue Date: [Date]</p><hr><h2>Feature Article</h2><p>[Article Content]</p>' },
        { name: 'Meeting Minutes', content: '<h2>Meeting Minutes</h2><p>Date: [Date]</p><p>Attendees: [List of Attendees]</p><hr><h3>Agenda Items & Discussions</h3><ul><li>[Item 1]: [Discussion Summary]</li></ul>' }
    ];
    const templatesDropdown = document.getElementById('templatesDropdown');
    if (templatesDropdown) {
        templatesDropdown.innerHTML = '';
        templates.forEach(template => {
            const templateButton = document.createElement('button');
            templateButton.textContent = template.name;
            templateButton.onclick = () => applyTemplate(template.content);
            templatesDropdown.appendChild(templateButton);
        });
    }
}

function applyTemplate(content) {
    document.querySelector('#pageCanvas').innerHTML = content;
    hideTemplateGallery();
}

function toggleTemplateGallery() {
    const templatesDropdown = document.getElementById('templatesDropdown');
    isTemplateGalleryVisible = !isTemplateGalleryVisible;
    if (isTemplateGalleryVisible) {
        loadTemplateGalleryView();
        templatesDropdown.style.display = 'grid';
    } else {
        loadTemplates();
        templatesDropdown.style.display = 'none';
    }
}

function hideTemplateGallery() {
    const templatesDropdown = document.getElementById('templatesDropdown');
    templatesDropdown.style.display = 'none';
    isTemplateGalleryVisible = false;
    loadTemplates();
}

function loadTemplateGalleryView() {
    const templateGalleryDiv = document.getElementById('templatesDropdown');
    if (!templateGalleryDiv) return;
    const templateData = [
        { name: 'Blank', preview: 'blank-template.png', content: 'Start typing here...' },
        { name: 'Report', preview: 'report-template.png', content: '<h1>Report Title</h1><p>Introduction...</p>' },
        { name: 'Memo', preview: 'memo-template.png', content: '<h2>MEMORANDUM</h2><p>To: ...</p><p>From: ...</p>' },
        { name: 'Resume', preview: 'resume-template.png', content: '<h1>[Your Name]</h1><h2>[Your Profession]</h2><p>[Contact Information]</p><hr><h3>Summary</h3><p>[Your Professional Summary]</p><hr><h3>Experience</h3><ul><li>[Job Title] - [Company] - [Dates]</li></ul>' },
        { name: 'Newsletter', preview: 'newsletter-template.png', content: '<h1>[Newsletter Title]</h1><p>Issue Date: [Date]</p><hr><h2>Feature Article</h2><p>[Article Content]</p>' },
        { name: 'Meeting', preview: 'meeting-template.png', content: '<h2>Meeting Minutes</h2><p>Date: [Date]</p><p>Attendees: [List of Attendees]</p><hr><h3>Agenda Items & Discussions</h3><ul><li>[Item 1]: [Discussion Summary]</li></ul>' }
    ];
    templateGalleryDiv.innerHTML = '';
    templateData.forEach(template => {
        const templatePreviewDiv = document.createElement('div');
        templatePreviewDiv.className = 'template-preview';
        templatePreviewDiv.onclick = () => applyTemplate(template.content);
        const templateTitle = document.createElement('h4');
        templateTitle.textContent = template.name;
        templatePreviewDiv.appendChild(templateTitle);
        const previewImage = document.createElement('div');
        previewImage.style.width = '100%';
        previewImage.style.height = '100px';
        previewImage.style.backgroundColor = '#eee';
        previewImage.style.marginBottom = '5px';
        previewImage.textContent = 'Preview';
        templatePreviewDiv.appendChild(previewImage);
        templateGalleryDiv.appendChild(templatePreviewDiv);
    });
}

function insertChart() {
    const ctx = document.createElement('canvas');
    ctx.id = 'chart-' + Date.now();
    document.execCommand('insertHTML', false, ctx.outerHTML);
    new Chart(ctx.id, {
        type: 'bar',
        data: {
            labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
                label: '# of Votes',
                data: [12, 19, 3, 5, 2, 3],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function insertShape() {
    const shape = prompt('Enter shape type (circle, rect):');
    if (shape === 'circle') {
        document.execCommand('insertHTML', false, '<div style="width:100px;height:100px;border-radius:50%;background:red;"></div>');
    } else if (shape === 'rect') {
        document.execCommand('insertHTML', false, '<div style="width:100px;height:100px;background:blue;"></div>');
    }
}

function insertSymbol() {
    const symbol = prompt('Enter symbol to insert:');
    if (symbol) {
        document.execCommand('insertText', false, symbol);
    }
}

function insertHeader() {
    const header = document.querySelector('.page-header');
    header.contentEditable = true;
    header.focus();
}

function insertFooter() {
    const footer = document.querySelector('.page-footer');
    footer.contentEditable = true;
    footer.focus();
}

function insertPageNumber() {
    const pageNum = document.querySelector('.page-number');
    pageNum.textContent = prompt('Enter page number:') || '1';
}

function insertPageBreak() {
    document.execCommand('insertHTML', false, '<div style="page-break-before:always;"></div>');
}

function insertIcons() {
    document.execCommand('insertHTML', false, '<i class="fas fa-star"></i>');
}

function insert3DModel() {
    alert('3D Models require external library; placeholder model inserted.');
    document.execCommand('insertHTML', false, '<div style="width:200px;height:200px;background:gray;">3D Model Placeholder</div>');
}

function insertExcelSpreadsheet() {
    document.execCommand('insertHTML', false, '<table border="1"><tr><td>Cell1</td><td>Cell2</td></tr></table>');
}

function insertCoverPage() {
    document.execCommand('insertHTML', false, '<div style="text-align:center;font-size:2em;">Cover Page</div><hr>');
}

function insertBlankPage() {
    insertPageBreak();
}

function insertOnlineVideo() {
    const url = prompt('Enter YouTube URL:');
    if (url) {
        const embed = url.replace('watch?v=', 'embed/');
        document.execCommand('insertHTML', false, `<iframe width="560" height="315" src="${embed}" frameborder="0"></iframe>`);
    }
}

function insertTextBox() {
    document.execCommand('insertHTML', false, '<div style="border:1px solid #ccc;padding:10px;">Text Box</div>');
}

function insertQuickParts() {
    document.execCommand('insertHTML', false, '<p>Quick Part Placeholder</p>');
}

function insertWordArt() {
    document.execCommand('insertHTML', false, '<span style="font-family:impact;color:red;text-shadow:2px 2px #ff0;">WordArt</span>');
}

function insertSignatureLine() {
    document.execCommand('insertHTML', false, '<hr style="width:200px;">Signature');
}

function insertDateAndTime() {
    const date = new Date().toLocaleString();
    document.execCommand('insertText', false, date);
}

function insertObject() {
    alert('Object insertion placeholder.');
}

function checkSpellingAndGrammar() {
    alert('Spelling & Grammar: No errors found (mock).');
}

function openThesaurus() {
    alert('Thesaurus: Synonyms for "word": term, phrase (mock).');
}

function wordCount() {
    const text = document.querySelector('#pageCanvas').textContent;
    const words = text.trim().split(/\s+/).filter(word => word).length;
    alert(`Word Count: ${words}`);
}

function characterCount() {
    const text = document.querySelector('#pageCanvas').textContent;
    const characters = text.length;
    alert(`Character Count: ${characters}`);
}

function pageCount() {
    alert('Page Count: 1 (mock - implement pagination for accuracy)');
}

function documentStats() {
    wordCount();
    characterCount();
    pageCount();
}

function smartLookup() {
    alert('Smart Lookup: Definition from dictionary (mock).');
}

let trackChangesEnabled = false;
let changeLog = [];

function toggleTrackChanges() {
    trackChangesEnabled = !trackChangesEnabled;
    alert(`Track Changes ${trackChangesEnabled ? 'Enabled' : 'Disabled'}`);
    if (trackChangesEnabled) {
        startTrackingChanges();
    } else {
        stopTrackingChanges();
    }
}

function startTrackingChanges() {
    const doc = document.querySelector('#pageCanvas');
    doc.addEventListener('input', recordChange);
}

function stopTrackingChanges() {
    const doc = document.querySelector('#pageCanvas');
    doc.removeEventListener('input', recordChange);
}

function recordChange(event) {
    if (!trackChangesEnabled) return;
    const changeType = event.inputType;
    const targetElement = event.target;
    let changeDetails = {
        type: changeType,
        timestamp: new Date(),
        content: targetElement.innerHTML
    };
    if (changeType === 'insertText') {
        const insertedText = event.data;
        if (insertedText) {
            const selection = window.getSelection();
            if (selection.rangeCount) {
                const range = selection.getRangeAt(0);
                const newNode = document.createElement('span');
                newNode.className = 'track-changes-insertion';
                newNode.textContent = insertedText;
                range.deleteContents();
                range.insertNode(newNode);
                range.collapse(false);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        }
    } else if (changeType === 'deleteContentBackward' || changeType === 'deleteContentForward') {
        const selection = window.getSelection();
        if (selection.rangeCount) {
            const range = selection.getRangeAt(0);
            const selectedNode = range.startContainer;
            if (selectedNode.nodeType === Node.TEXT_NODE && range.startOffset < selectedNode.textContent.length) {
                const deletedText = selectedNode.textContent.substring(range.startOffset, range.endOffset);
                const span = document.createElement('span');
                span.className = 'track-changes-highlight';
                span.textContent = deletedText;
                range.surroundContents(span);
            }
        }
    }
    changeLog.push(changeDetails);
    console.log('Change Log:', changeLog);
}

function acceptChanges() {
    document.querySelectorAll('.track-changes-insertion').forEach(el => el.classList.remove('track-changes-insertion'));
    document.querySelectorAll('.track-changes-highlight').forEach(el => el.remove());
}

function rejectChanges() {
    document.querySelectorAll('.track-changes-insertion').forEach(el => el.remove());
    document.querySelectorAll('.track-changes-highlight').forEach(el => el.style.textDecoration = 'none');
}

let commentCounter = 1;
function insertComment() {
    const selection = window.getSelection();
    if (!selection.rangeCount) return;
    const selectedText = selection.toString();
    if (!selectedText) {
        alert('Select text to comment on.');
        return;
    }
    const commentText = prompt('Enter your comment:');
    if (commentText) {
        const commentId = `comment-${commentCounter++}`;
        const commentBubble = document.createElement('span');
        commentBubble.className = 'comment-bubble';
        commentBubble.textContent = commentCounter - 1;
        commentBubble.title = commentText;
        const range = selection.getRangeAt(0).cloneRange();
        range.collapse(false);
        range.insertNode(commentBubble);
        console.log(`Comment "${commentText}" added to: "${selectedText}"`);
        selection.removeAllRanges();
    }
}

function showComments() {
    alert('Showing comments (implement side panel).');
}

function deleteComment() { alert('Delete Comment'); }
function previousComment() { alert('Previous Comment'); }
function nextComment() { alert('Next Comment'); }
function trackComments() { alert('Track Comments'); }
function reviewChanges() { alert('Reviewing Pane'); }
function previousChange() { alert('Previous Change'); }
function nextChange() { alert('Next Change'); }
function compareDocuments() { alert('Compare Documents'); }
function combineDocuments() { alert('Combine Documents'); }
function protectDocument() { alert('Protect Document'); }
function restrictEditing() { alert('Restrict Editing'); }
function startInking() { alert('Start Inking (canvas integration needed)'); }
function inkEraser() { alert('Ink Eraser'); }
function readingLevel() { alert('Reading Level: Intermediate (mock)'); }
function translateDocument() { alert('Translated document (mock)'); }
function languageSettings() { alert('Language set to English'); }

function showContextMenu(event) {
    event.preventDefault();
    const contextMenu = document.getElementById('contextMenu');
    contextMenu.style.display = 'block';
    contextMenu.style.left = event.clientX + 'px';
    contextMenu.style.top = event.clientY + 'px';
}

function hideContextMenu() {
    document.getElementById('contextMenu').style.display = 'none';
}

document.addEventListener('click', function(event) {
    if (!event.target.closest('#contextMenu') && document.getElementById('contextMenu').style.display === 'block') {
        hideContextMenu();
    }
});

function pasteInContextMenu() {
    formatText('paste');
}

function drawTable() { alert('Draw Table'); }
function insertPredefinedTable() { alert('Quick Tables'); }
function insertOnlineImage() { alert('Online Pictures'); }
function insertSmartArt() { alert('SmartArt'); }
function insertScreenshot() { alert('Screenshot'); }
function insertBookmark() { alert('Bookmark'); }
function insertEquation() {
    const eq = prompt('Enter LaTeX equation:');
    if (eq) {
        document.execCommand('insertHTML', false, `<span class="katex">${eq}</span>`);
        katex.render(eq, document.querySelector('.katex:last-child'));
    }
}
function insertSectionBreak() { alert('Section Break'); }
function insertColumnBreak() { alert('Column Break'); }
function insertTextWrappingBreak() { alert('Text Wrapping Break'); }
function togglePrintLayout() { alert('Print Layout View'); }
function toggleWebLayout() { alert('Web Layout View'); }
function toggleOutlineView() { alert('Outline View'); }
function toggleDraftView() { alert('Draft View'); }
function showRuler() { alert('Ruler'); }
function showGridlines() { alert('Gridlines'); }
function showNavigationPane() { alert('Navigation Pane'); }
function showStatusBar() { alert('Status Bar'); }
function newWindow() { alert('New Window'); }
function arrangeWindows() { alert('Arrange All Windows'); }
function splitWindow() { alert('Split Window'); }
function viewSideBySide() { alert('View Side by Side'); }
function synchronousScrolling() { alert('Synchronous Scrolling'); }
function resetWindowPosition() { alert('Reset Window Position'); }
function switchWindows() { alert('Switch Windows'); }
function recordMacro() { alert('Record Macro'); }
function viewMacros() { alert('View Macros'); }
function checkAccessibility() { alert('Accessibility OK (mock)'); }
function accessibilitySettings() { alert('Accessibility Settings'); }
function mailMerge() { alert('Mail Merge'); }
function envelopes() { alert('Envelopes'); }
function labels() { alert('Labels'); }
function getAddIns() { alert('Get Add-ins'); }
function myAddIns() { alert('My Add-ins'); }
function optionsDialog() { alert('Options Dialog'); }
function customizeRibbon() { alert('Customize Ribbon'); }
function keyboardShortcuts() { alert('Keyboard Shortcuts'); }
function showParagraphSettings() { alert('Paragraph Options'); }
function showBordersAndShading() { alert('Borders & Shading'); }
function formatPainter() { alert('Format Painter'); }
function selectAll() { document.execCommand('selectAll', false, null); }
function goToLine() { alert('Go To Line'); }
function convertToPDF() { exportDocument('pdf'); }
function convertToDOCX() { exportDocument('docx'); }
function convertToHTML() { exportDocument('html'); }
function convertToPlainText() { exportDocument('txt'); }
function storeLink() { alert('Store'); }
function wikipediaLink() { alert('Wikipedia'); }
function shareDocument() { alert('Share Document'); }
function collaborateRealtimeToggle() {
    realtimeCollaborationEnabled = !realtimeCollaborationEnabled;
    document.getElementById('realtimeStatus').textContent = `(${realtimeCollaborationEnabled ? 'On' : 'Off'})`;
    if (realtimeCollaborationEnabled) {
        startRealtimeCollaboration();
    } else {
        stopRealtimeCollaboration();
    }
}
function inviteCollaborator() { alert('Invite sent (mock)'); }
function managePermissions() { alert('Permissions managed'); }
function trackCollaborators() { alert('Tracking collaborators'); }
function startCoAuthoringSession() { alert('Session started'); }
function joinCoAuthoringSession() { alert('Joined session'); }
function versionHistory() { toggleVersionHistory(); }
function autosaveToggle() {
    autosaveEnabled = !autosaveEnabled;
    document.getElementById('autosaveStatus').textContent = `(${autosaveEnabled ? 'On' : 'Off'})`;
}
function manualBackup() { saveDocument(); }
function cloudSyncToggle() {
    cloudSyncEnabled = !cloudSyncEnabled;
    document.getElementById('cloudSyncStatus').textContent = `(${cloudSyncEnabled ? 'On' : 'Off'})`;
    alert('Cloud Sync toggled (mock)');
}

function changeTextCase(caseType) {
    const selection = window.getSelection();
    if (!selection.rangeCount) return;
    const range = selection.getRangeAt(0);
    const selectedText = selection.toString();
    let newText;
    if (caseType === 'uppercase') {
        newText = selectedText.toUpperCase();
    } else if (caseType === 'lowercase') {
        newText = selectedText.toLowerCase();
    }
    if (newText !== undefined) {
        range.deleteContents();
        range.insertNode(document.createTextNode(newText));
    }
}

let smartComposeEnabled = false;
function smartComposeToggle() {
    smartComposeEnabled = !smartComposeEnabled;
    document.getElementById('smartComposeStatus').textContent = `(${smartComposeEnabled ? 'On' : 'Off'})`;
    if (smartComposeEnabled) {
        startSmartCompose();
    } else {
        stopSmartCompose();
    }
}

function startSmartCompose() {
    document.querySelector('#pageCanvas').addEventListener('input', handleSmartCompose);
}

function stopSmartCompose() {
    document.querySelector('#pageCanvas').removeEventListener('input', handleSmartCompose);
    clearSmartComposeHighlight();
}

let currentSuggestionSpan = null;
function handleSmartCompose(event) {
    if (!smartComposeEnabled) return;
    const text = document.querySelector('#pageCanvas').textContent;
    const lastWord = text.trim().split(/\s+/).pop() || '';
    let suggestion = '';
    if (lastWord.toLowerCase() === 'the') {
        suggestion = ' quick brown fox jumps over the lazy dog.';
    } else if (lastWord.toLowerCase() === 'in') {
        suggestion = ' order to improve performance...';
    } else if (lastWord.toLowerCase() === 'for') {
        suggestion = ' example, consider the following...';
    } else if (lastWord.toLowerCase() === 'web') {
        suggestion = ' word processor is advanced and innovative.';
    }
    if (suggestion) {
        showAISuggestion(suggestion);
    } else {
        hideAISuggestion();
    }
}

function showAISuggestion(suggestionText) {
    hideAISuggestion();
    const selection = window.getSelection();
    if (!selection.rangeCount) return;
    const range = selection.getRangeAt(0).cloneRange();
    range.collapse(false);
    const suggestionSpan = document.createElement('span');
    suggestionSpan.className = 'smart-compose-highlight';
    suggestionSpan.textContent = suggestionText;
    currentSuggestionSpan = suggestionSpan;
    range.insertNode(suggestionSpan);
    range.collapse(false);
    selection.removeAllRanges();
    selection.addRange(range);
    document.addEventListener('keydown', acceptSuggestionOnTab);
}

function hideAISuggestion() {
    if (currentSuggestionSpan && currentSuggestionSpan.parentNode) {
        currentSuggestionSpan.parentNode.removeChild(currentSuggestionSpan);
        currentSuggestionSpan = null;
    }
    document.removeEventListener('keydown', acceptSuggestionOnTab);
}

function clearSmartComposeHighlight() {
    if (currentSuggestionSpan && currentSuggestionSpan.parentNode) {
        const textNode = document.createTextNode(currentSuggestionSpan.textContent);
        currentSuggestionSpan.parentNode.replaceChild(textNode, currentSuggestionSpan);
        currentSuggestionSpan = null;
    }
    document.removeEventListener('keydown', acceptSuggestionOnTab);
}

function acceptSuggestionOnTab(event) {
    if (event.key === 'Tab') {
        event.preventDefault();
        acceptAISuggestion();
    }
}

function acceptAISuggestion() {
    if (currentSuggestionSpan) {
        const suggestionText = currentSuggestionSpan.textContent;
        const range = document.createRange();
        range.setStartAfter(currentSuggestionSpan);
        range.collapse(true);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        clearSmartComposeHighlight();
    }
}

function grammarCheckAI() { alert('AI Grammar Check: Corrections applied (mock)'); }
function styleSuggestionsAI() { alert('Style Suggestions: Improved readability (mock)'); }
function summarizeTextAI() { alert('Summarize Text: Summary generated (mock)'); }
function translateAI() { alert('Translate with AI: Translated (mock)'); }
function contentRewriteAI() { alert('Rewrite Content: Rewritten (mock)'); }
function toneAdjustAI() { alert('Adjust Tone: Tone adjusted (mock)'); }
function researchAI() { alert('Research: Results found (mock)'); }
function ideasAI() { alert('Ideas & Suggestions: New ideas added (mock)'); }
function improveWriting() { alert('Improved writing applied (mock AI)'); }
function makeLonger() { alert('Made content longer (mock AI)'); }
function makeShorter() { alert('Made content shorter (mock AI)'); }

function summarizeSelectionAI() {
    const selection = window.getSelection();
    const selectedText = selection.toString();
    if (!selectedText) {
        alert('Select text to summarize.');
        return;
    }
    alert(`AI Summarize: Summary of "${selectedText}" (mock)`);
}

function translateSelectionAI() {
    const selection = window.getSelection();
    const selectedText = selection.toString();
    if (!selectedText) {
        alert('Select text to translate.');
        return;
    }
    alert(`AI Translate: Translation of "${selectedText}" (mock)`);
}

let realtimeCollaborationEnabled = false;
function startRealtimeCollaboration() {
    alert('Real-time Collaboration Started (local mock).');
    document.querySelector('#pageCanvas').addEventListener('input', sendDocumentChange);
    document.querySelector('#pageCanvas').addEventListener('selectionchange', sendCursorPosition);
}

function stopRealtimeCollaboration() {
    alert('Real-time Collaboration Stopped.');
    document.querySelector('#pageCanvas').removeEventListener('input', sendDocumentChange);
    document.querySelector('#pageCanvas').removeEventListener('selectionchange', sendCursorPosition);
}

function sendDocumentChange(event) {
    if (!realtimeCollaborationEnabled) return;
    console.log('Document Change:', event);
}

function sendCursorPosition() {
    if (!realtimeCollaborationEnabled) return;
    const selection = window.getSelection();
    if (selection.rangeCount) {
        const range = selection.getRangeAt(0);
        const cursorInfo = { startOffset: range.startOffset, endOffset: range.endOffset };
        console.log('Cursor Position:', cursorInfo);
    }
}

function handleRemoteCursor(collaboratorId, cursorInfo) {
    console.log(`Remote Cursor from ${collaboratorId}:`, cursorInfo);
    const cursorContainer = document.getElementById('collaboratorCursors');
    let cursorElement = document.getElementById(`cursor-${collaboratorId}`);
    if (!cursorElement) {
        cursorElement = document.createElement('div');
        cursorElement.id = `cursor-${collaboratorId}`;
        cursorElement.className = 'collaborator-cursor';
        const nameTag = document.createElement('div');
        nameTag.className = 'collaborator-name-tag';
        nameTag.textContent = `User ${collaboratorId.slice(0, 4)}`;
        cursorElement.appendChild(nameTag);
        cursorContainer.appendChild(cursorElement);
    }
    cursorElement.style.left = '100px';
    cursorElement.style.top = '150px';
}

let autosaveEnabled = true;
let cloudSyncEnabled = false;
setInterval(() => {
    if (autosaveEnabled) {
        const content = document.querySelector('#pageCanvas').innerHTML;
        localStorage.setItem('autosave-neuraword', content);
    }
}, 10000);

if (localStorage.getItem('autosave-neuraword')) {
    if (confirm('Restore last autosaved document?')) {
        document.querySelector('#pageCanvas').innerHTML = localStorage.getItem('autosave-neuraword');
    }
}

function handleDocumentInput(event) {
    if (autosaveEnabled) {
        console.log('Autosaving...');
    }
    if (smartComposeEnabled) {
        handleSmartCompose(event);
    }
    if (realtimeCollaborationEnabled) {
        sendDocumentChange(event);
    }
    updateLiveWordCount();
    saveVersion(); // Auto-save version
}

function updateLiveWordCount() {
    const text = document.querySelector('#pageCanvas').textContent;
    const words = text.trim().split(/\s+/).filter(w => w).length;
    document.getElementById('wordCountLive').textContent = `${words} word${words === 1 ? '' : 's'}`;
}

// Dark Mode
function toggleDarkMode() {
    document.body.classList.toggle('dark');
    localStorage.setItem('darkMode', document.body.classList.contains('dark'));
}
if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark');

// Focus Mode
function toggleFocusMode() {
    document.body.classList.toggle('focus-mode');
}

// AI Sidebar
function toggleAISidebar() {
    document.getElementById('aiSidebar').classList.toggle('active');
}
function sendToAI() {
    const prompt = document.getElementById('aiPrompt').value;
    if (!prompt) return;
    const chat = document.getElementById('aiChat');
    chat.innerHTML += `<div class="message user">${prompt}</div>`;
    setTimeout(() => {
        const responses = [
            "Here's a more concise version...",
            "Improved tone: professional yet friendly...",
            "Added three strong arguments to strengthen your point.",
            "Translated to Spanish: ..."
        ];
        const resp = responses[Math.floor(Math.random() * responses.length)];
        chat.innerHTML += `<div class="message ai">${resp}<br><button onclick="this.parentNode.remove(); insertAtCursor('${resp}')">Insert</button></div>`;
        chat.scrollTop = chat.scrollHeight;
    }, 800);
    document.getElementById('aiPrompt').value = '';
}
function insertAtCursor(text) {
    document.querySelector('#pageCanvas').focus();
    document.execCommand('insertText', false, text);
}

// Dictation
let recognition;
function startDictation() {
    if (!('webkitSpeechRecognition' in window)) return alert('Speech recognition not supported');
    recognition = new webkitSpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.onresult = e => {
        const transcript = Array.from(e.results).map(r => r[0].transcript).join('');
        document.execCommand('insertText', false, transcript);
    };
    recognition.start();
    alert('Dictation started – speak now');
}

// Read Aloud
function readAloud() {
    const text = document.querySelector('#pageCanvas').textContent;
    const utter = new SpeechSynthesisUtterance(text);
    utter.rate = 0.9;
    speechSynthesis.speak(utter);
}

// Mermaid Diagrams
function insertMermaid() {
    const code = prompt('Enter Mermaid code:', `graph TD\n    A-->B\n    A-->C`);
    if (code) {
        const div = document.createElement('div');
        div.className = 'mermaid';
        div.textContent = code;
        document.execCommand('insertHTML', false, div.outerHTML);
        mermaid.init();
    }
}

// QR Code
function insertQR() {
    const text = prompt('Enter text for QR:');
    if (text) {
        const qrDiv = document.createElement('div');
        new QRCode(qrDiv, text);
        document.execCommand('insertHTML', false, qrDiv.innerHTML);
    }
}

// Word Cloud (mock with Chart.js)
function runPlugin(name) {
    if (name === 'wordcloud') {
        const text = document.querySelector('#pageCanvas').textContent;
        alert('Word Cloud generated from text (mock)');
        // Implement actual word cloud if library added
    }
}

// Insert LaTeX
function insertLaTeX() {
    const latex = prompt('Enter LaTeX:');
    if (latex) {
        const span = document.createElement('span');
        katex.render(latex, span, { throwOnError: false });
        document.execCommand('insertHTML', false, span.outerHTML);
    }
}

// Auto Outline
function generateAutoOutline() {
    const doc = document.querySelector('#pageCanvas');
    const headings = doc.querySelectorAll('h1, h2, h3, h4, h5, h6');
    const outlineList = document.getElementById('outlineList');
    outlineList.innerHTML = '';
    headings.forEach(h => {
        const li = document.createElement('li');
        li.textContent = h.textContent;
        li.style.marginLeft = `${(parseInt(h.tagName[1]) - 1) * 10}px`;
        li.onclick = () => h.scrollIntoView({behavior: 'smooth'});
        outlineList.appendChild(li);
    });
    document.getElementById('autoOutline').classList.add('active');
}

// Pomodoro
let pomodoroInterval;
let pomodoroTime = 25 * 60;
function startPomodoro() {
    if (pomodoroInterval) clearInterval(pomodoroInterval);
    pomodoroInterval = setInterval(() => {
        pomodoroTime--;
        const min = Math.floor(pomodoroTime / 60);
        const sec = pomodoroTime % 60;
        document.getElementById('pomodoroTimer').textContent = `${min}:${sec < 10 ? '0' : ''}${sec}`;
        if (pomodoroTime <= 0) {
            clearInterval(pomodoroInterval);
            alert('Pomodoro complete!');
        }
    }, 1000);
}

// Version History
let versions = [];
function saveVersion() {
    if (versions.length > 10) versions.shift(); // Keep last 10
    versions.push({
        timestamp: new Date().toLocaleString(),
        content: document.querySelector('#pageCanvas').innerHTML
    });
}

function toggleVersionHistory() {
    const panel = document.getElementById('versionHistoryPanel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    const list = document.getElementById('versionList');
    list.innerHTML = '';
    versions.forEach((v, i) => {
        const li = document.createElement('li');
        li.textContent = v.timestamp;
        li.onclick = () => showDiff(i);
        list.appendChild(li);
    });
}

function showDiff(index) {
    const current = document.querySelector('#pageCanvas').innerHTML;
    const old = versions[index].content;
    const diff = Diff.diffChars(old, current);
    let diffHtml = '';
    diff.forEach(part => {
        const color = part.added ? 'green' : part.removed ? 'red' : 'grey';
        diffHtml += `<span style="color:${color};">${part.value}</span>`;
    });
    document.getElementById('diffContent').innerHTML = diffHtml;
    document.getElementById('diffViewer').classList.add('active');
}

// Theme Selector
function setTheme(theme) {
    document.body.classList.remove('dark', 'sepia');
    if (theme === 'dark') document.body.classList.add('dark');
    if (theme === 'sepia') document.body.classList.add('sepia');
    localStorage.setItem('theme', theme);
}
const savedTheme = localStorage.getItem('theme');
if (savedTheme) setTheme(savedTheme);

// High Contrast
function toggleHighContrast() {
    document.body.classList.toggle('high-contrast');
    if (document.body.classList.contains('high-contrast')) {
        document.body.style.filter = 'contrast(200%)';
    } else {
        document.body.style.filter = 'none';
    }
}

// Import from URL
function importFromUrl() {
    const url = document.getElementById('importUrl').value;
    if (url) {
        fetch(url)
            .then(response => response.text())
            .then(data => {
                document.querySelector('#pageCanvas').innerHTML = data;
            })
            .catch(() => alert('Failed to import'));
    }
}

// Embed Tweet, Spotify, Figma
function insertTweet() {
    const url = prompt('Enter Tweet URL:');
    if (url) document.execCommand('insertHTML', false, `<iframe src="${url}/embed"></iframe>`);
}

function insertSpotify() {
    const url = prompt('Enter Spotify URL:');
    if (url) document.execCommand('insertHTML', false, `<iframe src="${url.replace('open.spotify.com', 'embed.spotify.com')}"></iframe>`);
}

function insertFigma() {
    const url = prompt('Enter Figma URL:');
    if (url) document.execCommand('insertHTML', false, `<iframe src="${url}/embed"></iframe>`);
}

// Columns
function setColumns(num) {
    document.querySelector('#pageCanvas').style.columnCount = num;
}

// Add Voice Note to Comment
function addVoiceNote() {
    alert('Recording voice note (mock - use MediaRecorder API)');
    const note = document.createElement('span');
    note.className = 'voice-note';
    note.textContent = '[Voice Note]';
    document.execCommand('insertHTML', false, note.outerHTML);
}

// @Mentions in Comments
function insertCommentWithMention() {
    const commentText = prompt('Enter comment with @mention:');
    if (commentText && commentText.includes('@')) {
        const mention = commentText.match(/@(\w+)/)[0];
        const span = document.createElement('span');
        span.className = 'mention';
        span.textContent = mention;
        // Replace in comment
    }
}

</script>
</body>
</html>
