<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NextOS v7 Hyperion</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--th:34px;--bh:58px;--a:#00a3ff;--t:#e8f3ff;--m:#9db3cc;--p:rgba(8,14,28,.78);--b:rgba(160,198,255,.24);--s:rgba(255,255,255,.08)}
*{box-sizing:border-box;margin:0;padding:0}html,body{width:100%;height:100%}
body{font-family:"Space Grotesk",Segoe UI,sans-serif;color:var(--t);overflow:hidden;user-select:none;background:#02060f}
body:before{content:"";position:fixed;inset:0;z-index:-3;background:radial-gradient(circle at 18% 18%,rgba(0,117,255,.26),transparent 44%),radial-gradient(circle at 82% 26%,rgba(49,156,255,.24),transparent 45%),linear-gradient(145deg,#02040a,#061022 52%,#020812)}
body.light{--t:#172640;--m:#556b86;--p:rgba(255,255,255,.8);--b:rgba(52,82,123,.22);--s:rgba(17,34,58,.08)}
body.light:before{background:radial-gradient(circle at 20% 16%,rgba(130,182,255,.45),transparent 45%),radial-gradient(circle at 82% 20%,rgba(134,189,255,.42),transparent 45%),linear-gradient(145deg,#e8f3ff,#f4f9ff 52%,#e3efff)}
body.cyber{--t:#94fff5;--m:#66d5cc;--p:rgba(2,28,33,.74);--b:rgba(75,245,227,.28);--s:rgba(117,255,240,.1)}
body.cyber:before{background:radial-gradient(circle at 20% 20%,rgba(0,255,228,.15),transparent 45%),radial-gradient(circle at 80% 26%,rgba(0,220,185,.14),transparent 45%),linear-gradient(145deg,#001216,#00191d 52%,#000e11)}
button,input{font-family:inherit;color:inherit}
.glass{backdrop-filter:blur(16px) saturate(125%);-webkit-backdrop-filter:blur(16px) saturate(125%);background:var(--p);border:1px solid var(--b);box-shadow:0 12px 28px rgba(0,0,0,.35)}
#bg{position:fixed;inset:0;width:100%;height:100%;z-index:-2}
#ticker{position:fixed;inset:0 auto auto 0;width:100%;height:var(--th);display:flex;align-items:center;overflow:hidden;background:rgba(4,8,16,.72);border-bottom:1px solid var(--b);z-index:13000;font-size:12px;font-weight:700}
#tickerTxt{white-space:nowrap;padding-left:100%;animation:tk 34s linear infinite}@keyframes tk{from{transform:translateX(0)}to{transform:translateX(-100%)}}
#lock{position:fixed;inset:0;z-index:22000;display:flex;align-items:center;justify-content:center;background:linear-gradient(165deg,rgba(2,6,15,.88),rgba(0,4,12,.94));transition:opacity .45s}
#lockCard{width:min(500px,calc(100vw - 26px));border-radius:20px;padding:24px;text-align:center}
#lockTime{font-family:Orbitron,sans-serif;font-size:clamp(36px,8vw,60px);letter-spacing:2px;font-weight:700}#lockDate{margin-top:10px;color:var(--m)}
#unlock{margin-top:18px;border:1px solid rgba(140,198,255,.5);border-radius:12px;padding:10px 16px;background:linear-gradient(150deg,rgba(0,163,255,.55),rgba(0,30,60,.65));color:#eff7ff;font-weight:700;cursor:pointer}
#boot{position:fixed;inset:0;z-index:21500;display:none;opacity:0;align-items:center;justify-content:center;flex-direction:column;gap:10px;background:rgba(1,5,12,.97);color:var(--a);transition:opacity .4s}
#bootLogo{font-family:Orbitron,sans-serif;letter-spacing:7px;font-size:clamp(30px,7vw,64px);font-weight:700;animation:bp 1.7s ease-in-out infinite}@keyframes bp{0%,100%{opacity:1}50%{opacity:.58}}
#desktop{position:fixed;left:0;right:0;top:var(--th);bottom:var(--bh)}
.icon{position:absolute;width:90px;text-align:center;cursor:pointer;z-index:20}.badge{width:54px;height:54px;margin:0 auto;border-radius:14px;display:grid;place-items:center;font-size:12px;font-weight:700;color:#eef6ff;border:1px solid rgba(138,207,255,.6);background:linear-gradient(145deg,rgba(0,163,255,.48),rgba(10,32,56,.8))}.icon p{margin-top:6px;font-size:12px;font-weight:600;text-shadow:0 1px 2px rgba(0,0,0,.45)}
.panel{position:fixed;z-index:15000;display:none;border-radius:14px;padding:14px}.ph{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--m);text-transform:uppercase;letter-spacing:.4px;margin-bottom:10px}
#menu{left:12px;bottom:calc(var(--bh) + 10px);width:270px;max-height:70vh;overflow:auto}#cal{right:12px;bottom:calc(var(--bh) + 10px);width:350px}#notifs{right:12px;bottom:calc(var(--bh) + 10px);width:350px;max-height:460px}
.mi{width:100%;border:1px solid transparent;border-radius:9px;background:transparent;text-align:left;font-size:13px;font-weight:600;padding:9px;cursor:pointer}.mi:hover{background:var(--s);border-color:rgba(128,206,255,.35)}
#nList{max-height:385px;overflow:auto}.note{border:1px solid rgba(160,198,255,.3);border-radius:9px;padding:9px;margin-bottom:8px;background:rgba(255,255,255,.03)}.nt{font-size:10px;color:var(--m);margin-top:6px}
.empty{border:1px dashed var(--b);border-radius:9px;padding:9px;text-align:center;color:var(--m);font-size:12px}
#calHead{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}#month{font-family:Orbitron,sans-serif;font-size:14px;font-weight:700}
.tiny{width:28px;height:28px;border:1px solid var(--b);border-radius:8px;background:transparent;cursor:pointer}.tiny:hover{background:var(--s)}
#grid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:5px}.cd{font-size:11px;text-align:center;color:var(--m)}.dt{min-height:32px;border-radius:8px;display:grid;place-items:center;font-size:13px;background:rgba(255,255,255,.06)}.dt.a{background:rgba(0,163,255,.55);color:#f0f7ff;font-weight:700}.dt.m{color:rgba(157,179,204,.68)}
#world{margin-top:12px;border-top:1px solid var(--b);padding-top:10px;font-size:13px}.wr{display:flex;justify-content:space-between;margin-top:5px}
#cmd{position:fixed;top:10vh;left:50%;transform:translateX(-50%);width:min(620px,calc(100vw - 20px));z-index:19000;display:none;border-radius:14px;padding:12px}
#cmdIn{width:100%;border:1px solid var(--b);border-radius:10px;background:rgba(255,255,255,.05);padding:11px;font-size:14px;outline:none}#cmdRes{max-height:320px;overflow:auto;margin-top:9px}
.ci{width:100%;text-align:left;border:1px solid transparent;border-radius:9px;background:transparent;font-size:13px;font-weight:600;padding:9px;cursor:pointer}.ci:hover,.ci.a{background:var(--s);border-color:rgba(128,206,255,.35)}
.taskbar{position:fixed;left:0;bottom:0;width:100%;height:var(--bh);z-index:14000;display:flex;justify-content:space-between;align-items:center;padding:0 12px;border-top:1px solid var(--b)}
.l,.r{display:flex;align-items:center;gap:8px}.tb{min-width:42px;height:38px;border:1px solid transparent;border-radius:9px;background:transparent;font-size:12px;font-weight:700;padding:0 11px;cursor:pointer}.tb:hover{background:var(--s);border-color:rgba(128,206,255,.35)}
#start{font-family:Orbitron,sans-serif;font-size:14px;letter-spacing:1px;width:44px;padding:0}#apps{display:flex;align-items:center;gap:6px}
.chip{border:1px solid rgba(160,198,255,.32);border-radius:8px;background:var(--s);font-size:11px;font-weight:700;padding:7px 9px;cursor:pointer}.chip.a{border-color:rgba(128,206,255,.62);background:rgba(0,163,255,.22);color:#eef7ff}
#bell{min-width:84px;text-transform:uppercase;font-size:10px;letter-spacing:.6px}#count{display:inline-grid;place-items:center;min-width:18px;height:18px;padding:0 5px;border-radius:999px;margin-left:5px;background:rgba(0,163,255,.7);color:#eef7ff;font-size:10px}
#clock{border:1px solid transparent;border-radius:10px;background:transparent;text-align:right;min-width:122px;padding:6px 10px;cursor:pointer}#clock:hover{background:var(--s);border-color:rgba(128,206,255,.3)}#time{font-size:14px;font-weight:700}#date{font-size:10px;color:var(--m);margin-top:2px}
#snap{position:fixed;z-index:4600;display:none;pointer-events:none;border-radius:12px;border:2px dashed rgba(128,206,255,.8);background:rgba(0,163,255,.2);transition:all .12s}
.win{position:absolute;display:none;z-index:1000;min-width:330px;min-height:220px;border-radius:14px;overflow:hidden;background:rgba(8,14,28,.92)}
.wh{height:46px;display:flex;justify-content:space-between;align-items:center;padding:0 12px;border-bottom:1px solid var(--b);background:rgba(4,9,20,.65);cursor:grab}.wt{font-size:13px;font-weight:700}.wbs{display:flex;gap:6px}
.wb{width:27px;height:27px;border:1px solid var(--b);border-radius:7px;background:transparent;cursor:pointer}.wb:hover{background:var(--s)}.wb.c:hover{border-color:rgba(255,90,90,.6);background:rgba(255,80,80,.2);color:#ffe7e7}
.wc{height:calc(100% - 46px);overflow:auto;padding:12px}
.tf{display:flex;gap:7px;margin-bottom:10px}#taskIn{flex:1;border:1px solid var(--b);border-radius:9px;background:rgba(255,255,255,.05);padding:9px;outline:none}#taskAdd{border:1px solid rgba(128,206,255,.55);border-radius:9px;background:rgba(0,163,255,.3);color:#e9f6ff;font-weight:700;min-width:50px;cursor:pointer}
.tt{display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:9px}#taskStats{font-size:12px;color:var(--m)}.fl{display:flex;gap:6px}
.f{border:1px solid var(--b);border-radius:999px;background:transparent;font-size:11px;font-weight:700;padding:6px 9px;cursor:pointer}.f.a{border-color:rgba(128,206,255,.62);background:rgba(0,163,255,.25);color:#eef6ff}
#tasks{display:flex;flex-direction:column;gap:8px;margin-bottom:9px}.ti{display:flex;align-items:center;gap:8px;border:1px solid rgba(160,198,255,.3);border-radius:9px;padding:9px;background:rgba(255,255,255,.04)}.ti.d{opacity:.72}
.ck{width:20px;height:20px;border:1px solid rgba(128,206,255,.75);border-radius:6px;background:transparent;color:#eef6ff;font-weight:700;cursor:pointer}.ttx{flex:1;font-size:13px;line-height:1.35;word-break:break-word}.ti.d .ttx{text-decoration:line-through;color:var(--m)}
.del{border:1px solid rgba(255,120,120,.4);border-radius:8px;background:rgba(255,100,100,.12);color:#ffd7d7;font-size:11px;font-weight:700;padding:6px 8px;cursor:pointer}#clearDone{width:100%;border:1px solid var(--b);border-radius:9px;background:transparent;font-size:12px;font-weight:700;padding:8px;cursor:pointer}
#out{border:1px solid rgba(160,198,255,.3);border-radius:9px;height:calc(100% - 48px);padding:10px;overflow:auto;background:rgba(2,8,17,.8);font-family:"Courier New",Consolas,monospace;font-size:12px}body.light #out{background:rgba(245,248,255,.9)}
.ln{margin-bottom:6px;line-height:1.35;word-break:break-word}.ln.c{color:#67d0ff;font-weight:700}.ln.e{color:#ff8d8d}.ln.o{color:#7ee9b9}.ln.m{color:var(--m)}
#term{margin-top:8px;border:1px solid var(--b);border-radius:9px;padding:8px 10px;display:flex;align-items:center;gap:8px;font-family:"Courier New",Consolas,monospace;font-size:13px}#termIn{width:100%;border:none;outline:none;background:transparent}
.st{border:1px solid rgba(160,198,255,.3);border-radius:9px;padding:9px;margin-bottom:9px;background:rgba(255,255,255,.04)}.sh{font-size:12px;color:var(--m);margin-bottom:7px;text-transform:uppercase;letter-spacing:.4px}
.tr{display:flex;gap:6px}.thm{border:1px solid var(--b);border-radius:8px;background:transparent;font-size:12px;font-weight:700;padding:7px 10px;cursor:pointer}.thm.a{border-color:rgba(128,206,255,.62);background:rgba(0,163,255,.22);color:#ecf7ff}
.sr{display:flex;gap:7px;align-items:center}.sr input[type=range]{flex:1}.sv{min-width:40px;text-align:right;color:var(--m);font-size:12px}.tg{display:flex;justify-content:space-between;align-items:center;gap:8px;font-size:13px}
#reset{width:100%;border:1px solid var(--b);border-radius:9px;background:transparent;font-size:12px;font-weight:700;padding:8px;cursor:pointer}
#toasts{position:fixed;right:12px;bottom:calc(var(--bh) + 10px);width:min(340px,calc(100vw - 18px));z-index:20000;pointer-events:none}
.toast{border:1px solid rgba(160,198,255,.3);border-radius:9px;padding:9px;margin-bottom:8px;display:flex;gap:8px;align-items:center;background:rgba(8,14,28,.92);animation:ti .2s}.tgx{border:1px solid var(--b);border-radius:7px;padding:3px 6px;font-size:10px;font-weight:700;color:var(--m);text-transform:uppercase;letter-spacing:.4px;min-width:50px;text-align:center}
.toast.o .tgx{border-color:rgba(94,246,178,.55);color:#8ef0bf}.toast.e .tgx{border-color:rgba(255,130,130,.55);color:#ffb0b0}.toast.x{opacity:0;transform:translateX(10px);transition:opacity .2s,transform .2s}@keyframes ti{from{opacity:0;transform:translateX(10px)}to{opacity:1;transform:translateX(0)}}
.ui-resizable-se{width:11px!important;height:11px!important;right:4px!important;bottom:4px!important;border-radius:999px;background:rgba(0,163,255,.35)}
@media(max-width:900px){:root{--bh:56px;--th:32px}#menu,#cal,#notifs{width:calc(100vw - 18px);left:9px;right:9px}#menu{right:auto}.icon{width:84px}.badge{width:50px;height:50px}#apps{max-width:40vw;overflow:auto}.win{min-width:280px}}
</style>
<style>
.taskbar{display:grid;grid-template-columns:1fr auto 1fr}
.l{justify-content:flex-start;gap:6px}
.c{display:flex;align-items:center;justify-content:center;gap:8px;padding:0 10px}
.r{justify-content:flex-end}
#deskInd{font-size:11px;color:var(--m);padding:0 4px;white-space:nowrap}
#searchIcons{width:220px;max-width:32vw;border:1px solid var(--b);border-radius:8px;background:rgba(255,255,255,.08);padding:7px 9px;font-size:12px;outline:none}
#searchIcons::placeholder{color:var(--m)}
#toggleFmt{font-size:10px;min-width:50px}
.ctx{position:fixed;display:none;z-index:17000;min-width:180px;background:#fff;color:#111;border:1px solid #c0c0c0;border-radius:8px;box-shadow:0 10px 24px rgba(0,0,0,.24)}
.ctx ul{list-style:none;padding:6px 0}
.ctx li{padding:7px 12px;cursor:pointer;font-size:13px}
.ctx li:hover{background:#0078d7;color:#fff}
.card{position:fixed;display:none;z-index:17500;background:#fff;color:#111;border:1px solid #c0c0c0;border-radius:10px;box-shadow:0 12px 28px rgba(0,0,0,.28);padding:12px}
#downloadsModal{top:92px;right:24px;width:320px}
#settingsModal{top:96px;left:50%;transform:translateX(-50%);width:320px}
#notesModal{top:92px;right:370px;width:280px}
#chatModal{bottom:72px;left:50%;transform:translateX(-50%);width:320px;padding:0;overflow:hidden}
#chatHead{background:#0078d7;color:#fff;padding:8px 10px;display:flex;justify-content:space-between;align-items:center}
#chatClose{border:none;background:transparent;color:#fff;font-size:16px;cursor:pointer}
#chatBody{height:220px;overflow:auto;padding:10px;border-bottom:1px solid #ddd}
#chatInput{width:100%;border:none;outline:none;padding:10px}
#weather{position:fixed;top:44px;right:12px;z-index:14500;background:rgba(0,0,0,.55);color:#fff;padding:6px 10px;border-radius:6px;font-size:12px}
#shutdownOverlay{position:fixed;inset:0;z-index:21000;background:#000;color:#fff;display:none;align-items:center;justify-content:center;font-size:34px;opacity:0;transition:opacity .8s}
.downloadRow{display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid #e5e5e5;font-size:13px}
.downloadRow:last-child{border-bottom:none}
.downloadDel{border:none;background:transparent;color:#cc2222;cursor:pointer}
.entryRow{display:flex;gap:8px;margin-top:8px}
.entryRow input{flex:1;padding:6px 8px;font-size:13px}
.entryRow button{padding:6px 10px;background:#0078d7;color:#fff;border:none;border-radius:6px;cursor:pointer}
.snote{position:absolute;width:220px;min-height:90px;padding:10px;background:#fffae6;color:#111;border:1px solid #d6c890;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,.22);font-size:13px;white-space:pre-wrap;word-break:break-word;z-index:30}
#notesText{width:100%;height:140px;resize:none;padding:7px;font-size:13px}
#notesActions{display:flex;gap:8px;margin-top:8px}
#notesActions button{flex:1;padding:7px 8px;border:none;border-radius:6px;cursor:pointer}
#notesSave{background:#0078d7;color:#fff}
#notesClear{background:#ececec;color:#111}
#settingsModal label{display:block;font-size:13px;margin:8px 0}
#settingsModal button{margin-top:8px;padding:7px 10px;background:#0078d7;border:none;color:#fff;border-radius:6px;cursor:pointer}
#downloadsList{max-height:170px;overflow:auto;margin-top:8px}
#menuShutdown{margin-top:8px;background:#c93434;color:#fff}
.pin{opacity:.95}
body.light .ctx,body.light .card{background:#fff;color:#111}
.taskbar.auto-hide{transform:translateY(calc(var(--bh) - 10px));transition:transform .2s}
.taskbar.auto-hide:hover{transform:translateY(0)}
body.focus-mode #ticker,body.focus-mode #weather,body.focus-mode #toasts{opacity:.15}
body.focus-mode #desktop{filter:saturate(.75) brightness(.88)}
#labModal{top:92px;left:24px;width:340px}
#labModal h4{margin-bottom:8px}
#labModal .row{display:flex;justify-content:space-between;align-items:center;gap:8px;margin:8px 0;font-size:13px}
#labModal .row button,#labModal .row input[type=\"checkbox\"]{cursor:pointer}
#labModal .btns{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
#labModal .btns button{padding:7px 10px;background:#0078d7;color:#fff;border:none;border-radius:6px;cursor:pointer}
#pomodoro{position:fixed;right:12px;bottom:calc(var(--bh) + 12px);z-index:17600;width:190px}
#pomoTime{font-size:20px;font-weight:700;letter-spacing:.5px}
#pomoMode{font-size:11px;color:#666;margin-bottom:8px}
#pomodoro .actions{display:flex;gap:6px}
#pomodoro .actions button{flex:1;border:none;border-radius:6px;background:#0078d7;color:#fff;padding:6px 8px;font-size:12px;cursor:pointer}
#helpModal{top:92px;left:50%;transform:translateX(-50%);width:min(540px,calc(100vw - 20px))}
#helpModal h4{margin-bottom:8px}
#helpModal ul{padding-left:18px;font-size:13px;line-height:1.5}
body.light #pomoMode{color:#333}
@media(max-width:900px){.taskbar{grid-template-columns:1fr}.c{display:none}#deskInd{display:none}#searchIcons{max-width:42vw}#notesModal,#downloadsModal{left:9px;right:9px;width:auto}#weather{display:none}}
</style>
</head>
<body class="dark">
<canvas id="bg"></canvas>
<div id="ticker"><div id="tickerTxt"></div></div>
<div id="lock"><div id="lockCard" class="glass"><div id="lockTime">12:00 AM</div><div id="lockDate">Friday, February 20, 2026</div><button id="unlock">Initiate Connection</button></div></div>
<div id="boot"><div id="bootLogo">NEXTOS</div><div>Loading Hyperion core...</div></div>
<div id="snap"></div>
<div id="cmd" class="glass"><input id="cmdIn" type="text" autocomplete="off" spellcheck="false" placeholder="Search command... (Ctrl+K)"><div id="cmdRes"></div></div>
<div id="menu" class="panel glass">
  <div class="ph"><span>Start</span><span>Alt+1/2/3</span></div>
  <button class="mi" data-open="wTasks">Open Nebula Tasks</button>
  <button class="mi" data-open="wTerm">Open Terminal</button>
  <button class="mi" data-open="wSet">Open Control Center</button>
  <hr style="border:none;border-top:1px solid var(--b);margin:9px 0">
  <button class="mi" id="menuDocs">Documents</button>
  <button class="mi" id="menuDownloads">Downloads</button>
  <button class="mi" id="menuSettings">Settings</button>
  <button class="mi" id="menuNewShortcut">New Shortcut</button>
  <button class="mi" id="menuToggleTheme">Toggle Theme</button>
  <button class="mi" id="menuWallpaper">Cycle Wallpaper</button>
  <button class="mi" id="menuCmd">Open Command Palette</button>
  <button class="mi" id="menuLock">Lock Screen</button>
  <button class="mi" id="menuShutdown">Shutdown</button>
</div>
<div id="cal" class="panel glass"><div class="ph"><span>Calendar</span><span>Live</span></div><div id="calHead"><button id="calPrev" class="tiny" type="button">&lt;</button><div id="month">February 2026</div><button id="calNext" class="tiny" type="button">&gt;</button></div><div id="grid"></div><div id="world"><div style="font-size:11px;color:var(--m);text-transform:uppercase;letter-spacing:.4px">World Time</div><div class="wr"><span>Los Angeles</span><span id="la">--:--</span></div><div class="wr"><span>London</span><span id="ldn">--:--</span></div><div class="wr"><span>Tokyo</span><span id="tok">--:--</span></div></div></div>
<div id="notifs" class="panel glass"><div class="ph"><span>Notification Center</span><button id="clearN" class="tiny" type="button">C</button></div><div id="nList"></div></div>
<div id="desktop">
  <div class="icon app" id="iTasks" data-target="wTasks" data-desktop="1" style="top:76px;left:42px"><div class="badge">TSK</div><p>Nebula Tasks</p></div>
  <div class="icon app" id="iTerm" data-target="wTerm" data-desktop="1" style="top:194px;left:42px"><div class="badge">CMD</div><p>Terminal</p></div>
  <div class="icon app" id="iSet" data-target="wSet" data-desktop="1" style="top:312px;left:42px"><div class="badge">CFG</div><p>Control Center</p></div>
</div>
<div class="taskbar glass">
  <div class="l">
    <button class="tb" id="start" type="button">N</button>
    <button class="tb" id="prevDesk" type="button" title="Previous Desktop">‚óÄ</button>
    <button class="tb" id="nextDesk" type="button" title="Next Desktop">‚ñ∂</button>
    <span id="deskInd">Desktop 1</span>
    <div id="apps"></div>
  </div>
  <div class="c">
    <input id="searchIcons" type="text" placeholder="Search icons...">
    <button class="tb" id="notesBtn" type="button" title="Sticky Notes">üìù</button>
    <button class="tb" id="downloadsBtn" type="button" title="Downloads">üìÅ</button>
    <button class="tb" id="settingsBtn" type="button" title="Settings">‚öôÔ∏è</button>
    <button class="tb" id="innovateBtn" type="button" title="Innovation Lab">‚ú®</button>
  </div>
  <div class="r">
    <button class="tb" id="bell" type="button">Alerts <span id="count">0</span></button>
    <button id="clock" type="button"><div id="time">12:00 AM</div><div id="date">Feb 20, 2026</div></button>
    <button class="tb" id="toggleFmt" type="button" title="Toggle 12h/24h">24h</button>
  </div>
</div>
<div id="wTasks" class="win glass" data-title="Tasks" style="top:112px;left:300px;width:430px;height:520px"><div class="wh"><div class="wt">Nebula Tasks</div><div class="wbs"><button class="wb" data-a="min" data-id="wTasks" type="button">_</button><button class="wb c" data-a="close" data-id="wTasks" type="button">x</button></div></div><div class="wc"><div class="tf"><input id="taskIn" type="text" autocomplete="off" placeholder="Add a new objective..."><button id="taskAdd" type="button">Add</button></div><div class="tt"><div id="taskStats">0/0 complete</div><div class="fl"><button class="f a" data-f="all" type="button">All</button><button class="f" data-f="active" type="button">Active</button><button class="f" data-f="done" type="button">Done</button></div></div><div id="tasks"></div><button id="clearDone" type="button">Clear Completed</button></div></div>
<div id="wTerm" class="win glass" data-title="Terminal" style="top:146px;left:760px;width:500px;height:420px"><div class="wh"><div class="wt">Terminal</div><div class="wbs"><button class="wb" data-a="min" data-id="wTerm" type="button">_</button><button class="wb c" data-a="close" data-id="wTerm" type="button">x</button></div></div><div class="wc"><div id="out"></div><form id="term"><span>&gt;</span><input id="termIn" type="text" autocomplete="off" spellcheck="false" placeholder="Type help for commands"></form></div></div>
<div id="wSet" class="win glass" data-title="Control" style="top:194px;left:520px;width:420px;height:460px"><div class="wh"><div class="wt">Control Center</div><div class="wbs"><button class="wb" data-a="min" data-id="wSet" type="button">_</button><button class="wb c" data-a="close" data-id="wSet" type="button">x</button></div></div><div class="wc"><div class="st"><div class="sh">Theme</div><div class="tr"><button class="thm" data-th="dark" type="button">Dark</button><button class="thm" data-th="light" type="button">Light</button><button class="thm" data-th="cyber" type="button">Cyber</button></div></div><div class="st"><div class="sh">Accent Color</div><input id="accent" type="color" value="#00a3ff"></div><div class="st"><div class="sh">Particle Density</div><div class="sr"><input id="particle" type="range" min="20" max="160" step="2" value="72"><div id="particleV" class="sv">72</div></div></div><div class="st"><div class="sh">Ticker Speed</div><div class="sr"><input id="speed" type="range" min="18" max="60" step="1" value="34"><div id="speedV" class="sv">34s</div></div></div><div class="st"><div class="sh">Motion</div><div class="tg"><span>Reduce animations</span><input id="motion" type="checkbox"></div></div><button id="reset" type="button">Reset Window and Icon Layout</button></div></div>
<div id="deskCtx" class="ctx">
  <ul>
    <li id="ctxNewShortcut">New Shortcut</li>
    <li id="ctxBg">Change Background</li>
  </ul>
</div>
<div id="iconCtx" class="ctx">
  <ul>
    <li id="ctxPin">Pin to Taskbar</li>
    <li id="ctxRename">Rename</li>
    <li id="ctxDelete">Delete Icon</li>
  </ul>
</div>
<div id="downloadsModal" class="card">
  <h4>Downloads / Documents</h4>
  <div id="downloadsList"></div>
  <div class="entryRow">
    <input id="downloadInput" type="text" placeholder="New file name">
    <button id="downloadAdd" type="button">Add</button>
  </div>
</div>
<div id="settingsModal" class="card">
  <h4>Settings</h4>
  <label><input type="checkbox" id="soundToggle"> Enable sound</label>
  <label><input type="checkbox" id="voiceToggle"> Enable voice notifications</label>
  <button id="clearDataBtn" type="button">Clear All App Data</button>
</div>
<div id="notesModal" class="card">
  <h4>Sticky Note</h4>
  <textarea id="notesText" placeholder="Type your note here..."></textarea>
  <div id="notesActions">
    <button id="notesSave" type="button">Save Note</button>
    <button id="notesClear" type="button">Clear All</button>
  </div>
</div>
<div id="chatModal" class="card">
  <div id="chatHead"><span>Virtual Assistant</span><button id="chatClose" type="button">‚úñ</button></div>
  <div id="chatBody"></div>
  <input id="chatInput" type="text" placeholder="Type a message...">
</div>
<div id="labModal" class="card">
  <h4>Innovation Lab</h4>
  <div class="row"><span>Focus Mode</span><input id="focusToggle" type="checkbox"></div>
  <div class="row"><span>Auto-hide Taskbar</span><input id="autoHideToggle" type="checkbox"></div>
  <div class="row"><span>Ambient Chime</span><input id="ambientToggle" type="checkbox"></div>
  <div class="btns">
    <button id="saveSnapBtn" type="button">Save Snapshot</button>
    <button id="restoreSnapBtn" type="button">Restore Snapshot</button>
    <button id="exportDataBtn" type="button">Export Data</button>
    <button id="importDataBtn" type="button">Import Data</button>
  </div>
</div>
<div id="pomodoro" class="card">
  <div id="pomoTime">25:00</div>
  <div id="pomoMode">Focus session</div>
  <div class="actions">
    <button id="pomoStart" type="button">Start</button>
    <button id="pomoPause" type="button">Pause</button>
    <button id="pomoReset" type="button">Reset</button>
  </div>
</div>
<div id="helpModal" class="card">
  <h4>Keyboard Shortcuts</h4>
  <ul>
    <li><strong>Ctrl+K</strong>: Command palette</li>
    <li><strong>Ctrl+Shift+C</strong>: Chat assistant</li>
    <li><strong>F2</strong>: Settings modal</li>
    <li><strong>Alt+1 / Alt+2 / Alt+3</strong>: Open core apps</li>
    <li><strong>Ctrl+.</strong>: Innovation Lab</li>
    <li><strong>?</strong>: Toggle this shortcuts panel</li>
  </ul>
</div>
<div id="weather">Weather: Loading...</div>
<div id="shutdownOverlay">Shutting Down...</div>
<div id="toasts"></div>
<audio id="clickSfx" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="sUnlock" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="sSnap" src="https://actions.google.com/sounds/v1/foley/drawbridge_chain_drop.ogg"></audio>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<script>
(()=>{
const K="nextos_hyperion_state_v1",LEG="supernova_tasks",TH=["dark","light","cyber"],DY=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],AP=["wTasks","wTerm","wSet"];
const hist=[];let hi=-1;const cl=(n,a,b)=>Math.max(a,Math.min(b,n));const uid=p=>`${p}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;const hx=v=>/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(String(v||"").trim());const tk=(t,d=false,i)=>({id:i||uid("task"),text:String(t||"").trim(),done:!!d});
const nTasks=a=>Array.isArray(a)?a.map(x=>typeof x==="string"?tk(x):(x&&typeof x.text==="string"?tk(x.text,x.done,x.id):null)).filter(x=>x&&x.text):[];
function load(){let r={},l=[];try{r=JSON.parse(localStorage.getItem(K)||"{}")}catch(_){r={}}try{l=JSON.parse(localStorage.getItem(LEG)||"[]")}catch(_){l=[]}const st=nTasks(r.tasks),mg=nTasks(l);return{th:TH.includes(r.th)?r.th:"dark",ac:hx(r.ac)?r.ac:"#00a3ff",pc:cl(Number(r.pc)||72,20,160),sp:cl(Number(r.sp)||34,18,60),rm:!!r.rm,tasks:st.length?st:(mg.length?mg:[tk("Complete Hyperion upgrade"),tk("Try Ctrl+K command palette"),tk("Review Control Center settings",true)]),ic:r.ic&&typeof r.ic==="object"?r.ic:{},wn:r.wn&&typeof r.wn==="object"?r.wn:{},ns:Array.isArray(r.ns)?r.ns.filter(n=>n&&typeof n.m==="string").slice(-60):[]}}
const OS={v:"7.0.0",z:1200,f:"all",start:Date.now(),cal:(()=>{const d=new Date();return new Date(d.getFullYear(),d.getMonth(),1)})(),sm:null,pts:[],ms:{x:-1e3,y:-1e3},cm:[],ci:0,s:load()};
const save=()=>localStorage.setItem(K,JSON.stringify(OS.s));
const px=(k,d)=>{const n=parseInt(getComputedStyle(document.documentElement).getPropertyValue(k),10);return Number.isFinite(n)?n:d};
const area=()=>{const t=px("--th",34),b=px("--bh",58);return{top:t,left:0,width:innerWidth,height:Math.max(220,innerHeight-t-b)}};
const play=id=>{if(localStorage.getItem("soundEnabled")==="false")return;const e=document.getElementById(id);if(!e)return;e.currentTime=0;const p=e.play();if(p&&p.catch)p.catch(()=>{})};
const zt=(d,z)=>{try{return new Intl.DateTimeFormat([],{hour:"2-digit",minute:"2-digit",hour12:true,timeZone:z}).format(d)}catch(_){return"--:--"}};
function toast(msg,t="info",p=true){const m=String(msg||"").trim();if(!m)return;if(p){OS.s.ns.push({id:uid("n"),m, t,at:new Date().toISOString()});OS.s.ns=OS.s.ns.slice(-60);save()}if(localStorage.getItem("voiceEnabled")==="true"&&"speechSynthesis"in window){try{const u=new SpeechSynthesisUtterance(m);speechSynthesis.cancel();speechSynthesis.speak(u)}catch(_){}}rN();const $t=$("<div class='toast glass'></div>").addClass(t==="success"?"o":(t==="error"?"e":""));$t.append($("<span class='tgx'></span>").text(t.toUpperCase()));$t.append($("<span></span>").text(m));$("#toasts").append($t);setTimeout(()=>{$t.addClass("x");setTimeout(()=>$t.remove(),220)},4200)}
function rN(){const $l=$("#nList").empty(),ns=[...OS.s.ns].reverse();if(!ns.length){$l.append($("<div class='empty'></div>").text("No alerts yet."));$("#count").text("0");return}ns.forEach(n=>{const $c=$("<div class='note'></div>");$c.append($("<div></div>").text(n.m));$c.append($("<div class='nt'></div>").text(new Date(n.at||Date.now()).toLocaleString()));$l.append($c)});$("#count").text(String(OS.s.ns.length))}
function apply(){document.body.className=OS.s.th;document.documentElement.style.setProperty("--a",OS.s.ac);$("#accent").val(OS.s.ac);$("#particle").val(String(OS.s.pc));$("#particleV").text(String(OS.s.pc));$("#speed").val(String(OS.s.sp));$("#speedV").text(`${OS.s.sp}s`);$("#motion").prop("checked",OS.s.rm);$(".thm").removeClass("a");$(`.thm[data-th='${OS.s.th}']`).addClass("a");$("#tickerTxt").css("animation-duration",`${OS.s.sp}s`);save()}
function setTh(th,s=false){if(!TH.includes(th))return false;OS.s.th=th;apply();if(!s)toast(`Theme switched to ${th}.`,`success`);return true}
function setAc(c,s=false){if(!hx(c))return false;OS.s.ac=c;apply();if(!s)toast(`Accent updated to ${c}.`,`success`);return true}
function tick(){const tot=OS.s.tasks.length,done=OS.s.tasks.filter(t=>t.done).length,w=$(".win:visible").length;$("#tickerTxt").text([`NEXTOS v${OS.v} Hyperion online`,`${done}/${tot} objectives complete`,`${w} windows active`,`Ctrl+K opens command palette`,`Alt+1 Alt+2 Alt+3 launch apps`].join("   |   "))}
function clk(){const n=new Date(),u24=localStorage.getItem("use24Hour")==="true";$("#time").text(n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!u24}));$("#date").text(n.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"}));$("#lockTime").text(n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!u24}));$("#lockDate").text(n.toLocaleDateString([],{weekday:"long",month:"long",day:"numeric",year:"numeric"}));$("#la").text(zt(n,"America/Los_Angeles"));$("#ldn").text(zt(n,"Europe/London"));$("#tok").text(zt(n,"Asia/Tokyo"))}
function cal(){const y=OS.cal.getFullYear(),m=OS.cal.getMonth(),f=new Date(y,m,1).getDay(),dm=new Date(y,m+1,0).getDate(),pm=new Date(y,m,0).getDate();$("#month").text(OS.cal.toLocaleDateString([],{month:"long",year:"numeric"}));const $g=$("#grid").empty();DY.forEach(d=>$g.append($("<div class='cd'></div>").text(d)));for(let i=f-1;i>=0;i--)$g.append($("<div class='dt m'></div>").text(String(pm-i)));const n=new Date();for(let d=1;d<=dm;d++){const $c=$("<div class='dt'></div>").text(String(d));if(d===n.getDate()&&m===n.getMonth()&&y===n.getFullYear())$c.addClass("a");$g.append($c)}const u=f+dm,tail=(7-(u%7))%7;for(let d=1;d<=tail;d++)$g.append($("<div class='dt m'></div>").text(String(d)))}
const tv=()=>OS.f==="active"?OS.s.tasks.filter(t=>!t.done):OS.f==="done"?OS.s.tasks.filter(t=>t.done):OS.s.tasks;
function rT(){const $l=$("#tasks").empty(),ts=tv();if(!ts.length)$l.append($("<div class='empty'></div>").text("No tasks in this view."));ts.forEach(t=>{const $i=$("<div class='ti'></div>").attr("data-id",t.id);if(t.done)$i.addClass("d");const $c=$("<button class='ck' type='button'></button>").text(t.done?"x":"");const $x=$("<span class='ttx'></span>").text(t.text);const $d=$("<button class='del' type='button'>Del</button>");$c.on("click",()=>tgT(t.id));$d.on("click",()=>delT(t.id));$i.append($c,$x,$d);$l.append($i)});const tot=OS.s.tasks.length,done=OS.s.tasks.filter(t=>t.done).length;$("#taskStats").text(`${done}/${tot} complete`)}
function addT(v){const t=String(v||"").trim();if(!t)return false;OS.s.tasks.unshift(tk(t));save();rT();tick();toast(`Task added: ${t}`);return true}
function tgT(id){const t=OS.s.tasks.find(x=>x.id===id);if(!t)return;t.done=!t.done;save();rT();tick()}
function delT(id){OS.s.tasks=OS.s.tasks.filter(t=>t.id!==id);save();rT();tick()}
function clrDone(){const b=OS.s.tasks.length;OS.s.tasks=OS.s.tasks.filter(t=>!t.done);const r=b-OS.s.tasks.length;save();rT();tick();if(r)toast(`Cleared ${r} completed task${r===1?"":"s"}.`)}
function setF(f){if(!["all","active","done"].includes(f))return;OS.f=f;$(".f").removeClass("a");$(`.f[data-f='${f}']`).addClass("a");rT()}
function ln(t,c=""){const $l=$("<div class='ln'></div>").text(String(t));if(c)$l.addClass(c);$("#out").append($l);const n=$("#out").get(0);if(n)n.scrollTop=n.scrollHeight}
const dur=ms=>{const s=Math.floor(ms/1000),h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sc=s%60;return`${h}h ${m}m ${sc}s`};
function run(v){const i=String(v||"").trim();if(!i)return;ln(`> ${i}`,"c");const [tk,...rs]=i.split(" "),cmd=tk.toLowerCase(),arg=rs.join(" ").trim();if(cmd==="help"){ln("help, clear, date, theme <name>, accent <#hex>, open <tasks|terminal|settings>");ln("tasks, addtask <text>, notify <text>, particle <20-160>, motion <on|off>, uptime");return}
if(cmd==="clear"){$("#out").empty();return}
if(cmd==="date"){ln(new Date().toString());return}
if(cmd==="theme"){if(!arg){ln(`Current theme: ${OS.s.th}`);return}if(setTh(arg.toLowerCase(),true)){ln(`Theme updated to ${arg.toLowerCase()}`,"o");toast(`Theme switched to ${arg.toLowerCase()}.`,`success`);tick()}else ln("Invalid theme. Use dark, light, or cyber.","e");return}
if(cmd==="accent"){if(!arg){ln(`Current accent: ${OS.s.ac}`);return}if(setAc(arg,true)){ln(`Accent updated to ${arg}`,"o");toast(`Accent updated to ${arg}.`,`success`)}else ln("Invalid color. Example: accent #00a3ff","e");return}
if(cmd==="open"){const m={tasks:"wTasks",task:"wTasks",terminal:"wTerm",settings:"wSet",control:"wSet"},id=m[arg.toLowerCase()];if(id){open(id);ln(`Opened ${arg}`,"o")}else ln("Use open tasks, open terminal, or open settings.","e");return}
if(cmd==="tasks"){const d=OS.s.tasks.filter(t=>t.done).length;ln(`${d}/${OS.s.tasks.length} complete`);OS.s.tasks.slice(0,5).forEach(t=>ln(`- [${t.done?"x":" "}] ${t.text}`,"m"));return}
if(cmd==="addtask"){if(!arg){ln("Usage: addtask <text>","e");return}addT(arg);ln("Task added","o");return}
if(cmd==="notify"){if(!arg){ln("Usage: notify <text>","e");return}toast(arg);ln("Notification sent","o");return}
if(cmd==="particle"){const n=Number(arg);if(!Number.isFinite(n)){ln("Usage: particle <20-160>","e");return}OS.s.pc=cl(Math.round(n),20,160);$("#particle").val(String(OS.s.pc));$("#particleV").text(String(OS.s.pc));mkPts();save();ln(`Particle count set to ${OS.s.pc}`,"o");return}
if(cmd==="motion"){const x=arg.toLowerCase();if(x!=="on"&&x!=="off"){ln("Usage: motion <on|off>","e");return}OS.s.rm=x==="on";$("#motion").prop("checked",OS.s.rm);save();ln(`Reduced motion ${OS.s.rm?"enabled":"disabled"}`,"o");return}
if(cmd==="uptime"){ln(`Session uptime: ${dur(Date.now()-OS.start)}`);return}
ln(`Unknown command: ${cmd}`,"e")}
function defs(){return[{l:"Open Nebula Tasks",k:"task open app",r:()=>open("wTasks")},{l:"Open Terminal",k:"terminal open shell",r:()=>open("wTerm")},{l:"Open Control Center",k:"settings open control",r:()=>open("wSet")},{l:"Switch Theme: Dark",k:"theme dark",r:()=>setTh("dark")},{l:"Switch Theme: Light",k:"theme light",r:()=>setTh("light")},{l:"Switch Theme: Cyber",k:"theme cyber",r:()=>setTh("cyber")},{l:"Open Calendar",k:"calendar date",r:()=>tPanel("#cal")},{l:"Lock Screen",k:"lock security",r:()=>lock()}]}
function rCmd(q){const x=String(q||"").trim().toLowerCase(),ar=defs();OS.cm=x?ar.filter(c=>(`${c.l} ${c.k}`).toLowerCase().includes(x)):ar;OS.ci=0;const $l=$("#cmdRes").empty();if(!OS.cm.length){$l.append($("<div class='empty'></div>").text("No matching commands."));return}OS.cm.forEach((c,i)=>{const $b=$("<button class='ci' type='button'></button>").attr("data-i",String(i)).text(c.l);if(i===0)$b.addClass("a");$b.on("click",()=>xCmd(i));$l.append($b)})}
const sCmd=()=>{$(".ci").removeClass("a");$(`.ci[data-i='${OS.ci}']`).addClass("a")};
function xCmd(i){const c=OS.cm[i];if(!c)return;closeCmd();c.r();toast(`Executed: ${c.l}`,"info",false)}
function openCmd(){hideP();$("#cmd").fadeIn(120);$("#cmdIn").val("");rCmd("");setTimeout(()=>$("#cmdIn").trigger("focus"),0)}
const closeCmd=()=>$("#cmd").hide();const hideP=()=>$("#menu,#cal,#notifs").hide();
function tPanel(sel){const $p=$(sel),sh=!$p.is(":visible");hideP();if(sh)$p.fadeIn(120)}
function saveW($w){const id=$w.attr("id");if(!id)return;const p=$w.position();OS.s.wn[id]={top:Math.round(p.top),left:Math.round(p.left),width:Math.round($w.outerWidth()),height:Math.round($w.outerHeight())};save()}
function fit($w){const a=area();let w=Math.round($w.outerWidth()),h=Math.round($w.outerHeight());w=Math.min(w,a.width);h=Math.min(h,a.height);let l=$w.position().left,t=$w.position().top;l=cl(l,a.left,a.left+a.width-w);t=cl(t,a.top,a.top+a.height-h);$w.css({width:w,height:h,left:l,top:t})}
function shSnap(m){const a=area(),s={display:"block"};if(m==="left"){s.top=a.top;s.left=a.left;s.width=Math.floor(a.width/2);s.height=a.height}else if(m==="right"){s.top=a.top;s.left=a.left+Math.floor(a.width/2);s.width=Math.ceil(a.width/2);s.height=a.height}else if(m==="max"){s.top=a.top;s.left=a.left;s.width=a.width;s.height=a.height}$("#snap").css(s)}
function hdSnap(){$("#snap").hide();OS.sm=null}
function dSnap($w,ui){const a=area(),m=26,l=ui.position.left,t=ui.position.top,r=l+$w.outerWidth();let md=null;if(l<=a.left+m)md="left";else if(r>=a.left+a.width-m)md="right";else if(t<=a.top+m)md="max";OS.sm=md;if(md)shSnap(md);else hdSnap()}
function apSnap($w,m){const a=area();if(m==="left")$w.css({top:a.top,left:a.left,width:Math.floor(a.width/2),height:a.height});else if(m==="right")$w.css({top:a.top,left:a.left+Math.floor(a.width/2),width:Math.ceil(a.width/2),height:a.height});else if(m==="max")$w.css({top:a.top,left:a.left,width:a.width,height:a.height});saveW($w);play("sSnap")}
function chip(id){if($(`#apps .chip[data-id='${id}']`).length)return;const t=$(`#${id}`).data("title")||id,$b=$("<button class='chip' type='button'></button>").attr("data-id",id).text(String(t));$b.on("click",()=>{const $w=$(`#${id}`);if($w.is(":visible")&&$b.hasClass("a"))min(id);else open(id)});$("#apps").append($b)}
const aChip=id=>{$("#apps .chip").removeClass("a");if(id)$(`#apps .chip[data-id='${id}']`).addClass("a")};
function focus(id){const $w=$(`#${id}`);if(!$w.length)return;OS.z+=1;$w.css("z-index",OS.z);aChip(id)}
function open(id){const $w=$(`#${id}`);if(!$w.length)return;chip(id);$w.stop(true,true).fadeIn(120);fit($w);focus(id);tick()}
function min(id){const $w=$(`#${id}`);if(!$w.length)return;$w.stop(true,true).fadeOut(90,()=>{aChip(null);tick()})}
function close(id){const $w=$(`#${id}`);if(!$w.length)return;$w.stop(true,true).fadeOut(90,()=>{$(`#apps .chip[data-id='${id}']`).remove();aChip(null);tick()})}
function saveI($i){const id=$i.attr("id");if(!id)return;const a=area(),w=$i.outerWidth(),h=$i.outerHeight(),p=$i.position(),l=cl(p.left,a.left,a.left+a.width-w),t=cl(p.top,a.top,a.top+a.height-h);$i.css({left:l,top:t});OS.s.ic[id]={left:Math.round(l),top:Math.round(t)};save()}
function restore(){$(".icon").each((_,e)=>{const p=OS.s.ic[e.id];if(p)$(e).css({left:p.left,top:p.top})});$(".win").each((_,e)=>{const p=OS.s.wn[e.id];if(p)$(e).css({left:p.left,top:p.top,width:p.width,height:p.height})})}
function initW(){$(".win").each((_,e)=>{const $w=$(e),id=e.id;$w.draggable({handle:".wh",containment:"window",start:()=>focus(id),drag:(_e,ui)=>dSnap($w,ui),stop:()=>{if(OS.sm)apSnap($w,OS.sm);else{fit($w);saveW($w)}hdSnap()}}).resizable({minWidth:320,minHeight:220,stop:()=>{fit($w);saveW($w)}});$w.on("mousedown",()=>focus(id))})}
function initI(){$(".icon").draggable({containment:"window",start:(_e,ui)=>ui.helper.data("drag",true),stop:(_e,ui)=>{saveI(ui.helper);setTimeout(()=>ui.helper.data("drag",false),0)}});$(".app").on("click",function(){const $i=$(this);if($i.data("drag"))return;open($i.data("target"))})}
const cv=document.getElementById("bg"),cx=cv.getContext("2d");
function sz(){cv.width=innerWidth;cv.height=innerHeight}
function mkPts(){OS.pts=[];for(let i=0;i<OS.s.pc;i++)OS.pts.push({x:Math.random()*cv.width,y:Math.random()*cv.height,vx:(Math.random()-.5)*.35,vy:(Math.random()-.5)*.35})}
function draw(){cx.clearRect(0,0,cv.width,cv.height);const p=OS.pts;for(let i=0;i<p.length;i++){const a=p[i];if(!OS.s.rm){const dx=a.x-OS.ms.x,dy=a.y-OS.ms.y,dm=Math.hypot(dx,dy);if(dm<140&&dm>0){a.vx+=(dx/dm)*.01;a.vy+=(dy/dm)*.01}a.vx*=.985;a.vy*=.985;a.x+=a.vx;a.y+=a.vy}if(a.x<0||a.x>cv.width){a.vx*=-1;a.x=cl(a.x,0,cv.width)}if(a.y<0||a.y>cv.height){a.vy*=-1;a.y=cl(a.y,0,cv.height)}cx.beginPath();cx.fillStyle="rgba(190,230,255,.58)";cx.arc(a.x,a.y,1.9,0,Math.PI*2);cx.fill();for(let j=i+1;j<p.length;j++){const b=p[j],d=Math.hypot(a.x-b.x,a.y-b.y);if(d<125){const al=.12*(1-d/125);cx.strokeStyle=`rgba(180,220,255,${al})`;cx.lineWidth=1;cx.beginPath();cx.moveTo(a.x,a.y);cx.lineTo(b.x,b.y);cx.stroke()}}}requestAnimationFrame(draw)}
function lock(){hideP();closeCmd();$("#lock").show().css({opacity:1,pointerEvents:"auto"})}
function unlock(){$("#lock").css({opacity:0,pointerEvents:"none"});setTimeout(()=>$("#lock").hide(),440);play("sUnlock");const $b=$("#boot");$b.css({display:"flex",opacity:1});setTimeout(()=>{$b.css("opacity",0);setTimeout(()=>{$b.hide();toast(`NextOS ${OS.v} ready. Press Ctrl+K for commands.`,`success`,false)},420)},1600)}
function bind(){$("#unlock").on("click",unlock);$("#start").on("click",e=>{e.stopPropagation();tPanel("#menu")});$("#clock").on("click",e=>{e.stopPropagation();tPanel("#cal")});$("#bell").on("click",e=>{e.stopPropagation();tPanel("#notifs")});$("#menu,#cal,#notifs,#cmd").on("click",e=>e.stopPropagation());$(document).on("click",()=>{hideP();closeCmd()});
$("#menuCmd").on("click",()=>{hideP();openCmd()});$("#menuLock").on("click",()=>lock());$("#menu [data-open]").on("click",function(){open($(this).data("open"));hideP()});$("#calPrev").on("click",()=>{OS.cal.setMonth(OS.cal.getMonth()-1);cal()});$("#calNext").on("click",()=>{OS.cal.setMonth(OS.cal.getMonth()+1);cal()});$("#clearN").on("click",()=>{OS.s.ns=[];save();rN()});
$("#taskAdd").on("click",()=>{if(addT($("#taskIn").val()))$("#taskIn").val("").trigger("focus")});$("#taskIn").on("keydown",e=>{if(e.key==="Enter"){e.preventDefault();if(addT($("#taskIn").val()))$("#taskIn").val("")}});$(".f").on("click",function(){setF($(this).data("f"))});$("#clearDone").on("click",clrDone);
$(document).on("click",".wb",function(e){e.stopPropagation();const id=$(this).data("id"),a=$(this).data("a");if(a==="close")close(id);else min(id)});
$("#term").on("submit",e=>{e.preventDefault();const v=$("#termIn").val();if(!String(v||"").trim())return;hist.push(v);hi=hist.length;run(v);$("#termIn").val("")});$("#termIn").on("keydown",e=>{if(!hist.length)return;if(e.key==="ArrowUp"){e.preventDefault();hi=cl(hi-1,0,hist.length-1);$("#termIn").val(hist[hi])}else if(e.key==="ArrowDown"){e.preventDefault();hi=cl(hi+1,0,hist.length);if(hi>=hist.length)$("#termIn").val("");else $("#termIn").val(hist[hi])}});
$("#cmdIn").on("input",function(){rCmd($(this).val())});$("#cmdIn").on("keydown",e=>{if(e.key==="ArrowDown"){e.preventDefault();if(!OS.cm.length)return;OS.ci=(OS.ci+1)%OS.cm.length;sCmd()}else if(e.key==="ArrowUp"){e.preventDefault();if(!OS.cm.length)return;OS.ci=(OS.ci-1+OS.cm.length)%OS.cm.length;sCmd()}else if(e.key==="Enter"){e.preventDefault();xCmd(OS.ci)}else if(e.key==="Escape")closeCmd()});
$(".thm").on("click",function(){const t=String($(this).data("th"));if(setTh(t))tick()});$("#accent").on("input",function(){const v=String($(this).val());if(hx(v)){OS.s.ac=v;apply()}});$("#particle").on("input",function(){OS.s.pc=cl(Number($(this).val()),20,160);$("#particleV").text(String(OS.s.pc));mkPts();save()});$("#speed").on("input",function(){OS.s.sp=cl(Number($(this).val()),18,60);$("#speedV").text(`${OS.s.sp}s`);$("#tickerTxt").css("animation-duration",`${OS.s.sp}s`);save()});$("#motion").on("change",function(){OS.s.rm=!!$(this).prop("checked");save()});
$("#reset").on("click",()=>{OS.s.ic={};OS.s.wn={};save();toast("Layout reset. Reloading...","info",false);setTimeout(()=>location.reload(),250)});
$(document).on("keydown",e=>{if(e.ctrlKey&&e.key.toLowerCase()==="k"){e.preventDefault();openCmd();return}if(e.key==="Escape"){hideP();closeCmd();return}const tag=String(e.target.tagName||"").toLowerCase();if(tag==="input"||tag==="textarea")return;if(e.altKey){if(e.key==="1")open("wTasks");else if(e.key==="2")open("wTerm");else if(e.key==="3")open("wSet")}});
$("#desktop").on("mousemove",e=>{OS.ms.x=e.clientX;OS.ms.y=e.clientY}).on("mouseleave",()=>{OS.ms.x=-1e3;OS.ms.y=-1e3});$(window).on("resize",()=>{sz();mkPts();$(".win:visible").each((_,e)=>{const $w=$(e);fit($w);saveW($w)})})}
function init(){restore();initW();initI();bind();apply();rN();setF("all");cal();clk();tick();ln(`NextOS Terminal ${OS.v}`,"o");ln("Type help for command list.","m");ln("Hint: open tasks, theme cyber, or notify hello","m");setInterval(clk,1000);setInterval(tick,20000);sz();mkPts();requestAnimationFrame(draw);AP.forEach(id=>fit($(`#${id}`)))}
init();
})();
</script>
<script>
(() => {
  const SHORTCUTS_KEY = "desktopShortcuts";
  const NOTES_KEY = "stickyNotes";
  const ITEMS_KEY = "storageItems";
  const DESKTOP_KEY = "currentDesktop";
  const WALL_KEY = "desktopWallpaper";
  const WALL_INDEX_KEY = "wallpaperIndex";
  const WALLS = [
    "https://picsum.photos/id/1018/1920/1080",
    "https://picsum.photos/id/1015/1920/1080",
    "https://picsum.photos/id/1019/1920/1080"
  ];
  const BOT = [
    "Hello. How can I assist you today?",
    "I can help with shortcuts, notes, and settings.",
    "Try right-click on desktop for more actions.",
    "You can use Ctrl+Shift+C to open this assistant."
  ];

  let currentDesktop = parseInt(localStorage.getItem(DESKTOP_KEY) || "1", 10);
  if (!Number.isFinite(currentDesktop) || currentDesktop < 1) currentDesktop = 1;
  let selectedIconId = null;

  function safeJson(key, fallback) {
    try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
    catch (_) { return fallback; }
  }

  function speak(msg) {
    if (localStorage.getItem("voiceEnabled") !== "true") return;
    if (!("speechSynthesis" in window)) return;
    try {
      const u = new SpeechSynthesisUtterance(msg);
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    } catch (_) {}
  }

  function clickFx() {
    if (localStorage.getItem("soundEnabled") === "false") return;
    const audio = document.getElementById("clickSfx");
    if (!audio) return;
    try {
      audio.currentTime = 0;
      const p = audio.play();
      if (p && p.catch) p.catch(() => {});
    } catch (_) {}
  }

  function notify(msg, type) {
    const $t = $("<div class='toast glass'></div>").addClass(type === "error" ? "e" : (type === "success" ? "o" : ""));
    $t.append($("<span class='tgx'></span>").text((type || "info").toUpperCase()));
    $t.append($("<span></span>").text(msg));
    $("#toasts").append($t);
    speak(msg);
    setTimeout(() => {
      $t.addClass("x");
      setTimeout(() => $t.remove(), 220);
    }, 3200);
  }

  function normalizeIconDesktop() {
    $(".icon").each((_, el) => {
      if (!$(el).attr("data-desktop")) $(el).attr("data-desktop", "1");
    });
  }

  function visibleBySearch($el) {
    const term = ($("#searchIcons").val() || "").toLowerCase().trim();
    if (!term) return true;
    return ($el.find("p").first().text() || "").toLowerCase().includes(term);
  }

  function applyDesktopVisibility() {
    normalizeIconDesktop();
    $(".icon").each((_, el) => {
      const $el = $(el);
      const sameDesktop = String($el.attr("data-desktop")) === String(currentDesktop);
      $el.toggle(sameDesktop && visibleBySearch($el));
    });
    $(".snote").each((_, el) => {
      const $el = $(el);
      const sameDesktop = String($el.attr("data-desktop")) === String(currentDesktop);
      $el.toggle(sameDesktop);
    });
    $("#deskInd").text(`Desktop ${currentDesktop}`);
    localStorage.setItem(DESKTOP_KEY, String(currentDesktop));
  }

  function nextDesktop() {
    currentDesktop += 1;
    applyDesktopVisibility();
    notify(`Switched to Desktop ${currentDesktop}`);
  }

  function prevDesktop() {
    if (currentDesktop <= 1) return;
    currentDesktop -= 1;
    applyDesktopVisibility();
    notify(`Switched to Desktop ${currentDesktop}`);
  }

  function getShortcuts() { return safeJson(SHORTCUTS_KEY, []); }
  function setShortcuts(data) { localStorage.setItem(SHORTCUTS_KEY, JSON.stringify(data)); }

  function makeShortcutElement(shortcut) {
    const $icon = $("<div class='icon shortcut'></div>")
      .attr("id", shortcut.id)
      .attr("data-id", shortcut.id)
      .attr("data-desktop", String(shortcut.desktop || 1))
      .css({ top: `${shortcut.top || 50}px`, left: `${shortcut.left || 50}px` });

    const $link = $("<a></a>").attr("href", shortcut.url).attr("target", "_blank");
    $("<img>")
      .attr("src", shortcut.icon || "https://dummyimage.com/64x64/0078d7/ffffff&text=New")
      .attr("alt", shortcut.name || "Shortcut")
      .attr("onerror", "this.onerror=null;this.src='https://twemoji.maxcdn.com/v/latest/svg/1f4c1.svg'")
      .appendTo($link);
    $("<p></p>").text(shortcut.name || "Shortcut").appendTo($link);
    $icon.append($link).appendTo("#desktop");

    $icon.draggable({
      containment: "#desktop",
      stop: (_e, ui) => {
        const items = getShortcuts();
        const idx = items.findIndex((x) => x.id === shortcut.id);
        if (idx >= 0) {
          items[idx].top = Math.round(ui.position.top);
          items[idx].left = Math.round(ui.position.left);
          setShortcuts(items);
        }
      }
    });

    return $icon;
  }

  function restoreShortcuts() {
    const shortcuts = getShortcuts();
    shortcuts.forEach((s) => makeShortcutElement(s));
  }

  function createShortcutPrompt() {
    const url = prompt("Enter URL for new shortcut:");
    if (!url || !url.trim()) return;
    const name = (prompt("Enter shortcut name:", "New Shortcut") || "New Shortcut").trim();
    const icon = (prompt("Enter icon image URL:", "https://dummyimage.com/64x64/0078d7/ffffff&text=New") || "").trim();
    const id = `shortcut_${Date.now()}`;
    const item = { id, url: url.trim(), name, icon, desktop: currentDesktop, top: 60, left: 60 };
    const all = getShortcuts();
    all.push(item);
    setShortcuts(all);
    makeShortcutElement(item);
    applyDesktopVisibility();
    notify("New shortcut created", "success");
  }

  function loadItems() { return safeJson(ITEMS_KEY, []); }
  function saveItems(items) { localStorage.setItem(ITEMS_KEY, JSON.stringify(items)); }

  function renderItems() {
    const items = loadItems();
    const $list = $("#downloadsList").empty();
    if (!items.length) {
      $list.append($("<div class='empty'></div>").text("No items yet."));
      return;
    }
    items.forEach((name, i) => {
      const $row = $("<div class='downloadRow'></div>");
      $row.append($("<span></span>").text(name));
      const $del = $("<button class='downloadDel' type='button'>‚úñ</button>");
      $del.on("click", () => {
        const next = loadItems();
        next.splice(i, 1);
        saveItems(next);
        renderItems();
        notify("Item removed");
      });
      $row.append($del);
      $list.append($row);
    });
  }

  function addItem() {
    const name = ($("#downloadInput").val() || "").trim();
    if (!name) return;
    const items = loadItems();
    items.push(name);
    saveItems(items);
    $("#downloadInput").val("");
    renderItems();
    notify("Item added", "success");
  }

  function loadNotes() { return safeJson(NOTES_KEY, []); }
  function saveNotes(notes) { localStorage.setItem(NOTES_KEY, JSON.stringify(notes)); }

  function removeNote(id) {
    const notes = loadNotes().filter((n) => n.id !== id);
    saveNotes(notes);
    $(`#${id}`).remove();
    notify("Sticky note deleted");
  }

  function addNoteEl(note) {
    const $n = $("<div class='snote'></div>")
      .attr("id", note.id)
      .attr("data-desktop", String(note.desktop || 1))
      .css({ top: `${note.top || 100}px`, left: `${note.left || 100}px` })
      .text(note.content || "")
      .appendTo("#desktop");

    $n.draggable({
      containment: "#desktop",
      stop: (_e, ui) => {
        const notes = loadNotes();
        const idx = notes.findIndex((x) => x.id === note.id);
        if (idx >= 0) {
          notes[idx].top = Math.round(ui.position.top);
          notes[idx].left = Math.round(ui.position.left);
          saveNotes(notes);
        }
      }
    });

    $n.on("dblclick", () => {
      if (confirm("Delete this sticky note?")) removeNote(note.id);
    });
  }

  function restoreNotes() {
    loadNotes().forEach((n) => addNoteEl(n));
  }

  function createNoteFromModal() {
    const content = ($("#notesText").val() || "").trim();
    if (!content) return;
    const note = { id: `note_${Date.now()}`, content, top: 100, left: 100, desktop: currentDesktop };
    const notes = loadNotes();
    notes.push(note);
    saveNotes(notes);
    addNoteEl(note);
    $("#notesText").val("");
    $("#notesModal").fadeOut(120);
    applyDesktopVisibility();
    notify("Sticky note saved", "success");
  }

  function clearNotes() {
    if (!confirm("Clear all sticky notes?")) return;
    saveNotes([]);
    $(".snote").remove();
    notify("All sticky notes cleared");
  }

  function setBackground(value) {
    const v = (value || "").trim();
    if (!v) return;
    const colorLike = /^#|^rgb|^hsl|^[a-zA-Z]+$/.test(v) && !/^https?:\/\//i.test(v);
    if (colorLike) {
      $("#desktop").css({ background: v, backgroundSize: "cover" });
    } else {
      $("#desktop").css({ background: `url('${v}') no-repeat center center fixed`, backgroundSize: "cover" });
    }
    localStorage.setItem(WALL_KEY, v);
  }

  function cycleWallpaper() {
    let idx = parseInt(localStorage.getItem(WALL_INDEX_KEY) || "0", 10);
    idx = (idx + 1) % WALLS.length;
    localStorage.setItem(WALL_INDEX_KEY, String(idx));
    setBackground(WALLS[idx]);
    notify("Wallpaper changed");
  }

  function applySavedBackground() {
    const saved = localStorage.getItem(WALL_KEY);
    if (saved) setBackground(saved);
  }

  function setTimeFormatButton() {
    const use24 = localStorage.getItem("use24Hour") === "true";
    $("#toggleFmt").text(use24 ? "12h" : "24h");
  }

  function toggleTimeFormat() {
    const next = !(localStorage.getItem("use24Hour") === "true");
    localStorage.setItem("use24Hour", String(next));
    setTimeFormatButton();
    notify("Time format toggled");
  }

  function openDownloads() {
    $("#downloadsModal").fadeToggle(120);
    renderItems();
  }

  function openSettings() {
    $("#settingsModal").fadeToggle(120);
    $("#soundToggle").prop("checked", localStorage.getItem("soundEnabled") !== "false");
    $("#voiceToggle").prop("checked", localStorage.getItem("voiceEnabled") === "true");
  }

  function openNotes() {
    $("#notesModal").fadeToggle(120);
  }

  function themeCycle() {
    const order = ["dark", "light", "cyber"];
    const cur = order.find((t) => document.body.classList.contains(t)) || "dark";
    const next = order[(order.indexOf(cur) + 1) % order.length];
    const $btn = $(`.thm[data-th='${next}']`);
    if ($btn.length) $btn.trigger("click");
    else {
      document.body.classList.remove("dark", "light", "cyber");
      document.body.classList.add(next);
      notify(`Theme switched to ${next}`);
    }
  }

  function pinIconToTaskbar(iconId) {
    const $icon = iconId ? $(`#${iconId}`) : $();
    if (!$icon.length) return;
    const name = ($icon.find("p").first().text() || "Pinned").trim();
    const pinId = `pin_${iconId}`;
    if ($(`#apps .chip[data-pin='${pinId}']`).length) {
      notify("Already pinned");
      return;
    }
    const $chip = $("<button class='chip pin' type='button'></button>").attr("data-pin", pinId).text(name);
    $chip.on("click", () => {
      const target = $icon.attr("data-target");
      if (target) {
        $icon.trigger("click");
        return;
      }
      const href = $icon.find("a").attr("href");
      if (href) window.open(href, "_blank", "noopener");
    });
    $("#apps").append($chip);
    notify("Icon pinned to taskbar", "success");
  }

  function renameIcon(iconId) {
    const $icon = iconId ? $(`#${iconId}`) : $();
    if (!$icon.length) return;
    const current = ($icon.find("p").first().text() || "").trim();
    const next = prompt("Enter new name:", current);
    if (!next || !next.trim()) return;
    $icon.find("p").first().text(next.trim());

    const shortcuts = getShortcuts();
    const idx = shortcuts.findIndex((x) => x.id === iconId);
    if (idx >= 0) {
      shortcuts[idx].name = next.trim();
      setShortcuts(shortcuts);
    }
    notify("Icon renamed");
  }

  function deleteIcon(iconId) {
    const $icon = iconId ? $(`#${iconId}`) : $();
    if (!$icon.length) return;
    $icon.remove();
    const shortcuts = getShortcuts().filter((x) => x.id !== iconId);
    setShortcuts(shortcuts);
    notify("Icon deleted");
  }

  function shutdownFlow() {
    $("#shutdownOverlay").css("display", "flex");
    requestAnimationFrame(() => $("#shutdownOverlay").css("opacity", 1));
    setTimeout(() => location.reload(), 1800);
  }

  function loadWeather() {
    const $w = $("#weather");
    const fallback = () => $w.text("Weather: unavailable");
    if (!navigator.geolocation) { fallback(); return; }

    navigator.geolocation.getCurrentPosition((pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m&temperature_unit=fahrenheit`;
      fetch(url).then((r) => r.json()).then((data) => {
        const temp = data && data.current ? data.current.temperature_2m : null;
        if (temp === null || temp === undefined) { fallback(); return; }
        $w.text(`Weather: ${Math.round(temp)}¬∞F`);
      }).catch(fallback);
    }, fallback, { timeout: 5000 });
  }

  function openChat() { $("#chatModal").fadeIn(120); }
  function closeChat() { $("#chatModal").fadeOut(120); }

  function sendChat() {
    const msg = ($("#chatInput").val() || "").trim();
    if (!msg) return;
    $("#chatBody").append(`<div><strong>You:</strong> ${$("<div>").text(msg).html()}</div>`);
    $("#chatInput").val("");
    setTimeout(() => {
      const r = BOT[Math.floor(Math.random() * BOT.length)];
      $("#chatBody").append(`<div><strong>Assistant:</strong> ${r}</div>`);
      const el = $("#chatBody").get(0);
      if (el) el.scrollTop = el.scrollHeight;
    }, 380);
  }

  function initContextMenus() {
    $("#desktop").on("contextmenu", (e) => {
      if ($(e.target).closest(".icon, .snote").length) return;
      e.preventDefault();
      $("#iconCtx").hide();
      $("#deskCtx").css({ top: e.pageY, left: e.pageX }).fadeIn(80);
    });

    $("#desktop").on("contextmenu", ".icon", function (e) {
      e.preventDefault();
      e.stopPropagation();
      selectedIconId = this.id || $(this).attr("data-id") || null;
      $("#deskCtx").hide();
      $("#iconCtx").css({ top: e.pageY, left: e.pageX }).fadeIn(80);
    });

    $(document).on("click", () => $("#deskCtx,#iconCtx").hide());
  }

  function initBindings() {
    if (localStorage.getItem("soundEnabled") === null) localStorage.setItem("soundEnabled", "true");
    if (localStorage.getItem("voiceEnabled") === null) localStorage.setItem("voiceEnabled", "false");
    if (localStorage.getItem("use24Hour") === null) localStorage.setItem("use24Hour", "false");

    $(document).on("click", ".tb,.mi,.tiny,#downloadAdd,#notesSave,#notesClear,#chatClose,#clearDataBtn,.ctx li", clickFx);

    $("#prevDesk").on("click", prevDesktop);
    $("#nextDesk").on("click", nextDesktop);
    $("#searchIcons").on("input", applyDesktopVisibility);
    $("#toggleFmt").on("click", toggleTimeFormat);

    $("#downloadsBtn, #menuDocs, #menuDownloads").on("click", () => { openDownloads(); $("#menu").hide(); });
    $("#settingsBtn, #menuSettings").on("click", () => { openSettings(); $("#menu").hide(); });
    $("#notesBtn").on("click", openNotes);
    $("#menuNewShortcut").on("click", () => { createShortcutPrompt(); $("#menu").hide(); });
    $("#menuWallpaper").on("click", () => { cycleWallpaper(); $("#menu").hide(); });
    $("#menuToggleTheme").on("click", () => { themeCycle(); $("#menu").hide(); });
    $("#menuShutdown").on("click", shutdownFlow);

    $("#ctxNewShortcut").on("click", () => { createShortcutPrompt(); $("#deskCtx").hide(); });
    $("#ctxBg").on("click", () => {
      const v = prompt("Enter a background image URL or color:", "");
      if (v && v.trim()) setBackground(v.trim());
      $("#deskCtx").hide();
    });
    $("#ctxPin").on("click", () => { pinIconToTaskbar(selectedIconId); $("#iconCtx").hide(); });
    $("#ctxRename").on("click", () => { renameIcon(selectedIconId); $("#iconCtx").hide(); });
    $("#ctxDelete").on("click", () => { deleteIcon(selectedIconId); $("#iconCtx").hide(); });

    $("#downloadAdd").on("click", addItem);
    $("#downloadInput").on("keydown", (e) => { if (e.key === "Enter") addItem(); });

    $("#notesSave").on("click", createNoteFromModal);
    $("#notesClear").on("click", clearNotes);

    $("#soundToggle").on("change", function () {
      localStorage.setItem("soundEnabled", String($(this).is(":checked")));
      notify(`Sound ${$(this).is(":checked") ? "enabled" : "disabled"}`);
    });
    $("#voiceToggle").on("change", function () {
      localStorage.setItem("voiceEnabled", String($(this).is(":checked")));
      notify(`Voice notifications ${$(this).is(":checked") ? "enabled" : "disabled"}`);
    });
    $("#clearDataBtn").on("click", () => {
      if (!confirm("Clear all app data?")) return;
      localStorage.clear();
      location.reload();
    });

    $(document).on("keydown", (e) => {
      if (e.key === "F2") {
        e.preventDefault();
        openSettings();
      }
      if (e.ctrlKey && e.shiftKey && (e.key === "C" || e.key === "c")) {
        e.preventDefault();
        openChat();
      }
    });

    $("#chatClose").on("click", closeChat);
    $("#chatInput").on("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        sendChat();
      }
    });
  }

  function init() {
    applySavedBackground();
    restoreShortcuts();
    restoreNotes();
    initContextMenus();
    initBindings();
    setTimeFormatButton();
    applyDesktopVisibility();
    loadWeather();
    setInterval(loadWeather, 15 * 60 * 1000);
  }

  init();
})();
</script>
<script>
(() => {
  const LAB_KEY = "innovationLabState";
  const SNAP_KEY = "innovationSnapshotV1";
  const POMO_KEY = "pomodoroStateV1";
  const EXCLUDE_KEYS = [SNAP_KEY];
  const FOCUS_SEC = 25 * 60;
  const BREAK_SEC = 5 * 60;
  let ambientTimer = null;
  let tickTimer = null;

  function safeJson(key, fallback) {
    try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
    catch (_) { return fallback; }
  }

  function saveLabState(state) {
    localStorage.setItem(LAB_KEY, JSON.stringify(state));
  }

  function getLabState() {
    return safeJson(LAB_KEY, { focusMode: false, autoHide: false, ambient: false });
  }

  function renderToast(msg, type) {
    const $t = $("<div class='toast glass'></div>").addClass(type === "error" ? "e" : (type === "success" ? "o" : ""));
    $t.append($("<span class='tgx'></span>").text((type || "info").toUpperCase()));
    $t.append($("<span></span>").text(msg));
    $("#toasts").append($t);
    setTimeout(() => {
      $t.addClass("x");
      setTimeout(() => $t.remove(), 220);
    }, 2800);
  }

  function applyLabState(state) {
    $("body").toggleClass("focus-mode", Boolean(state.focusMode));
    $(".taskbar").toggleClass("auto-hide", Boolean(state.autoHide));
    $("#focusToggle").prop("checked", Boolean(state.focusMode));
    $("#autoHideToggle").prop("checked", Boolean(state.autoHide));
    $("#ambientToggle").prop("checked", Boolean(state.ambient));
    saveLabState(state);
    resetAmbientLoop();
  }

  function openLab() { $("#labModal").fadeToggle(120); }

  function saveSnapshot() {
    const data = {};
    for (let i = 0; i < localStorage.length; i += 1) {
      const key = localStorage.key(i);
      if (!key || EXCLUDE_KEYS.includes(key)) continue;
      data[key] = localStorage.getItem(key);
    }
    localStorage.setItem(SNAP_KEY, JSON.stringify({ at: new Date().toISOString(), data }));
    renderToast("Workspace snapshot saved", "success");
  }

  function restoreSnapshot() {
    const snap = safeJson(SNAP_KEY, null);
    if (!snap || !snap.data) {
      renderToast("No snapshot found", "error");
      return;
    }
    if (!confirm("Restore snapshot and reload?")) return;
    const preserve = {};
    Object.keys(snap.data).forEach((k) => { preserve[k] = snap.data[k]; });
    localStorage.clear();
    Object.keys(preserve).forEach((k) => localStorage.setItem(k, preserve[k]));
    localStorage.setItem(SNAP_KEY, JSON.stringify(snap));
    location.reload();
  }

  function exportData() {
    const out = {};
    for (let i = 0; i < localStorage.length; i += 1) {
      const k = localStorage.key(i);
      if (!k) continue;
      out[k] = localStorage.getItem(k);
    }
    const payload = JSON.stringify(out);
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(payload).then(() => renderToast("Data copied to clipboard", "success")).catch(() => {
        prompt("Copy your data JSON:", payload);
      });
    } else {
      prompt("Copy your data JSON:", payload);
    }
  }

  function importData() {
    const raw = prompt("Paste exported data JSON:");
    if (!raw) return;
    let parsed;
    try { parsed = JSON.parse(raw); }
    catch (_) { renderToast("Invalid JSON", "error"); return; }
    if (!confirm("Import data and reload?")) return;
    localStorage.clear();
    Object.keys(parsed).forEach((k) => localStorage.setItem(k, String(parsed[k])));
    location.reload();
  }

  function fmt(sec) {
    const s = Math.max(0, Math.floor(sec));
    const mm = String(Math.floor(s / 60)).padStart(2, "0");
    const ss = String(s % 60).padStart(2, "0");
    return `${mm}:${ss}`;
  }

  function getPomo() {
    return safeJson(POMO_KEY, { remaining: FOCUS_SEC, running: false, mode: "focus", last: Date.now() });
  }

  function setPomo(p) { localStorage.setItem(POMO_KEY, JSON.stringify(p)); }

  function renderPomo() {
    const p = getPomo();
    $("#pomoTime").text(fmt(p.remaining));
    $("#pomoMode").text(p.mode === "focus" ? "Focus session" : "Break session");
  }

  function switchPomoMode(p) {
    const nextMode = p.mode === "focus" ? "break" : "focus";
    p.mode = nextMode;
    p.remaining = nextMode === "focus" ? FOCUS_SEC : BREAK_SEC;
    p.running = false;
    p.last = Date.now();
    setPomo(p);
    renderPomo();
    renderToast(nextMode === "focus" ? "Break complete. Back to focus." : "Focus complete. Time for a break.", "success");
    const audio = document.getElementById("clickSfx");
    if (audio && localStorage.getItem("soundEnabled") !== "false") {
      try { audio.currentTime = 0; audio.play(); } catch (_) {}
    }
  }

  function tickPomo() {
    const p = getPomo();
    if (!p.running) { renderPomo(); return; }
    const now = Date.now();
    const elapsed = Math.floor((now - (p.last || now)) / 1000);
    if (elapsed > 0) {
      p.remaining -= elapsed;
      p.last = now;
      if (p.remaining <= 0) {
        switchPomoMode(p);
        return;
      }
      setPomo(p);
    }
    renderPomo();
  }

  function startPomo() {
    const p = getPomo();
    p.running = true;
    p.last = Date.now();
    setPomo(p);
    renderPomo();
  }

  function pausePomo() {
    const p = getPomo();
    p.running = false;
    p.last = Date.now();
    setPomo(p);
    renderPomo();
  }

  function resetPomo() {
    const p = getPomo();
    p.running = false;
    p.remaining = p.mode === "focus" ? FOCUS_SEC : BREAK_SEC;
    p.last = Date.now();
    setPomo(p);
    renderPomo();
  }

  function resetAmbientLoop() {
    if (ambientTimer) clearInterval(ambientTimer);
    ambientTimer = null;
    const state = getLabState();
    if (!state.ambient) return;
    ambientTimer = setInterval(() => {
      const audio = document.getElementById("clickSfx");
      if (!audio || localStorage.getItem("soundEnabled") === "false") return;
      try { audio.currentTime = 0; audio.play(); } catch (_) {}
    }, 10 * 60 * 1000);
  }

  function bindLab() {
    const state = getLabState();
    applyLabState(state);

    $("#innovateBtn").on("click", openLab);
    $("#focusToggle").on("change", function () {
      const next = getLabState();
      next.focusMode = $(this).is(":checked");
      applyLabState(next);
      renderToast(`Focus mode ${next.focusMode ? "enabled" : "disabled"}`);
    });
    $("#autoHideToggle").on("change", function () {
      const next = getLabState();
      next.autoHide = $(this).is(":checked");
      applyLabState(next);
      renderToast(`Taskbar auto-hide ${next.autoHide ? "enabled" : "disabled"}`);
    });
    $("#ambientToggle").on("change", function () {
      const next = getLabState();
      next.ambient = $(this).is(":checked");
      applyLabState(next);
      renderToast(`Ambient chime ${next.ambient ? "enabled" : "disabled"}`);
    });

    $("#saveSnapBtn").on("click", saveSnapshot);
    $("#restoreSnapBtn").on("click", restoreSnapshot);
    $("#exportDataBtn").on("click", exportData);
    $("#importDataBtn").on("click", importData);

    $("#pomoStart").on("click", startPomo);
    $("#pomoPause").on("click", pausePomo);
    $("#pomoReset").on("click", resetPomo);

    $(document).on("keydown", (e) => {
      const tag = String(e.target.tagName || "").toLowerCase();
      if (e.ctrlKey && e.key === ".") {
        e.preventDefault();
        openLab();
      }
      if (e.key === "?" && tag !== "input" && tag !== "textarea") {
        e.preventDefault();
        $("#helpModal").fadeToggle(120);
      }
    });

    $(document).on("click", (e) => {
      const $t = $(e.target);
      if ($t.closest("#labModal,#innovateBtn,#helpModal").length) return;
      $("#helpModal").hide();
    });
  }

  function init() {
    bindLab();
    renderPomo();
    if (tickTimer) clearInterval(tickTimer);
    tickTimer = setInterval(tickPomo, 1000);
  }

  init();
})();
</script>
</body>
</html>
