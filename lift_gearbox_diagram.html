<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Compact High-Strength Lift Gearbox — Novel Hybrid Reducer (Engineering Diagram)</title>
<style>
  :root{
    --bg:#0b0f14;
    --panel:#101824;
    --panel2:#0f1722;
    --ink:#e8eef7;
    --muted:#a7b3c6;
    --grid:#1c2a3d;
    --line:#8fb6ff;
    --warn:#ffd57a;
    --ok:#9cffc2;
    --bad:#ff8fa1;
  }
  html,body{height:100%; background:var(--bg); color:var(--ink); margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;}
  .wrap{display:grid; grid-template-columns: 420px 1fr; height:100%;}
  .sidebar{
    background:linear-gradient(180deg,var(--panel),var(--panel2));
    border-right:1px solid var(--grid);
    padding:18px 16px;
    overflow:auto;
  }
  .main{
    position:relative;
    overflow:hidden;
  }
  h1{font-size:16px; margin:0 0 10px 0; letter-spacing:.3px;}
  h2{font-size:13px; margin:18px 0 8px 0; color:var(--muted); font-weight:600; text-transform:uppercase; letter-spacing:.12em;}
  p,li{font-size:12.5px; line-height:1.45; color:var(--ink);}
  .muted{color:var(--muted);}
  .card{
    border:1px solid var(--grid);
    border-radius:12px;
    padding:12px;
    background:rgba(0,0,0,.12);
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
  }
  .row{display:flex; gap:10px; flex-wrap:wrap;}
  .row > *{flex:1 1 160px;}
  label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px;}
  input[type="number"]{
    width:100%;
    background:#0a101a;
    color:var(--ink);
    border:1px solid var(--grid);
    border-radius:10px;
    padding:10px 10px;
    font-size:13px;
    outline:none;
  }
  input[type="number"]:focus{border-color:#3b82f6;}
  .tog{
    display:flex; align-items:center; justify-content:space-between;
    gap:10px; padding:8px 10px; border:1px solid var(--grid); border-radius:10px;
    background:rgba(255,255,255,.03);
    margin:8px 0;
  }
  .tog span{font-size:12.5px;}
  .tog input{transform:scale(1.1);}
  .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;}
  button{
    background:#0a1220;
    border:1px solid var(--grid);
    color:var(--ink);
    padding:10px 10px;
    border-radius:10px;
    font-size:12.5px;
    cursor:pointer;
  }
  button:hover{border-color:#2f4d7a;}
  .out{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    font-size:12px;
    background:#070b10;
    border:1px solid var(--grid);
    border-radius:10px;
    padding:10px;
    white-space:pre-wrap;
    color:#dbe7ff;
  }
  .badge{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid var(--grid); font-size:11px; color:var(--muted);}
  .ok{color:var(--ok);}
  .warn{color:var(--warn);}
  .bad{color:var(--bad);}
  .footer{margin-top:14px; font-size:11.5px; color:var(--muted);}
  /* SVG viewport overlay */
  .hud{
    position:absolute; left:14px; bottom:14px;
    background:rgba(0,0,0,.35);
    border:1px solid var(--grid);
    border-radius:12px;
    padding:10px 12px;
    font-size:12px;
    color:var(--muted);
    user-select:none;
    backdrop-filter: blur(6px);
  }
  .hud b{color:var(--ink);}
  .legend{
    display:grid;
    grid-template-columns: 1fr;
    gap:8px;
  }
  .legend .item{
    border:1px solid var(--grid);
    border-radius:10px;
    padding:8px 10px;
    background:rgba(255,255,255,.02);
  }
  .legend .item .k{font-weight:700; color:var(--ink); font-size:12.5px;}
  .legend .item .v{color:var(--muted); font-size:12px; margin-top:4px;}
</style>
</head>
<body>
<div class="wrap">
  <aside class="sidebar">
    <h1>Novel Hybrid Lift Gearbox (Concept) — Compact, Torque-Dense, Condition-Monitored</h1>
    <div class="muted" style="font-size:12px;margin-bottom:12px;">
      This is an engineering-grade conceptual architecture for a machine-room-less lift reducer. It combines a
      <span class="badge">nested helical planetary</span> stage with a <span class="badge">helical cycloidal pin</span> stage,
      plus unique stiffness/damping and monitoring subsystems.
    </div>

    <div class="card">
      <h2>Design targets</h2>
      <ul style="margin:8px 0 0 18px;padding:0;">
        <li>High ratio in a short axial envelope; low acoustic signature; high torsional stiffness.</li>
        <li>High contact ratio and distributed load paths to reduce Hertzian stress and tooth root fatigue.</li>
        <li>Fail-safe integration: brake interface, backstop, and overload slip element.</li>
        <li>Continuous condition monitoring: oil health + vibration + torque observer.</li>
      </ul>
    </div>

    <h2>Kinematics calculator</h2>
    <div class="card">
      <div class="row">
        <div>
          <label>Stage 1 — Sun teeth (Ns)</label>
          <input id="Ns" type="number" min="8" max="80" step="1" value="18" />
        </div>
        <div>
          <label>Stage 1 — Ring teeth (Nr)</label>
          <input id="Nr" type="number" min="30" max="220" step="1" value="90" />
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <div>
          <label>Stage 2 — Pins (Np)</label>
          <input id="Np" type="number" min="20" max="400" step="1" value="61" />
        </div>
        <div>
          <label>Stage 2 — Lobes (Nc)</label>
          <input id="Nc" type="number" min="10" max="399" step="1" value="59" />
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <div>
          <label>Input speed (rpm)</label>
          <input id="inRPM" type="number" min="0" max="4000" step="10" value="960" />
        </div>
        <div>
          <label>Input torque (N·m)</label>
          <input id="inT" type="number" min="0" max="2000" step="1" value="180" />
        </div>
      </div>

      <div class="btns">
        <button id="recalc">Recalculate</button>
        <button id="resetView">Reset view</button>
        <button id="exportSvg">Export SVG</button>
        <button id="exportPng">Export PNG</button>
      </div>

      <div style="margin-top:10px;" class="out" id="out"></div>
      <div class="footer">
        Ratios assume: Stage 1 fixed ring, sun input, carrier output (i = 1 + Nr/Ns).
        Stage 2 is cycloidal pin reducer (i = Np / (Np − Nc)). Overall i = i1·i2.
      </div>
    </div>

    <h2>Diagram layers</h2>
    <div class="card">
      <div class="tog"><span>Power path (torque flow)</span><input type="checkbox" id="layerPower" checked></div>
      <div class="tog"><span>Lubrication circuit + micro-pump</span><input type="checkbox" id="layerLube" checked></div>
      <div class="tog"><span>Sensors + electronics</span><input type="checkbox" id="layerSense" checked></div>
      <div class="tog"><span>Section + bearings + housing</span><input type="checkbox" id="layerSection" checked></div>
      <div class="tog"><span>Callouts + dimensions</span><input type="checkbox" id="layerDims" checked></div>
    </div>

    <h2>Invented elements (engineering notes)</h2>
    <div class="card legend" style="margin-bottom:14px;">
      <div class="item">
        <div class="k">A. NHP stage — Nested Helical Planetary</div>
        <div class="v">Planets are “shingled” axially (interleaved carriers) so planet pitch diameters overlap in projection, reducing gearbox radius for a given torque. Uses double-helical (herringbone) flanks to cancel axial thrust and increase contact ratio.</div>
      </div>
      <div class="item">
        <div class="k">B. HCP stage — Helical Cycloidal Pin</div>
        <div class="v">Cycloidal disk engages stationary pins, but engagement is helical (axial lead) so multiple axial slices share load, cutting peak contact stress and reducing ripple. Output via a torque-ring with spherical plain bearings to avoid binding.</div>
      </div>
      <div class="item">
        <div class="k">C. ABL ring — Active Backlash-Lock</div>
        <div class="v">A split ring preloads the Stage‑1 ring gear via a wedge cam. Preload is modulated by a magnetorheological (MR) clutch to maintain near‑zero lash across temperature and wear while limiting drag at cruise.</div>
      </div>
      <div class="item">
        <div class="k">D. IMP — Integrated Micro-Pump (no external pump)</div>
        <div class="v">Gerotor micro‑pump driven off the carrier annulus supplies a closed loop: jets to sun/planet mesh + cycloidal pins, scavenge return, and a low‑ΔP filter. Includes a passive bypass valve and anti‑drainback.</div>
      </div>
      <div class="item">
        <div class="k">E. IMU‑torque observer + oil health</div>
        <div class="v">Tri‑axial vibration + temp + oil dielectric sensor estimates film breakdown. A torsional observer fuses motor current (if VVVF), encoder, and gear ratio to infer output torque; trips on slip/overload.</div>
      </div>
      <div class="item">
        <div class="k">F. Safety interface</div>
        <div class="v">Dedicated brake hub + one‑way backstop + overload “soft‑shear” coupling (replaceable polymer‑metal laminate) to protect downstream traction sheave and ropes.</div>
      </div>
    </div>

    <div class="muted" style="font-size:12px;">
      If you want this as an ISO‑style drawing set (A3 sheet, title block, GD&T, section views),
      tell me your target ratio, rated load, traction sheave diameter, and motor frame constraints.
    </div>
  </aside>

  <main class="main">
    <svg id="svgRoot" width="100%" height="100%" viewBox="0 0 1400 900" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Hybrid lift gearbox engineering diagram">
      <defs>
        <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
          <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#132033" stroke-width="1"/>
        </pattern>

        <!-- Arrowhead -->
        <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#8fb6ff"/>
        </marker>

        <marker id="arrow2" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#ffd57a"/>
        </marker>

        <filter id="softGlow" x="-20%" y="-20%" width="140%" height="140%">
          <feGaussianBlur stdDeviation="2" result="b"/>
          <feMerge>
            <feMergeNode in="b"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>

        <!-- Simple tooth-ish edge using path dashes -->
        <style>
          .bg{fill:url(#grid);}
          .frame{fill:#0b0f14;}
          .stroke{stroke:#8fb6ff; stroke-width:2.5; fill:none;}
          .strokeThin{stroke:#8fb6ff; stroke-width:1.6; fill:none;}
          .section{stroke:#a7b3c6; stroke-width:1.6; fill:none; opacity:.9;}
          .cut{fill:#0b0f14; stroke:#a7b3c6; stroke-width:1.6;}
          .steel{fill:#0d1622; stroke:#a7b3c6; stroke-width:1.6;}
          .note{fill:#e8eef7; font-size:16px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
          .note2{fill:#a7b3c6; font-size:14px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
          .dim{stroke:#8fb6ff; stroke-width:1.5; fill:none; marker-start:url(#arrow); marker-end:url(#arrow);}
          .dimText{fill:#8fb6ff; font-size:14px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
          .callLine{stroke:#8fb6ff; stroke-width:1.8; fill:none; marker-end:url(#arrow);}
          .callText{fill:#e8eef7; font-size:15px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
          .power{stroke:#ffd57a; stroke-width:4; fill:none; marker-end:url(#arrow2);}
          .lube{stroke:#78ffd5; stroke-width:3; fill:none; stroke-dasharray:10 7; opacity:.95;}
          .sense{stroke:#ff8fa1; stroke-width:3; fill:none; stroke-dasharray:6 6; opacity:.95;}
          .gearEdge{stroke:#8fb6ff; stroke-width:2.4; fill:none; stroke-dasharray:10 4;}
          .hatch{fill:url(#hatch);}
        </style>

        <pattern id="hatch" width="10" height="10" patternUnits="userSpaceOnUse" patternTransform="rotate(35)">
          <line x1="0" y1="0" x2="0" y2="10" stroke="#22344d" stroke-width="2"/>
        </pattern>
      </defs>

      <!-- Background -->
      <rect class="frame" x="0" y="0" width="1400" height="900"/>
      <rect class="bg" x="0" y="0" width="1400" height="900" opacity=".8"/>

      <!-- Pan/Zoom group -->
      <g id="viewport">
        <!-- Title -->
        <text x="40" y="55" class="note">HYBRID LIFT GEARBOX — NHP + HCP WITH ACTIVE BACKLASH LOCK & INTEGRATED MICRO-PUMP</text>
        <text x="40" y="78" class="note2">SECTION A–A (CONCEPTUAL) • COAXIAL INPUT/OUTPUT • CONDITION MONITORING READY</text>

        <!-- Layer: section/housing -->
        <g id="layer_section">
          <!-- Housing outer -->
          <path class="steel" d="M120,160 h1160 a60,60 0 0 1 60,60 v420 a60,60 0 0 1 -60,60 H120 a60,60 0 0 1 -60,-60 V220 a60,60 0 0 1 60,-60 z" />
          <!-- Housing wall thickness (inner void) -->
          <path class="cut" d="M170,210 h1060 a35,35 0 0 1 35,35 v330 a35,35 0 0 1 -35,35 H170 a35,35 0 0 1 -35,-35 V245 a35,35 0 0 1 35,-35 z" />
          <!-- Section hatching on housing ribs -->
          <path d="M120,160 h1160 a60,60 0 0 1 60,60 v60 H60 v-60 a60,60 0 0 1 60,-60 z" fill="url(#hatch)" opacity=".35"/>
          <path d="M60,580 h1280 v60 a60,60 0 0 1 -60,60 H120 a60,60 0 0 1 -60,-60 z" fill="url(#hatch)" opacity=".35"/>

          <!-- Input shaft -->
          <rect x="120" y="382" width="140" height="60" rx="18" class="steel"/>
          <circle cx="260" cy="412" r="32" class="cut"/>
          <circle cx="260" cy="412" r="20" class="section"/>
          <text x="90" y="410" class="note2">INPUT</text>

          <!-- Output shaft / brake hub -->
          <rect x="1140" y="372" width="190" height="80" rx="20" class="steel"/>
          <circle cx="1140" cy="412" r="40" class="cut"/>
          <circle cx="1140" cy="412" r="26" class="section"/>
          <text x="1330" y="410" class="note2" text-anchor="end">OUTPUT / BRAKE HUB</text>

          <!-- Bearings (stylized) -->
          <g opacity=".95">
            <!-- Bearing 1 -->
            <circle cx="300" cy="412" r="48" class="section"/>
            <circle cx="300" cy="412" r="36" class="section"/>
            <circle cx="300" cy="412" r="42" class="section" stroke-dasharray="6 6"/>
            <!-- Bearing 2 -->
            <circle cx="1100" cy="412" r="58" class="section"/>
            <circle cx="1100" cy="412" r="44" class="section"/>
            <circle cx="1100" cy="412" r="52" class="section" stroke-dasharray="6 6"/>
          </g>

          <!-- Oil sump -->
          <path d="M220,610 h960 v40 h-960 z" fill="#091221" opacity=".65" stroke="#22344d" stroke-width="1.6"/>
          <text x="240" y="638" class="note2">OIL SUMP (SPLASH + PUMPED)</text>
        </g>

        <!-- Core gearbox architecture -->
        <g id="layer_core">
          <!-- Stage 1 ring gear -->
          <circle cx="520" cy="412" r="150" class="gearEdge"/>
          <circle cx="520" cy="412" r="120" class="strokeThin"/>
          <text x="520" y="254" class="note2" text-anchor="middle">STAGE 1: NESTED HELICAL PLANETARY (NHP)</text>

          <!-- Stage 1 sun -->
          <circle cx="410" cy="412" r="52" class="gearEdge"/>
          <circle cx="410" cy="412" r="34" class="strokeThin"/>
          <text x="410" y="486" class="note2" text-anchor="middle">SUN</text>

          <!-- Stage 1 planets (shingled) -->
          <g>
            <circle cx="520" cy="330" r="46" class="gearEdge"/>
            <circle cx="520" cy="330" r="30" class="strokeThin"/>
            <circle cx="605" cy="412" r="46" class="gearEdge"/>
            <circle cx="605" cy="412" r="30" class="strokeThin"/>
            <circle cx="520" cy="494" r="46" class="gearEdge"/>
            <circle cx="520" cy="494" r="30" class="strokeThin"/>
            <circle cx="435" cy="412" r="46" class="gearEdge" opacity=".0"/> <!-- overlap hint -->
            <text x="520" y="610" class="note2" text-anchor="middle">INTERLEAVED CARRIER (SHINGLED PLANETS)</text>
          </g>

          <!-- Carrier / annulus -->
          <circle cx="520" cy="412" r="86" class="stroke"/>
          <circle cx="520" cy="412" r="76" class="strokeThin"/>

          <!-- Stage 2: helical cycloidal pin reducer -->
          <text x="910" y="254" class="note2" text-anchor="middle">STAGE 2: HELICAL CYCLOIDAL PIN (HCP)</text>

          <!-- Pin ring -->
          <circle cx="910" cy="412" r="170" class="strokeThin"/>
          <circle cx="910" cy="412" r="158" class="strokeThin" stroke-dasharray="8 6"/>

          <!-- Pins -->
          <g opacity=".95">
            <!-- 12 pins around (stylized, not all) -->
            <circle cx="910" cy="242" r="10" class="steel"/>
            <circle cx="1010" cy="268" r="10" class="steel"/>
            <circle cx="1080" cy="336" r="10" class="steel"/>
            <circle cx="1100" cy="412" r="10" class="steel"/>
            <circle cx="1080" cy="488" r="10" class="steel"/>
            <circle cx="1010" cy="556" r="10" class="steel"/>
            <circle cx="910" cy="582" r="10" class="steel"/>
            <circle cx="810" cy="556" r="10" class="steel"/>
            <circle cx="740" cy="488" r="10" class="steel"/>
            <circle cx="720" cy="412" r="10" class="steel"/>
            <circle cx="740" cy="336" r="10" class="steel"/>
            <circle cx="810" cy="268" r="10" class="steel"/>
          </g>

          <!-- Cycloidal disk (two disks, phase-shifted) -->
          <path d="M910,412
                   m-95,0
                   c 10,-70 60,-110 95,-110
                   c 35,0 85,40 95,110
                   c 10,70 -40,130 -95,130
                   c -55,0 -105,-60 -95,-130 z" fill="#0b1320" stroke="#8fb6ff" stroke-width="2.2"/>
          <path d="M910,412
                   m-70,-20
                   c 50,-60 120,-40 150,20
                   c 30,60 -20,120 -80,130
                   c -60,10 -120,-30 -120,-90
                   c 0,-20 10,-40 50,-60 z" fill="none" stroke="#8fb6ff" stroke-width="1.8" stroke-dasharray="6 6"/>

          <!-- Output torque ring -->
          <circle cx="910" cy="412" r="92" class="stroke"/>
          <circle cx="910" cy="412" r="70" class="strokeThin"/>
          <text x="910" y="520" class="note2" text-anchor="middle">TORQUE RING</text>

          <!-- Coupling between stages -->
          <path d="M605,412 C690,412 725,412 740,412" class="stroke" />
          <path d="M740,412 C760,412 780,412 810,412" class="strokeThin" stroke-dasharray="10 6" />
        </g>

        <!-- Layer: power path -->
        <g id="layer_power">
          <!-- Input to sun -->
          <path d="M160,412 L360,412" class="power"/>
          <text x="200" y="392" class="dimText">T_in</text>

          <!-- Sun -> carrier -->
          <path d="M410,412 C460,360 490,340 520,330" class="power" />
          <path d="M410,412 C470,412 540,412 605,412" class="power" />
          <path d="M410,412 C460,460 490,480 520,494" class="power" />

          <!-- Carrier to Stage 2 drive -->
          <path d="M605,412 C700,412 760,412 815,412" class="power"/>
          <text x="640" y="392" class="dimText">T_car</text>

          <!-- Stage 2 to output -->
          <path d="M910,412 C980,412 1045,412 1100,412" class="power"/>
          <path d="M1100,412 L1260,412" class="power"/>
          <text x="1160" y="392" class="dimText">T_out</text>
        </g>

        <!-- Layer: lubrication -->
        <g id="layer_lube">
          <!-- Micro-pump -->
          <g filter="url(#softGlow)">
            <circle cx="700" cy="610" r="26" fill="#0a2a23" stroke="#78ffd5" stroke-width="2"/>
            <circle cx="700" cy="610" r="14" fill="none" stroke="#78ffd5" stroke-width="2" stroke-dasharray="6 4"/>
            <text x="700" y="652" class="note2" text-anchor="middle" fill="#78ffd5">IMP</text>
          </g>
          <!-- Suction from sump -->
          <path d="M700,610 C700,650 650,662 610,662" class="lube"/>
          <path d="M610,662 C520,662 420,660 340,650" class="lube"/>
          <!-- Pressure manifold -->
          <path d="M700,610 C720,560 760,520 810,490" class="lube"/>
          <path d="M810,490 C860,460 880,445 910,440" class="lube"/>
          <!-- Jets to Stage 2 pins -->
          <path d="M910,440 C930,380 980,350 1010,330" class="lube"/>
          <path d="M910,440 C880,380 840,350 810,330" class="lube"/>
          <!-- Jets to Stage 1 mesh -->
          <path d="M740,420 C690,350 640,320 580,300" class="lube"/>
          <path d="M740,420 C690,470 640,510 580,540" class="lube"/>

          <text x="760" y="590" class="note2" fill="#78ffd5">PRESSURE JETS + SCAVENGE RETURN</text>
        </g>

        <!-- Layer: sensors -->
        <g id="layer_sense">
          <!-- Vibration sensor -->
          <rect x="1210" y="210" width="120" height="46" rx="10" fill="#240c12" stroke="#ff8fa1" stroke-width="2"/>
          <text x="1270" y="240" class="note2" fill="#ff8fa1" text-anchor="middle">IMU / VIB</text>
          <path d="M1270,256 C1260,310 1220,350 1160,372" class="sense"/>

          <!-- Oil health sensor -->
          <rect x="260" y="610" width="150" height="46" rx="10" fill="#240c12" stroke="#ff8fa1" stroke-width="2"/>
          <text x="335" y="640" class="note2" fill="#ff8fa1" text-anchor="middle">OIL DIELECTRIC</text>
          <path d="M410,632 C470,620 540,615 610,615" class="sense"/>

          <!-- Torque observer box -->
          <rect x="1040" y="610" width="240" height="60" rx="12" fill="#240c12" stroke="#ff8fa1" stroke-width="2"/>
          <text x="1160" y="638" class="note2" fill="#ff8fa1" text-anchor="middle">TORQUE OBSERVER + SLIP TRIP</text>
          <path d="M1040,630 C980,600 960,560 950,520" class="sense"/>
        </g>

        <!-- Layer: callouts and dimensions -->
        <g id="layer_dims">
          <!-- Overall length dimension -->
          <path d="M170,120 L1230,120" class="dim"/>
          <path d="M170,130 L170,210" class="strokeThin"/>
          <path d="M1230,130 L1230,210" class="strokeThin"/>
          <text x="700" y="110" class="dimText" text-anchor="middle">OVERALL AXIAL ENVELOPE (COMPACT) — ~0.55× OF TRADITIONAL 2-STAGE</text>

          <!-- Diameter dimension -->
          <path d="M40,210 L40,630" class="dim"/>
          <path d="M60,210 L170,210" class="strokeThin"/>
          <path d="M60,630 L220,630" class="strokeThin"/>
          <text x="28" y="425" class="dimText" transform="rotate(-90 28 425)" text-anchor="middle">MAX OD (M/R-LIFT CHASSIS COMPATIBLE)</text>

          <!-- Callouts -->
          <path d="M520,262 C470,230 420,220 340,220" class="callLine"/>
          <text x="330" y="214" class="callText" text-anchor="end">[1] NHP RING (LAMELLA DAMPED RING)</text>

          <path d="M410,360 C360,330 310,330 260,330" class="callLine"/>
          <text x="250" y="326" class="callText" text-anchor="end">[2] SUN (CASE-HARDENED, GROUND)</text>

          <path d="M520,330 C480,290 470,280 430,260" class="callLine"/>
          <text x="420" y="252" class="callText" text-anchor="end">[3] SHINGLED PLANETS (DOUBLE-HELICAL)</text>

          <path d="M700,610 C720,700 760,740 860,760" class="callLine"/>
          <text x="870" y="770" class="callText">[4] IMP MICRO-PUMP + FILTER LOOP</text>

          <path d="M910,242 C940,200 980,190 1040,190" class="callLine"/>
          <text x="1050" y="186" class="callText">[5] PIN RING + HELICAL PIN GUIDES</text>

          <path d="M910,412 C980,470 1030,510 1080,530" class="callLine"/>
          <text x="1090" y="538" class="callText">[6] HCP DISK (HELICAL CYCLOID PROFILE)</text>

          <path d="M1140,412 C1220,450 1280,500 1330,560" class="callLine"/>
          <text x="1340" y="570" class="callText">[7] BRAKE HUB + BACKSTOP + SOFT-SHEAR COUPLING</text>

          <!-- Material note -->
          <text x="40" y="860" class="note2">
            MATERIALS (TYP.): CARBURIZED 18CrNiMo7-6 GEARS; NODULAR IRON/STEEL HOUSING; HYBRID CERAMIC BEARINGS (OPTION); ISO VG 150 SYNTHETIC EP GEAR OIL
          </text>
        </g>
      </g>
    </svg>

    <div class="hud" id="hud">
      <div><b>Pan:</b> drag • <b>Zoom:</b> mouse wheel / trackpad • <b>Reset:</b> button</div>
      <div style="margin-top:4px;"><span class="badge">Concept diagram</span> <span class="badge">Coaxial reducer</span> <span class="badge">Lift duty</span></div>
    </div>
  </main>
</div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);

  // --- Layer toggles ---
  const layerMap = {
    layerPower: "layer_power",
    layerLube: "layer_lube",
    layerSense: "layer_sense",
    layerSection: "layer_section",
    layerDims: "layer_dims"
  };
  function setLayerVisibility(){
    for(const [chk, layerId] of Object.entries(layerMap)){
      const el = $(layerId);
      if(!el) continue;
      el.style.display = $(chk).checked ? "block" : "none";
    }
  }
  Object.keys(layerMap).forEach(k => $(k).addEventListener("change", setLayerVisibility));
  setLayerVisibility();

  // --- Kinematics calculator ---
  function fmt(x, n=3){
    if(!isFinite(x)) return "NaN";
    const abs = Math.abs(x);
    if(abs >= 1000) return x.toFixed(0);
    if(abs >= 100) return x.toFixed(1);
    if(abs >= 10) return x.toFixed(2);
    return x.toFixed(n);
  }

  function recalc(){
    const Ns = +$("Ns").value;
    const Nr = +$("Nr").value;
    const Np = +$("Np").value;
    const Nc = +$("Nc").value;
    const inRPM = +$("inRPM").value;
    const Tin = +$("inT").value;

    // Stage 1: fixed ring, sun input, carrier output => i1 = 1 + Nr/Ns
    const i1 = 1 + (Nr / Ns);

    // Stage 2: cycloidal pin reducer => i2 = Np / (Np - Nc)
    const denom = (Np - Nc);
    const i2 = denom !== 0 ? (Np / denom) : Infinity;

    const iTot = i1 * i2;
    const outRPM = (iTot !== 0) ? (inRPM / iTot) : 0;
    const ToutIdeal = Tin * iTot;

    // Conservative efficiency guess for a quiet, well-lubed high-contact system:
    // helical planetary ~0.97, cycloidal ~0.93 (varies by ratio/load). Multiply.
    const eta1 = 0.97, eta2 = 0.93;
    const eta = eta1 * eta2;
    const Tout = ToutIdeal * eta;

    // Simple feasibility checks
    const issues = [];
    if(Ns < 10) issues.push("Stage 1 Ns is very small; undercut risk unless profile shifted.");
    if(Nr <= Ns + 10) issues.push("Stage 1 ratio may be low for lift duty; consider higher Nr.");
    if(Np <= Nc) issues.push("Stage 2 requires Np > Nc to produce reduction (denominator positive).");
    if(Math.abs(denom) < 2) issues.push("Stage 2 denom is tiny; ratio is huge but ripple and bearing loads rise sharply.");
    if(iTot < 20) issues.push("Overall ratio likely low for typical traction sheave gearing (depends on motor).");
    if(iTot > 200) issues.push("Overall ratio very high; check thermal limits and dynamic response.");

    // Rough contact-stress "sanity band" (not a standards calc)
    // Convert torque to tangential force at a notional pitch radius.
    // For compact lift reducers, stage1 pitch radius might be ~45-65mm; stage2 ~70-95mm.
    const r1 = 0.055; // m
    const r2 = 0.085; // m
    const Ft1 = Tin / r1;                 // N
    const Ft2 = (Tin * i1 * eta1) / r2;   // N into stage2 at pitch radius
    // Distribute load across multiple contacts:
    // planetary: assume 3 planets with ~1.8 tooth pairs in contact effectively for double helical
    const k1 = 3 * 1.8;
    // cycloidal: assume 8 effective pins sharing due to helical engagement (depends on geometry)
    const k2 = 8;
    const Ft1_per = Ft1 / k1;
    const Ft2_per = Ft2 / k2;

    const out = [];
    out.push("=== Gear Ratios ===");
    out.push(`Stage 1 (NHP): i1 = 1 + Nr/Ns = 1 + ${Nr}/${Ns} = ${fmt(i1,4)}`);
    out.push(`Stage 2 (HCP): i2 = Np/(Np − Nc) = ${Np}/(${Np} − ${Nc}) = ${fmt(i2,4)}`);
    out.push(`Overall:      i  = i1·i2 = ${fmt(iTot,4)}`);
    out.push("");
    out.push("=== Speeds / Torque (ideal & efficiency-adjusted) ===");
    out.push(`Input speed:  ${fmt(inRPM,2)} rpm`);
    out.push(`Output speed: ${fmt(outRPM,4)} rpm`);
    out.push(`Input torque: ${fmt(Tin,2)} N·m`);
    out.push(`Output torque (ideal): ${fmt(ToutIdeal,2)} N·m`);
    out.push(`Assumed efficiency η≈${fmt(eta,3)} (η1=${eta1}, η2=${eta2})`);
    out.push(`Output torque (η-adjusted): ${fmt(Tout,2)} N·m`);
    out.push("");
    out.push("=== Load-sharing sanity checks (order-of-magnitude) ===");
    out.push(`Stage 1 tangential force Ft1 ≈ Tin/r1 = ${fmt(Ft1,1)} N (r1≈${r1*1000|0} mm)`);
    out.push(`Stage 1 per-contact force ≈ Ft1/(3 planets·1.8) = ${fmt(Ft1_per,1)} N`);
    out.push(`Stage 2 tangential force Ft2 ≈ (Tin·i1·η1)/r2 = ${fmt(Ft2,1)} N (r2≈${r2*1000|0} mm)`);
    out.push(`Stage 2 per-pin force ≈ Ft2/8 = ${fmt(Ft2_per,1)} N`);
    out.push("");
    out.push("=== Feasibility flags ===");
    if(issues.length === 0){
      out.push("OK: no immediate kinematic red flags. Proceed to standards sizing (ISO 6336 / AGMA) and lift safety integration.");
    }else{
      for(const s of issues) out.push("• " + s);
    }
    out.push("");
    out.push("Notes:");
    out.push("• This is a conceptual architecture. Final design must verify tooth geometry, bearing L10 life, micro-pitting, scuffing, thermal balance, and safety per lift standards.");
    out.push("• The ‘Active Backlash‑Lock’ (ABL) ring is intended to keep lash near zero under bidirectional torque reversals typical in lift leveling.");
    out.push("• Helical cycloidal engagement reduces torque ripple but demands careful axial guidance and oil film control.");

    $("out").textContent = out.join("\n");
  }

  $("recalc").addEventListener("click", recalc);
  recalc();

  // --- Pan & Zoom for SVG viewport group ---
  const svg = $("svgRoot");
  const vp = document.getElementById("viewport");

  let scale = 1.0;
  let tx = 0, ty = 0;
  let dragging = false;
  let lastX = 0, lastY = 0;

  function applyTransform(){
    vp.setAttribute("transform", `translate(${tx} ${ty}) scale(${scale})`);
  }
  applyTransform();

  svg.addEventListener("pointerdown", (e)=>{
    // only left button / primary
    if(e.button !== 0) return;
    dragging = true;
    lastX = e.clientX; lastY = e.clientY;
    svg.setPointerCapture(e.pointerId);
  });

  svg.addEventListener("pointermove", (e)=>{
    if(!dragging) return;
    const dx = e.clientX - lastX;
    const dy = e.clientY - lastY;
    lastX = e.clientX; lastY = e.clientY;
    tx += dx / scale;
    ty += dy / scale;
    applyTransform();
  });

  svg.addEventListener("pointerup", (e)=>{
    dragging = false;
    try{ svg.releasePointerCapture(e.pointerId); }catch(_){}
  });

  svg.addEventListener("wheel", (e)=>{
    e.preventDefault();
    const delta = -Math.sign(e.deltaY);
    const factor = delta > 0 ? 1.08 : 1/1.08;
    // Zoom about cursor position
    const pt = svg.createSVGPoint();
    pt.x = e.clientX; pt.y = e.clientY;
    const ctm = svg.getScreenCTM();
    if(!ctm) return;
    const inv = ctm.inverse();
    const loc = pt.matrixTransform(inv); // in SVG coords
    // Convert to viewport coords by inverting current transform
    // Current viewport transform: translate(tx,ty) scale(scale)
    // Point in viewport local coords:
    const vx = (loc.x - tx) / scale;
    const vy = (loc.y - ty) / scale;

    const newScale = Math.min(4.0, Math.max(0.35, scale * factor));
    // adjust translate so (vx,vy) stays under cursor
    tx = loc.x - vx * newScale;
    ty = loc.y - vy * newScale;
    scale = newScale;
    applyTransform();
  }, {passive:false});

  $("resetView").addEventListener("click", ()=>{
    scale = 1.0; tx = 0; ty = 0; applyTransform();
  });

  // --- Export helpers ---
  function serializeSvg(){
    const clone = svg.cloneNode(true);
    clone.removeAttribute("width");
    clone.removeAttribute("height");
    clone.setAttribute("xmlns", "http://www.w3.org/2000/svg");
    const s = new XMLSerializer().serializeToString(clone);
    // Ensure proper header
    return `<?xml version="1.0" encoding="UTF-8"?>\n` + s;
  }

  function downloadBlob(blob, filename){
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }

  $("exportSvg").addEventListener("click", ()=>{
    const data = serializeSvg();
    downloadBlob(new Blob([data], {type:"image/svg+xml"}), "lift_gearbox_concept.svg");
  });

  $("exportPng").addEventListener("click", async ()=>{
    const data = serializeSvg();
    const svgBlob = new Blob([data], {type:"image/svg+xml"});
    const url = URL.createObjectURL(svgBlob);

    const img = new Image();
    img.decoding = "async";
    img.onload = ()=>{
      const canvas = document.createElement("canvas");
      const W = 2800, H = 1800; // high-res export
      canvas.width = W; canvas.height = H;
      const ctx = canvas.getContext("2d");
      // background
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue("--bg") || "#0b0f14";
      ctx.fillRect(0,0,W,H);
      // draw
      ctx.drawImage(img, 0, 0, W, H);
      canvas.toBlob((b)=>{
        if(!b) return;
        downloadBlob(b, "lift_gearbox_concept.png");
        URL.revokeObjectURL(url);
      }, "image/png");
    };
    img.onerror = ()=>{ URL.revokeObjectURL(url); alert("PNG export failed (browser SVG security restrictions). Try exporting SVG instead."); };
    img.src = url;
  });

})();
</script>
</body>
</html>
