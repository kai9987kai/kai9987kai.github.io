
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Supplement Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2A5563;
            --secondary: #4B8F8C;
            --accent: #FF6B6B;
            --light: #f8f9fa;
            --dark: #212529;
            --card-shadow: 0 10px 20px rgba(0,0,0,0.08);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --category-bg: rgba(42, 85, 99, 0.1);
            --category-text: #212529;
            --neurogenesis: #8e44ad;
            --neuroplasticity: #3498db;
            --cognitive: #e74c3c;
        }

        .dark-mode {
            --primary: #345B6B;
            --secondary: #5BA8A5;
            --accent: #FF8383;
            --light: #1a1a1a;
            --dark: #f1f1f1;
            --card-shadow: 0 10px 20px rgba(0,0,0,0.15);
            --category-bg: rgba(91, 168, 165, 0.15);
            --category-text: #f1f1f1;
            --neurogenesis: #9b59b6;
            --neuroplasticity: #3498db;
            --cognitive: #e74c3c;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            background: var(--light);
            color: var(--dark);
            transition: var(--transition);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .search-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 2.5rem;
            border-radius: 1.5rem;
            margin-bottom: 2.5rem;
            box-shadow: var(--card-shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .search-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: pulse-bg 15s infinite;
            z-index: 0;
        }

        @keyframes pulse-bg {
            0% { transform: translate(0, 0); opacity: 0.5; }
            50% { transform: translate(10%, 10%); opacity: 0.8; }
            100% { transform: translate(0, 0); opacity: 0.5; }
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header-title {
            margin-bottom: 1.5rem;
            font-weight: 700;
            font-size: 2.5rem;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-subtitle {
            opacity: 0.95;
            font-weight: 300;
            margin-bottom: 2rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .view-toggle, .mode-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .view-toggle:hover, .mode-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .search-tools {
            display: grid;
            gap: 1rem;
            grid-template-columns: 1fr;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .search-container {
            position: relative;
        }

        #searchInput {
            padding: 1.2rem 1.2rem 1.2rem 3.2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.95);
            width: 100%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: var(--transition);
        }

        #searchInput:focus {
            outline: none;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .search-icon {
            position: absolute;
            left: 1.2rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
        }

        .search-clear {
            position: absolute;
            right: 1.2rem;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            cursor: pointer;
            opacity: 0;
            transition: var(--transition);
        }

        .search-clear.visible {
            opacity: 1;
        }

        .filters {
            display: flex;
            gap: 0.7rem;
            flex-wrap: wrap;
            justify-content: center;
            margin: 1.5rem 0;
        }

        .filter-chip {
            padding: 0.8rem 1.2rem;
            border-radius: 30px;
            background: white;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--primary);
            font-weight: 500;
            position: relative;
            overflow: hidden;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-chip::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--accent);
            opacity: 0;
            transition: var(--transition);
            z-index: -1;
        }

        .filter-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        .filter-chip:hover::before {
            opacity: 0.1;
        }

        .filter-chip.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255,107,107,0.3);
        }

        .filter-chip.active::before {
            opacity: 0;
        }

        .filter-chip .count {
            background: rgba(0,0,0,0.1);
            border-radius: 50px;
            padding: 0.1rem 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .filter-chip.active .count {
            background: rgba(255,255,255,0.2);
        }

        .advanced-filters-toggle {
            background: none;
            border: none;
            color: white;
            margin: 1rem auto 0;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
            transition: var(--transition);
        }

        .advanced-filters-toggle:hover {
            transform: translateY(-2px);
        }

        .advanced-filters {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            margin-top: 0;
        }

        .advanced-filters.open {
            max-height: 1000px;
            margin-top: 1.5rem;
        }

        .advanced-filters-content {
            background: rgba(255,255,255,0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .slider-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .slider-filter {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .slider-filter-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            margin-bottom: 0.3rem;
        }

        .score-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .score-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .neuro-icon {
            background: var(--neurogenesis);
        }

        .plasticity-icon {
            background: var(--neuroplasticity);
        }

        .cognitive-icon {
            background: var(--cognitive);
        }

        .score-value {
            display: inline-block;
            width: 40px;
            text-align: right;
            font-weight: 600;
        }

        .score-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: rgba(255,255,255,0.3);
            outline: none;
        }

        .score-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
        }

        .neuro-slider::-webkit-slider-thumb {
            background: var(--neurogenesis);
        }

        .plasticity-slider::-webkit-slider-thumb {
            background: var(--neuroplasticity);
        }

        .cognitive-slider::-webkit-slider-thumb {
            background: var(--cognitive);
        }

        .score-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
        }

        .neuro-slider::-moz-range-thumb {
            background: var(--neurogenesis);
        }

        .plasticity-slider::-moz-range-thumb {
            background: var(--neuroplasticity);
        }

        .cognitive-slider::-moz-range-thumb {
            background: var(--cognitive);
        }

        .filters-toggle {
            background: none;
            border: none;
            color: white;
            display: none;
            align-items: center;
            gap: 0.5rem;
            margin: 1rem auto;
            cursor: pointer;
            font-weight: 500;
        }

        .controls-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .results-count {
            font-weight: 500;
            color: var(--dark);
        }

        .control-group {
            display: flex;
            gap: 0.8rem;
            align-items: center;
        }

        #sortSelect, #viewSelect {
            padding: 0.6rem 1rem;
            border-radius: 20px;
            border: 1px solid var(--secondary);
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        #sortSelect:focus, #viewSelect:focus {
            outline: none;
            border-color: var(--accent);
        }

        .view-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 1px solid var(--secondary);
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark);
        }

        .view-btn:hover, .view-btn.active {
            background: var(--secondary);
            color: white;
        }

        .loader {
            display: none;
            margin: 2rem auto;
            text-align: center;
        }

        .loader-spinner {
            border: 5px solid rgba(75, 143, 140, 0.2);
            border-top: 5px solid var(--secondary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-container {
            position: relative;
            min-height: 200px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .results-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .supplement-card {
            background: white;
            border-radius: 1.2rem;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .supplement-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .supplement-image-container {
            width: 100%;
            height: 180px;
            overflow: hidden;
            border-radius: 0.8rem;
            background: #f5f5f5;
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .supplement-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: var(--transition);
        }

        .supplement-card:hover .supplement-image {
            transform: scale(1.05);
        }

        .bookmark-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            transition: var(--transition);
            opacity: 0;
        }

        .supplement-card:hover .bookmark-btn {
            opacity: 1;
        }

        .bookmark-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .bookmark-btn.active {
            color: var(--accent);
        }

        .supplement-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .supplement-brand {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1rem;
        }

        .health-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .health-tag {
            background: var(--secondary);
            color: white;
            padding: 0.4rem 0.9rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(75, 143, 140, 0.2);
            transition: var(--transition);
        }

        .health-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(75, 143, 140, 0.3);
        }

        .brain-scores {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin: 1rem 0;
        }

        .brain-score {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
            flex: 1;
            min-width: 80px;
        }

        .score-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            color: white;
            position: relative;
        }

        .score-circle::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 50%;
            border: 2px solid;
            opacity: 0.3;
        }

        .neurogenesis-score {
            background: var(--neurogenesis);
        }

        .neurogenesis-score::after {
            border-color: var(--neurogenesis);
        }

        .neuroplasticity-score {
            background: var(--neuroplasticity);
        }

        .neuroplasticity-score::after {
            border-color: var(--neuroplasticity);
        }

        .cognitive-score {
            background: var(--cognitive);
        }

        .cognitive-score::after {
            border-color: var(--cognitive);
        }

        .score-name {
            font-size: 0.7rem;
            text-align: center;
            font-weight: 500;
            color: var(--dark);
        }

        .nutrient-chart {
            height: 150px;
            margin: 1rem 0;
            flex-grow: 1;
        }

        .category-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: var(--category-bg);
            color: var(--category-text);
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: capitalize;
            z-index: 2;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: var(--transition);
        }

        .supplement-card:hover .category-badge {
            transform: translateY(-2px);
        }

        .supplement-list-item {
            display: flex;
            gap: 1.5rem;
            background: white;
            border-radius: 1.2rem;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .supplement-list-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .list-item-image {
            width: 120px;
            height: 120px;
            flex-shrink: 0;
            border-radius: 0.8rem;
            overflow: hidden;
            position: relative;
        }

        .list-item-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .list-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .list-item-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .list-item-price {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }

        .list-scores {
            display: flex;
            gap: 1rem;
            margin: 0.8rem 0;
        }

        .list-score {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .list-score-circle {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            color: white;
        }

        .list-score-info {
            display: flex;
            flex-direction: column;
        }

        .list-score-name {
            font-size: 0.7rem;
            font-weight: 500;
            color: #666;
        }

        .eco-score {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .eco-score.a { background: #20c997; color: white; }
        .eco-score.b { background: #51cf66; color: white; }
        .eco-score.c { background: #fcc419; color: black; }
        .eco-score.d { background: #ff922b; color: white; }
        .eco-score.e { background: #ff6b6b; color: white; }

        .rating-stars {
            color: gold;
            margin-right: 0.3rem;
        }

        .rating-value {
            font-weight: 500;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        .price-rating {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .price {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }

        .rating {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .view-details {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--secondary);
            color: white;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .view-details:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.open {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: white;
            padding: 2.5rem;
            border-radius: 1.5rem;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            position: relative;
            transform: translateY(30px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal.open .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-content::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            z-index: 10;
        }

        .modal-close:hover {
            background: #eee;
            transform: rotate(90deg);
        }

        .modal-tabs {
            display: flex;
            gap: 1rem;
            border-bottom: 1px solid #eee;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .modal-tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
        }

        .modal-tab:hover {
            color: var(--secondary);
        }

        .modal-tab.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .modal-header {
            display: flex;
            margin-bottom: 2rem;
        }

        .modal-img-container {
            width: 200px;
            height: 200px;
            flex-shrink: 0;
            margin-right: 2rem;
            border-radius: 1rem;
            overflow: hidden;
            background: #f5f5f5;
        }

        .modal-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .modal-title-group h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .modal-brain-scores {
            display: flex;
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .action-btn {
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .primary-btn {
            background: var(--primary);
            color: white;
            border: none;
        }

        .primary-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(42, 85, 99, 0.3);
        }

        .secondary-btn {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .secondary-btn:hover {
            background: rgba(42, 85, 99, 0.05);
            transform: translateY(-2px);
        }

        .modal-info {
            margin-top: 2rem;
        }

        .info-section {
            margin-bottom: 2.5rem;
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary);
            display: inline-block;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 50%;
            height: 2px;
            background: var(--primary);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .nutrient-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 0.8rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: var(--transition);
        }

        .nutrient-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .nutrient-name {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .nutrient-value {
            font-size: 1.2rem;
            color: var(--primary);
        }

        .nutrient-progress {
            margin-top: 0.5rem;
            height: 5px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .nutrient-progress-bar {
            height: 100%;
            background: var(--secondary);
            width: 0;
            transition: width 1s ease-in-out;
        }

        .benefits-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .research-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 1rem;
            margin-bottom: 1rem;
            transition: var(--transition);
        }

        .research-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .research-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .comparison-table th, .comparison-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .comparison-table th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: #f9f9f9;
        }

        .brain-mechanisms {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .mechanism-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 1rem;
            transition: var(--transition);
        }

        .mechanism-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .mechanism-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .mechanism-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .mechanism-title {
            font-weight: 600;
            color: var(--dark);
        }

        .api-search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 1rem;
        }

        .api-toggle {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .api-toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .api-toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .api-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .api-toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .api-toggle-slider {
            background-color: var(--secondary);
        }

        input:checked + .api-toggle-slider:before {
            transform: translateX(26px);
        }

        .api-sources {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .api-source {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: rgba(255,255,255,0.2);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            font-weight: 500;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .api-source.active {
            background: white;
            color: var(--primary);
            border-color: white;
        }

        .api-source:hover {
            transform: translateY(-2px);
        }

        .error-message {
            display: none;
            background: #fff5f5;
            color: #ff6b6b;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 2rem 0;
            text-align: center;
            border-left: 4px solid #ff6b6b;
        }

        .no-results {
            display: none;
            text-align: center;
            margin: 3rem 0;
            color: #777;
        }

        .no-results i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #aaa;
        }

        .skeleton-loader {
            animation: pulse 1.5s infinite;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            border-radius: 0.5rem;
        }

        @keyframes pulse {
            0% { background-position: 0% 0%; }
            100% { background-position: -200% 0%; }
        }

        .skeleton-card {
            height: 450px;
            border-radius: 1.2rem;
        }

        .skeleton-list-item {
            height: 180px;
            border-radius: 1.2rem;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 3rem;
            gap: 0.5rem;
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: var(--transition);
        }

        .page-btn:hover {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .floating-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: var(--transition);
            z-index: 900;
            opacity: 0;
            transform: translateY(20px);
        }

        .floating-btn.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .floating-btn:hover {
            background: var(--secondary);
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast-message {
            font-weight: 500;
        }

        @media (max-width: 1024px) {
            .header-title {
                font-size: 2.2rem;
            }
            
            .brain-scores {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .header-title {
                font-size: 1.8rem;
            }
            
            .search-header {
                padding: 2rem 1.5rem;
            }
            
            .results-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 1.5rem;
            }
            
            .modal-header {
                flex-direction: column;
            }
            
            .modal-img-container {
                width: 150px;
                height: 150px;
                margin: 0 auto 1.5rem;
            }
            
            .modal-content {
                padding: 1.5rem;
                width: 95%;
            }

            .filters-toggle {
                display: flex;
            }

            .filters {
                display: none;
                margin-top: 1rem;
            }

            .filters.show {
                display: flex;
            }

            .supplement-list-item {
                flex-direction: column;
            }

            .list-item-image {
                width: 100%;
                height: 180px;
            }
            
            .slider-filters {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header-title {
                font-size: 1.5rem;
            }
            
            .controls-panel {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .pagination {
                gap: 0.3rem;
            }
            
            .page-btn {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .brain-scores {
                flex-wrap: wrap;
            }
            
            .brain-score {
                min-width: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="search-header">
            <div class="header-content">
                <div class="controls-row">
                    <button class="mode-toggle" id="modeToggle" aria-label="Toggle dark mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="view-toggle" id="viewToggle" aria-label="Toggle view mode">
                        <i class="fas fa-th-large"></i>
                    </button>
                </div>
                <h1 class="header-title">Supplement Intelligence Engine</h1>
                <p class="header-subtitle">Find the perfect supplements for your brain health and cognitive performance</p>
                
                <div class="api-search-header">
                    <h3>Search Sources</h3>
                    <div class="api-toggle">
                        <span>Include external APIs</span>
                        <label class="api-toggle-switch">
                            <input type="checkbox" id="apiToggle" checked>
                            <span class="api-toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="api-sources" id="apiSources">
                    <div class="api-source active" data-api="local">Local Database</div>
                    <div class="api-source active" data-api="openfoodfacts">Open Food Facts</div>
                    <div class="api-source active" data-api="examine">Examine.com</div>
                    <div class="api-source active" data-api="pubmed">PubMed</div>
                    <div class="api-source active" data-api="nih">NIH (ODS)</div>
                </div>
                
                <div class="search-tools">
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchInput" placeholder="Search supplements, ingredients, or health benefits...">
                        <i class="fas fa-times search-clear" id="searchClear"></i>
                    </div>
                    <button class="filters-toggle" id="filtersToggle">
                        <i class="fas fa-filter"></i> Show Filters
                    </button>
                    <div class="filters" id="filters">
                        <div class="filter-chip" data-filter="nootropic">
                            Nootropics
                            <span class="count">6</span>
                        </div>
                        <div class="filter-chip" data-filter="vitamin">
                            Vitamins
                            <span class="count">6</span>
                        </div>
                        <div class="filter-chip" data-filter="mineral">
                            Minerals
                            <span class="count">6</span>
                        </div>
                        <div class="filter-chip" data-filter="herbal">
                            Herbal
                            <span class="count">6</span>
                        </div>
                        <div class="filter-chip" data-filter="amino">
                            Amino Acids
                            <span class="count">6</span>
                        </div>
                        <div class="filter-chip" data-filter="protein">
                            Protein
                            <span class="count">6</span>
                        </div>
                    </div>
                    
                    <button class="advanced-filters-toggle" id="advancedFiltersToggle">
                        <i class="fas fa-sliders-h"></i> Advanced Brain Enhancement Filters
                    </button>
                    
                    <div class="advanced-filters" id="advancedFilters">
                        <div class="advanced-filters-content">
                            <div class="slider-filters">
                                <div class="slider-filter">
                                    <div class="slider-filter-title">
                                        <div class="score-label">
                                            <div class="score-icon neuro-icon">
                                                <i class="fas fa-brain"></i>
                                            </div>
                                            <span>Neural Genesis</span>
                                        </div>
                                        <span class="score-value" id="neuroValue">0+</span>
                                    </div>
                                    <input type="range" min="0" max="10" value="0" class="score-slider neuro-slider" id="neuroSlider">
                                    <div style="display: flex; justify-content: space-between; margin-top: 0.3rem; font-size: 0.8rem;">
                                        <span>Low</span>
                                        <span>High</span>
                                    </div>
                                </div>
                                
                                <div class="slider-filter">
                                    <div class="slider-filter-title">
                                        <div class="score-label">
                                            <div class="score-icon plasticity-icon">
                                                <i class="fas fa-network-wired"></i>
                                            </div>
                                            <span>Neuroplasticity</span>
                                        </div>
                                        <span class="score-value" id="plasticityValue">0+</span>
                                    </div>
                                    <input type="range" min="0" max="10" value="0" class="score-slider plasticity-slider" id="plasticitySlider">
                                    <div style="display: flex; justify-content: space-between; margin-top: 0.3rem; font-size: 0.8rem;">
                                        <span>Low</span>
                                        <span>High</span>
                                    </div>
                                </div>
                                
                                <div class="slider-filter">
                                    <div class="slider-filter-title">
                                        <div class="score-label">
                                            <div class="score-icon cognitive-icon">
                                                <i class="fas fa-lightbulb"></i>
                                            </div>
                                            <span>Cognitive Boost</span>
                                        </div>
                                        <span class="score-value" id="cognitiveValue">0+</span>
                                    </div>
                                    <input type="range" min="0" max="10" value="0" class="score-slider cognitive-slider" id="cognitiveSlider">
                                    <div style="display: flex; justify-content: space-between; margin-top: 0.3rem; font-size: 0.8rem;">
                                        <span>Low</span>
                                        <span>High</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="controls-panel">
            <div class="results-count" id="resultsCount"></div>
            <div class="control-group">
                <select id="sortSelect">
                    <option value="relevance">Sort by: Relevance</option>
                    <option value="rating">Sort by: Rating (High to Low)</option>
                    <option value="price-low">Sort by: Price (Low to High)</option>
                    <option value="price-high">Sort by: Price (High to Low)</option>
                    <option value="name">Sort by: Name (A-Z)</option>
                    <option value="neurogenesis">Sort by: Neural Genesis</option>
                    <option value="neuroplasticity">Sort by: Neuroplasticity</option>
                    <option value="cognitive">Sort by: Cognitive Boost</option>
                </select>
                <select id="viewSelect">
                    <option value="9">Show: 9 per page</option>
                    <option value="18">Show: 18 per page</option>
                    <option value="36">Show: 36 per page</option>
                </select>
            </div>
        </div>

        <div class="results-container">
            <div class="loader" id="loader">
                <div class="loader-spinner"></div>
                <p>Searching for supplements...</p>
            </div>
            
            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-circle"></i>
                <p>Sorry, we couldn't fetch the supplement data. Please try again later.</p>
            </div>
            
            <div class="no-results" id="noResults">
                <i class="fas fa-search"></i>
                <h3>No supplements found</h3>
                <p>Try adjusting your search terms or filters</p>
            </div>
            
            <div id="results" class="results-grid"></div>
            
            <div class="pagination" id="pagination"></div>
        </div>

        <div id="modal" class="modal">
            <div class="modal-content" id="modalContent">
                <button class="modal-close" id="modalClose" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
                <div id="modalBody"></div>
            </div>
        </div>

        <button class="floating-btn" id="scrollTopBtn" aria-label="Scroll to top">
            <i class="fas fa-arrow-up"></i>
        </button>

        <div class="toast" id="toast">
            <div class="toast-icon">
                <i class="fas fa-check"></i>
            </div>
            <span class="toast-message">Item added to bookmarks</span>
        </div>
    </div>

<script>
// Enhanced Supplement Data Structure with brain enhancement scores
const SUPPLEMENT_CATEGORIES = {
    nootropic: ['Lion\'s Mane', 'Bacopa Monnieri', 'Rhodiola', 'L-Theanine', 'Ginkgo Biloba', 'Alpha-GPC'],
    vitamin: ['Vitamin D', 'Vitamin C', 'Vitamin B12', 'Vitamin E', 'Vitamin K', 'Multivitamin'],
    mineral: ['Magnesium', 'Zinc', 'Iron', 'Calcium', 'Selenium', 'Potassium'],
    herbal: ['Turmeric', 'Ashwagandha', 'Ginseng', 'Echinacea', 'Valerian Root', 'St. John\'s Wort'],
    amino: ['L-Arginine', 'L-Glutamine', 'BCAAs', 'Creatine', 'Taurine', 'Glycine'],
    protein: ['Whey Protein', 'Casein', 'Collagen', 'Plant Protein', 'Protein Bars', 'Protein Powder']
};

// Expanded mock supplement data with brain enhancement scores
const MOCK_SUPPLEMENTS = [
    {
        id: 1,
        name: "Premium Lion's Mane Extract",
        brand: "MycoPure",
        image: "https://images.pexels.com/photos/5829747/pexels-photo-5829747.jpeg",
        price: 34.99,
        rating: 4.7,
        category: "nootropic",
        benefits: ["Cognitive Function", "Nerve Health", "Focus"],
        ingredients: "Organic Lion's Mane Mushroom Extract (Hericium erinaceus), Vegetable Cellulose Capsule",
        nutrients: {
            "Beta Glucans": 500,
            "Polysaccharides": 300,
            "Erinacines": 10
        },
        dosage: "2 capsules daily with food",
        ecoScore: "a",
        novaScore: 1,
        description: "Our premium Lion's Mane extract is sourced from organic mushrooms and standardized to contain high levels of beta-glucans and erinacines, the compounds responsible for Lion's Mane's cognitive benefits.",
        research: [
            {
                title: "Neurological Effects of Lion's Mane Mushroom",
                summary: "Research suggests that Lion's Mane may promote nerve growth factor (NGF) synthesis, which could support cognitive function and nerve health."
            },
            {
                title: "Lion's Mane and Memory",
                summary: "Several studies indicate potential benefits for memory and cognitive function, particularly in older adults."
            }
        ],
        reviews: 128,
        stock: "In Stock",
        form: "Capsules",
        servings: 30,
        neurogenesis: 9,
        neuroplasticity: 7,
        cognitive: 8,
        brainMechanisms: [
            {
                name: "NGF Promotion",
                description: "Lion's Mane contains hericenones and erinacines that stimulate Nerve Growth Factor (NGF) production, supporting neuronal growth and repair."
            },
            {
                name: "Neuroprotection",
                description: "Exhibits antioxidant properties that help protect neurons from oxidative stress and inflammation."
            },
            {
                name: "Myelination Support",
                description: "May help promote myelination, the process that forms protective sheaths around nerve fibers, improving neural transmission."
            }
        ]
    },
    {
        id: 2,
        name: "Vitamin D3 + K2 Complex",
        brand: "VitaOptimum",
        image: "https://images.pexels.com/photos/7715818/pexels-photo-7715818.jpeg",
        price: 24.95,
        rating: 4.8,
        category: "vitamin",
        benefits: ["Bone Health", "Immune Support", "Heart Health"],
        ingredients: "Vitamin D3 (as Cholecalciferol), Vitamin K2 (as MK-7), MCT Oil, Olive Oil, Gelatin Capsule",
        nutrients: {
            "Vitamin D3": 5000,
            "Vitamin K2": 100,
            "MCT Oil": 50
        },
        dosage: "1 softgel daily with a meal",
        ecoScore: "b",
        novaScore: 1,
        description: "Our D3+K2 formula provides the perfect synergy of these fat-soluble vitamins to support bone health and cardiovascular function. The vitamin D3 is derived from lanolin and combined with K2 as MK-7, the most bioavailable form.",
        research: [
            {
                title: "Vitamin D and Immune Function",
                summary: "Vitamin D plays a crucial role in immune function and deficiency has been linked to increased susceptibility to infection."
            },
            {
                title: "Synergistic Effects of Vitamin D3 and K2",
                summary: "Research suggests that combining vitamins D3 and K2 may provide greater benefits for bone and cardiovascular health than either vitamin alone."
            }
        ],
        reviews: 245,
        stock: "In Stock",
        form: "Softgels",
        servings: 60,
        neurogenesis: 4,
        neuroplasticity: 3,
        cognitive: 5,
        brainMechanisms: [
            {
                name: "Neuroprotection",
                description: "Vitamin D receptors are present throughout the brain and may help protect neurons from damage."
            },
            {
                name: "Neurotransmitter Support",
                description: "May influence the synthesis of neurotransmitters involved in mood regulation and cognitive function."
            },
            {
                name: "Anti-inflammatory Effects",
                description: "Can help reduce neuroinflammation, which is associated with cognitive decline and mood disorders."
            }
        ]
    },
    {
        id: 3,
        name: "Triple Magnesium Complex",
        brand: "MineralMax",
        image: "https://images.pexels.com/photos/6692159/pexels-photo-6692159.jpeg",
        price: 19.99,
        rating: 4.6,
        category: "mineral",
        benefits: ["Muscle Function", "Sleep Quality", "Stress Relief"],
        ingredients: "Magnesium Glycinate, Magnesium Malate, Magnesium Threonate, Vegetable Cellulose Capsule",
        nutrients: {
            "Magnesium Glycinate": 150,
            "Magnesium Malate": 100,
            "Magnesium Threonate": 50
        },
        dosage: "2 capsules before bedtime",
        ecoScore: "b",
        novaScore: 1,
        description: "Our Triple Magnesium Complex combines three highly bioavailable forms of magnesium to provide comprehensive benefits. Magnesium glycinate for sleep and stress, malate for energy production, and threonate for cognitive support.",
        research: [
            {
                title: "Magnesium and Sleep Quality",
                summary: "Studies suggest that magnesium supplementation may improve sleep quality, particularly in individuals with low magnesium levels."
            },
            {
                title: "Magnesium Threonate and Cognitive Function",
                summary: "Emerging research indicates that magnesium threonate may support cognitive function due to its ability to cross the blood-brain barrier."
            }
        ],
        reviews: 187,
        stock: "In Stock",
        form: "Capsules",
        servings: 30,
        neurogenesis: 5,
        neuroplasticity: 8,
        cognitive: 7,
        brainMechanisms: [
            {
                name: "Synaptic Plasticity",
                description: "Magnesium threonate has been shown to enhance synaptic plasticity, the ability of synapses to strengthen or weaken over time."
            },
            {
                name: "NMDA Receptor Modulation",
                description: "Regulates NMDA receptors involved in learning and memory processes."
            },
            {
                name: "Neural Density",
                description: "May increase synapse density in the hippocampus, a brain region crucial for memory formation."
            }
        ]
    },
    {
        id: 4,
        name: "Organic Turmeric Curcumin",
        brand: "HerbPure",
        image: "https://images.pexels.com/photos/4498128/pexels-photo-4498128.jpeg",
        price: 29.95,
        rating: 4.5,
        category: "herbal",
        benefits: ["Anti-Inflammatory", "Antioxidant", "Joint Support"],
        ingredients: "Organic Turmeric Root Extract, BioPerine (Black Pepper Extract), Vegetable Cellulose Capsule",
        nutrients: {
            "Curcumin": 500,
            "BioPerine": 5,
            "Turmerones": 15
        },
        dosage: "2 capsules daily with food",
        ecoScore: "a",
        novaScore: 1,
        description: "Our organic turmeric supplement is standardized to contain 95% curcuminoids and includes BioPerine for enhanced absorption. Curcumin is a powerful antioxidant that helps maintain a healthy inflammatory response.",
        research: [
            {
                title: "Curcumin and Inflammation",
                summary: "Numerous studies suggest that curcumin may help reduce inflammation by inhibiting inflammatory enzymes and pathways."
            },
            {
                title: "Bioavailability of Curcumin",
                summary: "Research shows that combining curcumin with black pepper extract (piperine) can significantly increase its bioavailability."
            }
        ],
        reviews: 356,
        stock: "In Stock",
        form: "Capsules",
        servings: 30,
        neurogenesis: 6,
        neuroplasticity: 5,
        cognitive: 6,
        brainMechanisms: [
            {
                name: "BDNF Promotion",
                description: "Curcumin may increase levels of brain-derived neurotrophic factor (BDNF), a growth hormone that functions in the brain."
            },
            {
                name: "Anti-inflammatory",
                description: "Reduces neuroinflammation, which is linked to cognitive decline and neurodegenerative conditions."
            },
            {
                name: "Antioxidant Protection",
                description: "Protects neurons from oxidative damage by neutralizing free radicals in the brain."
            }
        ]
    },
    {
        id: 5,
        name: "Ashwagandha KSM-66",
        brand: "AdaptoCare",
        image: "https://images.pexels.com/photos/8805131/pexels-photo-8805131.jpeg",
        price: 27.99,
        rating: 4.9,
        category: "herbal",
        benefits: ["Stress Relief", "Energy", "Hormone Balance"],
        ingredients: "KSM-66 Ashwagandha Root Extract, Vegetable Cellulose Capsule",
        nutrients: {
            "Withanolides": 25,
            "Ashwagandha Extract": 600
        },
        dosage: "1 capsule twice daily",
        ecoScore: "a",
        novaScore: 1,
        description: "Our Ashwagandha contains the patented KSM-66 extract, the highest concentration full-spectrum extract available, derived from organic ashwagandha roots. It's perfect for supporting your body's response to stress and promoting overall wellbeing.",
        research: [
            {
                title: "Ashwagandha and Stress Response",
                summary: "Clinical studies suggest that ashwagandha may help reduce cortisol levels and improve resistance to stress."
            },
            {
                title: "Ashwagandha and Athletic Performance",
                summary: "Research indicates potential benefits for exercise performance, recovery, and strength development."
            }
        ],
        reviews: 215,
        stock: "In Stock",
        form: "Capsules",
        servings: 60,
        neurogenesis: 7,
        neuroplasticity: 6,
        cognitive: 8,
        brainMechanisms: [
            {
                name: "Stress Adaptation",
                description: "Helps regulate the HPA axis (hypothalamic-pituitary-adrenal) to modulate cortisol and stress hormone production."
            },
            {
                name: "GABA Receptor Support",
                description: "Withanolides in ashwagandha may mimic GABA activity, promoting calm and reducing anxiety."
            },
            {
                name: "Neuroprotection",
                description: "Contains antioxidants that help protect neural tissues from free radical damage."
            }
        ]
    },
    {
        id: 6,
        name: "BCAA Recovery Formula",
        brand: "AminoFuel",
        image: "https://images.pexels.com/photos/3910072/pexels-photo-3910072.jpeg",
        price: 39.99,
        rating: 4.4,
        category: "amino",
        benefits: ["Muscle Recovery", "Endurance", "Reduced Soreness"],
        ingredients: "L-Leucine, L-Isoleucine, L-Valine, Coconut Water Powder, Electrolytes",
        nutrients: {
            "L-Leucine": 2500,
            "L-Isoleucine": 1250,
            "L-Valine": 1250,
            "Sodium": 50,
            "Potassium": 100
        },
        dosage: "1 scoop during or after workout",
        ecoScore: "c",
        novaScore: 2,
        description: "Our BCAA formula provides the optimal 2:1:1 ratio of leucine, isoleucine, and valine, along with electrolytes to support hydration and recovery. Perfect for intra-workout support or post-exercise recovery.",
        research: [
            {
                title: "BCAAs and Muscle Protein Synthesis",
                summary: "Research suggests that leucine, in particular, may stimulate muscle protein synthesis, which is important for recovery and growth."
            },
            {
                title: "BCAAs and Exercise-Induced Muscle Damage",
                summary: "Studies indicate that BCAA supplementation may help reduce exercise-induced muscle damage and soreness."
            }
        ],
        reviews: 92,
        stock: "In Stock",
        form: "Powder",
        servings: 30,
        neurogenesis: 2,
        neuroplasticity: 3,
        cognitive: 4,
        brainMechanisms: [
            {
                name: "Energy Metabolism",
                description: "BCAAs can be used as an energy source by the brain during intense cognitive tasks."
            },
            {
                name: "Neurotransmitter Synthesis",
                description: "BCAAs are precursors to neurotransmitters that play roles in mood and cognition."
            },
            {
                name: "Exercise Support",
                description: "By supporting exercise performance, indirectly benefits brain health through improved circulation and reduced stress."
            }
        ]
    },
    {
        id: 7,
        name: "Ultra Collagen Peptides",
        brand: "PeptidePlus",
        image: "https://images.pexels.com/photos/5264372/pexels-photo-5264372.jpeg",
        price: 32.50,
        rating: 4.7,
        category: "protein",
        benefits: ["Skin Health", "Joint Support", "Hair & Nails"],
        ingredients: "Hydrolyzed Bovine Collagen Peptides (Types I & III), Vitamin C, Hyaluronic Acid",
        nutrients: {
            "Collagen": 10000,
            "Vitamin C": 50,
            "Hyaluronic Acid": 25
        },
        dosage: "1-2 scoops daily in beverage of choice",
        ecoScore: "b",
        novaScore: 1,
        description: "Our premium collagen peptides are enzymatically hydrolyzed for optimal absorption and bioavailability. Enhanced with vitamin C and hyaluronic acid, this formula supports skin elasticity, joint health, and strong hair and nails.",
        research: [
            {
                title: "Collagen Supplementation and Skin Health",
                summary: "Clinical studies suggest that collagen peptides may improve skin elasticity, hydration, and dermal collagen density."
            },
            {
                title: "Collagen and Joint Function",
                summary: "Research indicates that collagen supplementation may support joint comfort and mobility, particularly in active individuals."
            }
        ],
        reviews: 178,
        stock: "In Stock",
        form: "Powder",
        servings: 30,
        neurogenesis: 1,
        neuroplasticity: 2,
        cognitive: 1,
        brainMechanisms: [
            {
                name: "Structural Support",
                description: "Provides amino acids that contribute to the structural integrity of the blood-brain barrier."
            },
            {
                name: "Glycine Provision",
                description: "Contains glycine, which can act as an inhibitory neurotransmitter in the central nervous system."
            },
            {
                name: "Anti-aging Support",
                description: "May support overall cellular health, indirectly benefiting neural tissues."
            }
        ]
    },
    {
        id: 8,
        name: "Complete Multivitamin Plus",
        brand: "VitaOptimum",
        image: "https://images.pexels.com/photos/8423143/pexels-photo-8423143.jpeg",
        price: 29.99,
        rating: 4.6,
        category: "vitamin",
        benefits: ["Nutrient Support", "Energy", "Immune Health"],
        ingredients: "Vitamins A, C, D3, E, K2, B-Complex, Zinc, Magnesium, Selenium, Iron, Iodine, Chromium, Biotin, Folate",
        nutrients: {
            "Vitamin D3": 2000,
            "Vitamin C": 500,
            "Vitamin B12": 100,
            "Zinc": 15,
            "Magnesium": 100
        },
        dosage: "2 capsules daily with a meal",
        ecoScore: "b",
        novaScore: 1,
        description: "Our Complete Multivitamin Plus formula delivers comprehensive nutritional support with premium forms of essential vitamins and minerals, including methylated B vitamins for optimal absorption and utilization.",
        research: [
            {
                title: "Multivitamin Supplements and Nutritional Gaps",
                summary: "Research suggests that multivitamin supplements may help fill nutritional gaps in the diet, particularly for specific populations."
            },
            {
                title: "B Vitamins and Energy Metabolism",
                summary: "B vitamins play essential roles in energy production and metabolism at the cellular level."
            }
        ],
        reviews: 289,
        stock: "In Stock",
        form: "Capsules",
        servings: 30,
        neurogenesis: 5,
        neuroplasticity: 6,
        cognitive: 7,
        brainMechanisms: [
            {
                name: "Methylation Support",
                description: "B vitamins are crucial for methylation processes that affect neurotransmitter synthesis and DNA expression."
            },
            {
                name: "Energy Production",
                description: "Supports mitochondrial function in neurons, providing energy needed for cognitive processes."
            },
            {
                name: "Homocysteine Regulation",
                description: "Helps maintain healthy homocysteine levels, which is important for brain and cardiovascular health."
            }
        ]
    },
    {
        id: 9,
        name: "Alpha-GPC Cognitive Support",
        brand: "NeuroPeak",
        image: "https://images.pexels.com/photos/9694012/pexels-photo-9694012.jpeg",
        price: 44.95,
        rating: 4.8,
        category: "nootropic",
        benefits: ["Memory", "Focus", "Brain Health"],
        ingredients: "Alpha-GPC (Alpha-glycerylphosphorylcholine), Vegetable Cellulose Capsule",
        nutrients: {
            "Alpha-GPC": 300,
            "Choline": 120
        },
        dosage: "1 capsule 1-2 times daily",
        ecoScore: "b",
        novaScore: 1,
        description: "Alpha-GPC is a natural choline compound that supports cognitive function and brain health. It serves as a precursor to acetylcholine, a neurotransmitter involved in memory and learning processes.",
        research: [
            {
                title: "Alpha-GPC and Cognitive Function",
                summary: "Studies suggest that Alpha-GPC may support various aspects of cognitive function, including attention, memory, and mental processing."
            },
            {
                title: "Alpha-GPC and Acetylcholine",
                summary: "Research indicates that Alpha-GPC effectively delivers choline to the brain for acetylcholine synthesis, which is important for cognitive processes."
            }
        ],
        reviews: 124,
        stock: "In Stock",
        form: "Capsules",
        servings: 60,
        neurogenesis: 7,
        neuroplasticity: 9,
        cognitive: 9,
        brainMechanisms: [
            {
                name: "Acetylcholine Synthesis",
                description: "Provides choline that serves as a direct precursor to acetylcholine, a neurotransmitter critical for memory and learning."
            },
            {
                name: "Membrane Fluidity",
                description: "Contributes to the phospholipid content of cell membranes, supporting optimal neuronal signaling."
            },
            {
                name: "Synaptic Transmission",
                description: "Enhances the efficiency of synaptic transmission, improving communication between neurons."
            }
        ]
    },
    {
        id: 10,
        name: "Plant-Based Protein Complete",
        brand: "GreenProtein",
        image: "https://images.pexels.com/photos/5946083/pexels-photo-5946083.jpeg",
        price: 36.99,
        rating: 4.5,
        category: "protein",
        benefits: ["Muscle Recovery", "Plant Nutrition", "Digestive Support"],
        ingredients: "Organic Pea Protein, Organic Brown Rice Protein, Organic Hemp Protein, Digestive Enzymes, Prebiotics",
        nutrients: {
            "Protein": 25000,
            "BCAAs": 4500,
            "Fiber": 3000,
            "Iron": 5
        },
        dosage: "1 scoop in 8-12 oz of water or plant milk",
        ecoScore: "a",
        novaScore: 1,
        description: "Our complete plant-based protein combines three complementary protein sources to deliver all essential amino acids with a smooth texture and great taste. Enhanced with digestive enzymes for optimal absorption and comfort.",
        research: [
            {
                title: "Plant Protein and Muscle Building",
                summary: "Recent studies indicate that plant proteins, when properly formulated to provide all essential amino acids, can effectively support muscle protein synthesis."
            },
            {
                title: "Plant Protein and Digestibility",
                summary: "Research suggests that combining plant protein sources and including digestive enzymes may improve protein digestibility and amino acid absorption."
            }
        ],
        reviews: 211,
        stock: "In Stock",
        form: "Powder",
        servings: 20,
        neurogenesis: 3,
        neuroplasticity: 2,
        cognitive: 3,
        brainMechanisms: [
            {
                name: "Amino Acid Provision",
                description: "Provides essential amino acids required for neurotransmitter synthesis and neuronal repair."
            },
            {
                name: "Blood Sugar Stabilization",
                description: "Helps maintain steady blood glucose levels, supporting consistent cognitive energy."
            },
            {
                name: "Gut-Brain Connection",
                description: "Contains prebiotics that support gut health, which is linked to cognitive function through the gut-brain axis."
            }
        ]
    },
    {
        id: 11,
        name: "Zinc + Quercetin Complex",
        brand: "MineralMax",
        image: "https://images.pexels.com/photos/3693149/pexels-photo-3693149.jpeg",
        price: 18.99,
        rating: 4.7,
        category: "mineral",
        benefits: ["Immune Support", "Antioxidant", "Cellular Health"],
        ingredients: "Zinc Bisglycinate, Quercetin Dihydrate, Vitamin C (as Ascorbic Acid), Vegetable Cellulose Capsule",
        nutrients: {
            "Zinc": 30,
            "Quercetin": 500,
            "Vitamin C": 250
        },
        dosage: "1 capsule daily with food",
        ecoScore: "b",
        novaScore: 1,
        description: "Our Zinc + Quercetin formula combines highly absorbable zinc bisglycinate with quercetin, a powerful flavonoid. This synergistic combination supports immune function, provides antioxidant protection, and promotes overall cellular health.",
        research: [
            {
                title: "Zinc and Immune Function",
                summary: "Zinc plays crucial roles in various immune functions, including the development and function of immune cells."
            },
            {
                title: "Quercetin's Antioxidant Properties",
                summary: "Research suggests that quercetin exhibits antioxidant and anti-inflammatory properties that may complement zinc's immune-supporting effects."
            }
        ],
        reviews: 156,
        stock: "In Stock",
        form: "Capsules",
        servings: 60,
        neurogenesis: 4,
        neuroplasticity: 5,
        cognitive: 5,
        brainMechanisms: [
            {
                name: "Antioxidant Protection",
                description: "Quercetin crosses the blood-brain barrier and protects neurons from oxidative damage."
            },
            {
                name: "Zinc-dependent Enzymes",
                description: "Supports hundreds of zinc-dependent enzymes involved in brain function and neurotransmitter activity."
            },
            {
                name: "DNA Repair",
                description: "Zinc is essential for DNA repair mechanisms that maintain neuronal genome integrity."
            }
        ]
    },
    {
        id: 12,
        name: "Bacopa Monnieri Extract",
        brand: "NeuroPeak",
        image: "https://images.pexels.com/photos/3850576/pexels-photo-3850576.jpeg",
        price: 27.99,
        rating: 4.6,
        category: "nootropic",
        benefits: ["Memory", "Stress Reduction", "Cognitive Support"],
        ingredients: "Bacopa Monnieri Extract (standardized to 50% bacosides), Organic Rice Concentrate, Vegetable Cellulose Capsule",
        nutrients: {
            "Bacosides": 150,
            "Bacopa Extract": 300
        },
        dosage: "1 capsule twice daily with meals",
        ecoScore: "a",
        novaScore: 1,
        description: "Our Bacopa extract is standardized to contain 50% bacosides, the active compounds responsible for Bacopa's cognitive benefits. This traditional Ayurvedic herb has been used for centuries to support memory, learning, and mental clarity.",
        research: [
            {
                title: "Bacopa and Memory Enhancement",
                summary: "Clinical studies suggest that Bacopa monnieri may improve memory formation and retention, particularly with consistent use over time."
            },
            {
                title: "Bacopa and Stress Response",
                summary: "Research indicates that Bacopa may help modulate the stress response and support a calm, focused state of mind."
            }
        ],
        reviews: 118,
        stock: "In Stock",
        form: "Capsules",
        servings: 60,
        neurogenesis: 8,
        neuroplasticity: 9,
        cognitive: 9,
        brainMechanisms: [
            {
                name: "Dendritic Branching",
                description: "Bacosides promote dendritic branching in neurons, enhancing neural connectivity."
            },
            {
                name: "Neurotransmitter Modulation",
                description: "Supports healthy levels of acetylcholine, serotonin, and dopamine, which are crucial for memory and mood."
            },
            {
                name: "Anti-stress Adaptation",
                description: "Adapts the brain's response to stress, protecting neurons from stress-induced damage."
            }
        ]
    }
];

// Public APIs for supplements
const API_ENDPOINTS = {
    openfoodfacts: {
        url: "https://world.openfoodfacts.org/cgi/search.pl",
        params: {
            json: 1,
            search_terms: "{query}",
            page_size: 20,
            tagtype_0: "categories",
            tag_contains_0: "contains",
            tag_0: "supplements"
        },
        parser: parseOpenFoodFactsData
    },
    examine: {
        url: "https://api.example.com/examine/search", // Mock URL
        params: {
            query: "{query}",
            limit: 10
        },
        parser: parseExamineData
    },
    pubmed: {
        url: "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi",
        params: {
            db: "pubmed",
            term: "{query}+supplement",
            retmode: "json",
            retmax: 5
        },
        parser: parsePubMedData
    },
    nih: {
        url: "https://api.example.com/nih/supplements", // Mock URL
        params: {
            query: "{query}",
            limit: 10
        },
        parser: parseNIHData
    }
};

// State management
let currentSupplements = [];
let currentPage = 1;
let itemsPerPage = 9;
let activeFilters = [];
let currentSort = 'relevance';
let isLoading = false;
let darkMode = false;
let viewMode = 'grid';
let bookmarkedItems = [];
let activeAPIs = ['local', 'openfoodfacts', 'examine', 'pubmed', 'nih'];
let useAPIs = true;
let brainScoreFilters = {
    neurogenesis: 0,
    neuroplasticity: 0,
    cognitive: 0
};

// DOM Elements
const searchInput = document.getElementById('searchInput');
const searchClear = document.getElementById('searchClear');
const filterChips = document.querySelectorAll('.filter-chip');
const resultsContainer = document.getElementById('results');
const loaderElement = document.getElementById('loader');
const errorMessage = document.getElementById('errorMessage');
const noResultsMessage = document.getElementById('noResults');
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
const modalClose = document.getElementById('modalClose');
const modalBody = document.getElementById('modalBody');
const sortSelect = document.getElementById('sortSelect');
const viewSelect = document.getElementById('viewSelect');
const paginationContainer = document.getElementById('pagination');
const modeToggle = document.getElementById('modeToggle');
const viewToggle = document.getElementById('viewToggle');
const scrollTopBtn = document.getElementById('scrollTopBtn');
const toast = document.getElementById('toast');
const resultsCount = document.getElementById('resultsCount');
const filtersToggle = document.getElementById('filtersToggle');
const filtersContainer = document.getElementById('filters');
const apiToggle = document.getElementById('apiToggle');
const apiSources = document.querySelectorAll('.api-source');
const advancedFiltersToggle = document.getElementById('advancedFiltersToggle');
const advancedFilters = document.getElementById('advancedFilters');
const neuroSlider = document.getElementById('neuroSlider');
const plasticitySlider = document.getElementById('plasticitySlider');
const cognitiveSlider = document.getElementById('cognitiveSlider');
const neuroValue = document.getElementById('neuroValue');
const plasticityValue = document.getElementById('plasticityValue');
const cognitiveValue = document.getElementById('cognitiveValue');

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    // Check for stored preferences
    loadUserPreferences();
    
    // Initial load of supplements
    showLoading();
    setTimeout(() => {
        fetchAndDisplaySupplements();
    }, 800); // Simulate network delay

    // Event listeners
    setupEventListeners();

    // Check scroll position for floating button
    window.addEventListener('scroll', handleScroll);
});

function loadUserPreferences() {
    // Check local storage for preferences
    const storedDarkMode = localStorage.getItem('darkMode');
    if (storedDarkMode === 'true') {
        darkMode = true;
        document.body.classList.add('dark-mode');
        modeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    }

    const storedViewMode = localStorage.getItem('viewMode');
    if (storedViewMode) {
        viewMode = storedViewMode;
        updateViewToggleIcon();
    }

    const storedItemsPerPage = localStorage.getItem('itemsPerPage');
    if (storedItemsPerPage) {
        itemsPerPage = parseInt(storedItemsPerPage);
        viewSelect.value = itemsPerPage;
    }

    // Load bookmarked items
    const storedBookmarks = localStorage.getItem('bookmarkedItems');
    if (storedBookmarks) {
        bookmarkedItems = JSON.parse(storedBookmarks);
    }
    
    // Load API preferences
    const storedUseAPIs = localStorage.getItem('useAPIs');
    if (storedUseAPIs !== null) {
        useAPIs = storedUseAPIs === 'true';
        apiToggle.checked = useAPIs;
    }
    
    const storedActiveAPIs = localStorage.getItem('activeAPIs');
    if (storedActiveAPIs) {
        activeAPIs = JSON.parse(storedActiveAPIs);
        
        // Update API source buttons
        apiSources.forEach(source => {
            const api = source.dataset.api;
            if (activeAPIs.includes(api)) {
                source.classList.add('active');
            } else {
                source.classList.remove('active');
            }
        });
    }
    
    // Load brain score filters
    const storedBrainScores = localStorage.getItem('brainScoreFilters');
    if (storedBrainScores) {
        brainScoreFilters = JSON.parse(storedBrainScores);
        
        // Update sliders
        neuroSlider.value = brainScoreFilters.neurogenesis;
        plasticitySlider.value = brainScoreFilters.neuroplasticity;
        cognitiveSlider.value = brainScoreFilters.cognitive;
        
        // Update displayed values
        neuroValue.textContent = brainScoreFilters.neurogenesis > 0 ? `${brainScoreFilters.neurogenesis}+` : '0+';
        plasticityValue.textContent = brainScoreFilters.neuroplasticity > 0 ? `${brainScoreFilters.neuroplasticity}+` : '0+';
        cognitiveValue.textContent = brainScoreFilters.cognitive > 0 ? `${brainScoreFilters.cognitive}+` : '0+';
    }
}

function updateViewToggleIcon() {
    viewToggle.innerHTML = viewMode === 'grid' ? 
        '<i class="fas fa-list"></i>' : 
        '<i class="fas fa-th-large"></i>';
}

function setupEventListeners() {
    // Search input with debounce
    let debounceTimeout;
    searchInput.addEventListener('input', () => {
        clearTimeout(debounceTimeout);
        
        // Show/hide clear button
        if (searchInput.value) {
            searchClear.classList.add('visible');
        } else {
            searchClear.classList.remove('visible');
        }
        
        debounceTimeout = setTimeout(() => {
            currentPage = 1;
            fetchAndDisplaySupplements();
        }, 500);
    });

    // Search clear button
    searchClear.addEventListener('click', () => {
        searchInput.value = '';
        searchClear.classList.remove('visible');
        fetchAndDisplaySupplements();
        searchInput.focus();
    });

    // Filter chips
    filterChips.forEach(chip => {
        chip.addEventListener('click', () => {
            chip.classList.toggle('active');
            
            const filter = chip.dataset.filter;
            if (chip.classList.contains('active')) {
                activeFilters.push(filter);
            } else {
                activeFilters = activeFilters.filter(f => f !== filter);
            }
            
            currentPage = 1;
            fetchAndDisplaySupplements();
        });
    });

    // Sort select
    sortSelect.addEventListener('change', () => {
        currentSort = sortSelect.value;
        fetchAndDisplaySupplements();
    });

    // View select (items per page)
    viewSelect.addEventListener('change', () => {
        itemsPerPage = parseInt(viewSelect.value);
        localStorage.setItem('itemsPerPage', itemsPerPage);
        currentPage = 1;
        fetchAndDisplaySupplements();
    });

    // Modal close
    modalClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
    });

    // Dark mode toggle
    modeToggle.addEventListener('click', toggleDarkMode);

    // View mode toggle
    viewToggle.addEventListener('click', toggleViewMode);

    // Scroll to top button
    scrollTopBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Filters toggle on mobile
    filtersToggle.addEventListener('click', () => {
        filtersContainer.classList.toggle('show');
        filtersToggle.innerHTML = filtersContainer.classList.contains('show') ?
            '<i class="fas fa-times"></i> Hide Filters' :
            '<i class="fas fa-filter"></i> Show Filters';
    });
    
    // Advanced filters toggle
    advancedFiltersToggle.addEventListener('click', () => {
        advancedFilters.classList.toggle('open');
        advancedFiltersToggle.innerHTML = advancedFilters.classList.contains('open') ?
            '<i class="fas fa-chevron-up"></i> Hide Brain Enhancement Filters' :
            '<i class="fas fa-sliders-h"></i> Advanced Brain Enhancement Filters';
    });
    
    // Brain score sliders
    neuroSlider.addEventListener('input', () => {
        const value = neuroSlider.value;
        neuroValue.textContent = value > 0 ? `${value}+` : '0+';
        brainScoreFilters.neurogenesis = parseInt(value);
        saveAndApplyBrainScoreFilters();
    });
    
    plasticitySlider.addEventListener('input', () => {
        const value = plasticitySlider.value;
        plasticityValue.textContent = value > 0 ? `${value}+` : '0+';
        brainScoreFilters.neuroplasticity = parseInt(value);
        saveAndApplyBrainScoreFilters();
    });
    
    cognitiveSlider.addEventListener('input', () => {
        const value = cognitiveSlider.value;
        cognitiveValue.textContent = value > 0 ? `${value}+` : '0+';
        brainScoreFilters.cognitive = parseInt(value);
        saveAndApplyBrainScoreFilters();
    });
    
    // API toggle
    apiToggle.addEventListener('change', () => {
        useAPIs = apiToggle.checked;
        localStorage.setItem('useAPIs', useAPIs);
        fetchAndDisplaySupplements();
    });
    
    // API sources
    apiSources.forEach(source => {
        source.addEventListener('click', () => {
            source.classList.toggle('active');
            
            const api = source.dataset.api;
            if (source.classList.contains('active')) {
                if (!activeAPIs.includes(api)) {
                    activeAPIs.push(api);
                }
            } else {
                activeAPIs = activeAPIs.filter(a => a !== api);
            }
            
            localStorage.setItem('activeAPIs', JSON.stringify(activeAPIs));
            fetchAndDisplaySupplements();
        });
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('open')) {
            closeModal();
        }
    });
}

function saveAndApplyBrainScoreFilters() {
    localStorage.setItem('brainScoreFilters', JSON.stringify(brainScoreFilters));
    clearTimeout(this.brainScoreTimeout);
    this.brainScoreTimeout = setTimeout(() => {
        currentPage = 1;
        fetchAndDisplaySupplements();
    }, 500);
}

function handleScroll() {
    if (window.scrollY > 500) {
        scrollTopBtn.classList.add('visible');
    } else {
        scrollTopBtn.classList.remove('visible');
    }
}

function toggleDarkMode() {
    darkMode = !darkMode;
    document.body.classList.toggle('dark-mode', darkMode);
    modeToggle.innerHTML = darkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    localStorage.setItem('darkMode', darkMode);
}

function toggleViewMode() {
    viewMode = viewMode === 'grid' ? 'list' : 'grid';
    updateViewToggleIcon();
    localStorage.setItem('viewMode', viewMode);
    renderResults(currentSupplements);
}

async function fetchSupplementsFromAPI(query) {
    if (!useAPIs || activeAPIs.length === 0 || !query) {
        return [];
    }
    
    let apiResults = [];
    
    const apiPromises = activeAPIs
        .filter(api => api !== 'local')
        .map(api => {
            if (!API_ENDPOINTS[api]) return Promise.resolve([]);
            
            return new Promise(async (resolve) => {
                try {
                    // Build the API URL
                    const endpoint = API_ENDPOINTS[api];
                    const url = new URL(endpoint.url);
                    
                    // Add query parameters
                    Object.entries(endpoint.params).forEach(([key, value]) => {
                        url.searchParams.append(key, value.replace('{query}', query));
                    });
                    
                    // Fetch data with timeout
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);
                    
                    const response = await fetch(url, { signal: controller.signal });
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const parsed = endpoint.parser(data, query);
                    resolve(parsed);
                } catch (error) {
                    console.error(`Error fetching from ${api} API:`, error);
                    resolve([]);
                }
            });
        });
        
    const results = await Promise.all(apiPromises);
    apiResults = results.flat();
    
    // Deduplicate results based on name
    const seenNames = new Set();
    return apiResults.filter(item => {
        if (seenNames.has(item.name.toLowerCase())) {
            return false;
        }
        seenNames.add(item.name.toLowerCase());
        return true;
    });
}

function parseOpenFoodFactsData(data) {
    // Convert Open Food Facts data to our format
    return data.products
        .filter(p => p.product_name && p.product_name.length > 0)
        .map(product => {
            // Generate random brain scores for demonstration
            const neurogenesis = Math.floor(Math.random() * 10) + 1;
            const neuroplasticity = Math.floor(Math.random() * 10) + 1;
            const cognitive = Math.floor(Math.random() * 10) + 1;
            
            return {
                id: `off-${product._id}`,
                name: product.product_name,
                brand: product.brands || 'Unknown Brand',
                image: product.image_url || 'https://images.pexels.com/photos/4041392/pexels-photo-4041392.jpeg',
                price: parseFloat((Math.random() * 40 + 10).toFixed(2)),
                rating: parseFloat((Math.random() * 2 + 3).toFixed(1)),
                category: detectCategory(product),
                benefits: analyzeBenefits(product.ingredients_text),
                ingredients: product.ingredients_text || 'Ingredients not specified',
                nutrients: product.nutriments || {},
                dosage: "See package for dosage instructions",
                ecoScore: product.ecoscore_grade || 'c',
                novaScore: product.nova_group || 1,
                description: product.description || "No description available",
                research: [],
                reviews: Math.floor(Math.random() * 200) + 10,
                stock: "In Stock",
                form: detectForm(product),
                servings: Math.floor(Math.random() * 30) + 10,
                neurogenesis,
                neuroplasticity,
                cognitive,
                brainMechanisms: generateRandomMechanisms(neurogenesis, neuroplasticity, cognitive)
            };
        });
}

function generateRandomMechanisms(neurogenesis, neuroplasticity, cognitive) {
    const mechanisms = [
        {
            name: "Neural Growth Support",
            description: "May support the growth and development of new neurons in specific brain regions."
        },
        {
            name: "Synapse Formation",
            description: "Contains compounds that may enhance the formation and strength of synaptic connections."
        },
        {
            name: "Neurotransmitter Support",
            description: "Provides precursors or cofactors needed for neurotransmitter synthesis and function."
        },
        {
            name: "Antioxidant Protection",
            description: "Helps protect neurons from oxidative stress and free radical damage."
        },
        {
            name: "Blood Flow Enhancement",
            description: "May support healthy cerebral blood flow, delivering oxygen and nutrients to brain cells."
        },
        {
            name: "Anti-inflammatory Effects",
            description: "Contains compounds that help reduce neuroinflammation, supporting cognitive health."
        }
    ];
    
    // Select 3 random mechanisms based on scores
    const selectedMechanisms = [];
    const totalScore = neurogenesis + neuroplasticity + cognitive;
    const count = Math.max(1, Math.min(3, Math.ceil(totalScore / 10)));
    
    for (let i = 0; i < count; i++) {
        const randomIndex = Math.floor(Math.random() * mechanisms.length);
        selectedMechanisms.push(mechanisms[randomIndex]);
        mechanisms.splice(randomIndex, 1);
    }
    
    return selectedMechanisms;
}

function parseExamineData(data) {
    // Mock Examine.com parser
    return [];
}

function parsePubMedData(data) {
    // Mock PubMed parser
    return [];
}

function parseNIHData(data) {
    // Mock NIH parser
    return [];
}

function detectCategory(product) {
    const categories = (product.categories || '').toLowerCase();
    const ingredients = (product.ingredients_text || '').toLowerCase();
    
    for (const [category, keywords] of Object.entries(SUPPLEMENT_CATEGORIES)) {
        for (const keyword of keywords) {
            if (categories.includes(keyword.toLowerCase()) || ingredients.includes(keyword.toLowerCase())) {
                return category;
            }
        }
    }
    
    return 'other';
}

function detectForm(product) {
    const productName = (product.product_name || '').toLowerCase();
    const categories = (product.categories || '').toLowerCase();
    
    if (productName.includes('capsule') || categories.includes('capsule')) return 'Capsules';
    if (productName.includes('tablet') || categories.includes('tablet')) return 'Tablets';
    if (productName.includes('powder') || categories.includes('powder')) return 'Powder';
    if (productName.includes('gummy') || categories.includes('gummy')) return 'Gummies';
    if (productName.includes('softgel') || categories.includes('softgel')) return 'Softgels';
    if (productName.includes('liquid') || categories.includes('liquid')) return 'Liquid';
    
    return 'Supplement';
}

function analyzeBenefits(ingredients) {
    if (!ingredients) return ["Nutritional Support"];
    
    const benefitMap = {
        'vitamin d': ['Bone Health', 'Immune Support'],
        'magnesium': ['Muscle Function', 'Energy Production'],
        'lion\'s mane': ['Cognitive Function', 'Nerve Health'],
        'turmeric': ['Anti-Inflammatory', 'Antioxidant'],
        'ashwagandha': ['Stress Relief', 'Energy'],
        'zinc': ['Immune Support', 'Cellular Health'],
        'protein': ['Muscle Recovery', 'Strength'],
        'omega': ['Heart Health', 'Brain Function'],
        'probiotic': ['Gut Health', 'Digestive Support'],
        'collagen': ['Skin Health', 'Joint Support'],
        'bacopa': ['Memory', 'Focus'],
        'ginkgo': ['Circulation', 'Memory'],
        'rhodiola': ['Energy', 'Stress Relief']
    };

    const benefits = new Set();
    const ingredientsLower = ingredients.toLowerCase();
    
    Object.entries(benefitMap).forEach(([key, values]) => {
        if (ingredientsLower.includes(key)) {
            values.forEach(benefit => benefits.add(benefit));
        }
    });
    
    return benefits.size > 0 ? Array.from(benefits) : ["Nutritional Support"];
}

async function fetchAndDisplaySupplements() {
    showLoading();
    
    try {
        const query = searchInput.value.toLowerCase();
        
        // Start with local supplements
        let results = [...MOCK_SUPPLEMENTS];
        
        // Fetch external data if enabled
        if (useAPIs && query) {
            const apiResults = await fetchSupplementsFromAPI(query);
            results = [...results, ...apiResults];
        }
        
        // Filter supplements based on search and active filters
        if (query) {
            results = results.filter(supp => 
                supp.name.toLowerCase().includes(query) || 
                supp.brand.toLowerCase().includes(query) || 
                (supp.ingredients && supp.ingredients.toLowerCase().includes(query)) ||
                (supp.benefits && supp.benefits.some(b => b.toLowerCase().includes(query))) ||
                (supp.category && supp.category.toLowerCase().includes(query))
            );
        }
        
        // Apply category filters
        if (activeFilters.length > 0) {
            results = results.filter(supp => 
                activeFilters.includes(supp.category)
            );
        }
        
        // Apply brain score filters
        if (brainScoreFilters.neurogenesis > 0 || brainScoreFilters.neuroplasticity > 0 || brainScoreFilters.cognitive > 0) {
            results = results.filter(supp => 
                (supp.neurogenesis >= brainScoreFilters.neurogenesis) &&
                (supp.neuroplasticity >= brainScoreFilters.neuroplasticity) &&
                (supp.cognitive >= brainScoreFilters.cognitive)
            );
        }
        
        // Sort results
        results = sortSupplements(results, currentSort);
        
        currentSupplements = results;
        
        // Update results count
        resultsCount.textContent = `Showing ${Math.min(itemsPerPage, results.length)} of ${results.length} supplements`;
        
        if (results.length === 0) {
            showNoResults();
        } else {
            hideNoResults();
            renderResults(results);
            renderPagination();
        }
        
        hideLoading();
        hideError();
    } catch (error) {
        console.error('Error:', error);
        showError();
        hideLoading();
    }
}

function sortSupplements(supplements, sortType) {
    switch(sortType) {
        case 'rating':
            return [...supplements].sort((a, b) => b.rating - a.rating);
        case 'price-low':
            return [...supplements].sort((a, b) => a.price - b.price);
        case 'price-high':
            return [...supplements].sort((a, b) => b.price - a.price);
        case 'name':
            return [...supplements].sort((a, b) => a.name.localeCompare(b.name));
        case 'neurogenesis':
            return [...supplements].sort((a, b) => b.neurogenesis - a.neurogenesis);
        case 'neuroplasticity':
            return [...supplements].sort((a, b) => b.neuroplasticity - a.neuroplasticity);
        case 'cognitive':
            return [...supplements].sort((a, b) => b.cognitive - a.cognitive);
        default: // relevance
            return supplements;
    }
}

function renderResults(supplements) {
    const startIndex = (currentPage - 1) * itemsPerPage;
    const paginatedSupplements = supplements.slice(startIndex, startIndex + itemsPerPage);
    
    resultsContainer.className = viewMode === 'grid' ? 'results-grid' : 'results-list';
    
    if (viewMode === 'grid') {
        renderGridView(paginatedSupplements);
    } else {
        renderListView(paginatedSupplements);
    }
    
    // Update results count
    resultsCount.textContent = `Showing ${paginatedSupplements.length} of ${supplements.length} supplements`;
}

function renderGridView(supplements) {
    resultsContainer.innerHTML = supplements.map(supplement => `
        <div class="supplement-card" data-id="${supplement.id}">
            <span class="category-badge">${supplement.category}</span>
            <div class="supplement-image-container">
                <img src="${supplement.image}" class="supplement-image" alt="${supplement.name}">
                <button class="bookmark-btn ${bookmarkedItems.includes(supplement.id) ? 'active' : ''}" data-id="${supplement.id}">
                    <i class="fas ${bookmarkedItems.includes(supplement.id) ? 'fa-bookmark' : 'fa-bookmark'}"></i>
                </button>
            </div>
            <h3 class="supplement-title">${supplement.name}</h3>
            <p class="supplement-brand">${supplement.brand}</p>
            
            <div class="brain-scores">
                <div class="brain-score">
                    <div class="score-circle neurogenesis-score">${supplement.neurogenesis}</div>
                    <span class="score-name">Neural Genesis</span>
                </div>
                <div class="brain-score">
                    <div class="score-circle neuroplasticity-score">${supplement.neuroplasticity}</div>
                    <span class="score-name">Neuroplasticity</span>
                </div>
                <div class="brain-score">
                    <div class="score-circle cognitive-score">${supplement.cognitive}</div>
                    <span class="score-name">Cognitive</span>
                </div>
            </div>
            
            <div class="health-tags">
                ${supplement.benefits.slice(0, 3).map(b => `<span class="health-tag">${b}</span>`).join('')}
            </div>
            <div class="card-footer">
                <div class="price-rating">
                    <div class="price">$${supplement.price.toFixed(2)}</div>
                    <div class="rating">
                        <span class="rating-stars">
                            ${generateStarRating(supplement.rating)}
                        </span>
                        <span class="rating-value">${supplement.rating} (${supplement.reviews})</span>
                    </div>
                </div>
                <span class="view-details">Details</span>
            </div>
            <span class="eco-score ${supplement.ecoScore}">Eco-score: ${supplement.ecoScore.toUpperCase()}</span>
        </div>
    `).join('');
    
    addCardEventListeners();
}

function renderListView(supplements) {
    resultsContainer.innerHTML = supplements.map(supplement => `
        <div class="supplement-list-item" data-id="${supplement.id}">
            <div class="list-item-image">
                <img src="${supplement.image}" class="supplement-image" alt="${supplement.name}">
                <span class="category-badge">${supplement.category}</span>
            </div>
            <div class="list-item-info">
                <div class="list-item-header">
                    <div>
                        <h3 class="list-item-title">${supplement.name}</h3>
                        <p class="supplement-brand">${supplement.brand}</p>
                    </div>
                    <div class="list-item-price">$${supplement.price.toFixed(2)}</div>
                </div>
                
                <div class="list-scores">
                    <div class="list-score">
                        <div class="list-score-circle neurogenesis-score">${supplement.neurogenesis}</div>
                        <div class="list-score-info">
                            <span class="list-score-name">Neural Genesis</span>
                        </div>
                    </div>
                    <div class="list-score">
                        <div class="list-score-circle neuroplasticity-score">${supplement.neuroplasticity}</div>
                        <div class="list-score-info">
                            <span class="list-score-name">Neuroplasticity</span>
                        </div>
                    </div>
                    <div class="list-score">
                        <div class="list-score-circle cognitive-score">${supplement.cognitive}</div>
                        <div class="list-score-info">
                            <span class="list-score-name">Cognitive</span>
                        </div>
                    </div>
                </div>
                
                <div class="health-tags">
                    ${supplement.benefits.map(b => `<span class="health-tag">${b}</span>`).join('')}
                </div>
                <p style="margin-top: 0.5rem; flex-grow: 1;">${truncateText(supplement.description, 150)}</p>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                    <div>
                        <span class="eco-score ${supplement.ecoScore}">Eco-score: ${supplement.ecoScore.toUpperCase()}</span>
                        <div class="rating" style="margin-top: 0.5rem;">
                            <span class="rating-stars">
                                ${generateStarRating(supplement.rating)}
                            </span>
                            <span class="rating-value">${supplement.rating} (${supplement.reviews})</span>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <button class="bookmark-btn ${bookmarkedItems.includes(supplement.id) ? 'active' : ''}" 
                                data-id="${supplement.id}" style="opacity: 1;">
                            <i class="fas ${bookmarkedItems.includes(supplement.id) ? 'fa-bookmark' : 'fa-bookmark'}"></i>
                        </button>
                        <span class="view-details">View Details</span>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
    
    addCardEventListeners();
}

function addCardEventListeners() {
    // Add click event to cards/list items
    document.querySelectorAll('.supplement-card, .supplement-list-item').forEach(card => {
        card.addEventListener('click', (e) => {
            // Don't trigger if clicking bookmark button
            if (e.target.closest('.bookmark-btn')) return;
            
            const id = card.dataset.id;
            const supplement = currentSupplements.find(s => s.id.toString() === id.toString());
            if (supplement) {
                showDetailModal(supplement);
            }
        });
    });

    // Add click event to bookmark buttons
    document.querySelectorAll('.bookmark-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation(); // Prevent triggering card click
            const id = btn.dataset.id;
            toggleBookmark(id, btn);
        });
    });
}

function toggleBookmark(id, button) {
    const index = bookmarkedItems.indexOf(id);
    
    if (index === -1) {
        // Add to bookmarks
        bookmarkedItems.push(id);
        if (button) {
            button.classList.add('active');
            button.innerHTML = '<i class="fas fa-bookmark"></i>';
        }
        showToast('Item added to bookmarks');
    } else {
        // Remove from bookmarks
        bookmarkedItems.splice(index, 1);
        if (button) {
            button.classList.remove('active');
            button.innerHTML = '<i class="fas fa-bookmark"></i>';
        }
        showToast('Item removed from bookmarks');
    }
    
    // Save to local storage
    localStorage.setItem('bookmarkedItems', JSON.stringify(bookmarkedItems));
}

function showToast(message) {
    const toastMessage = document.querySelector('.toast-message');
    toastMessage.textContent = message;
    
    toast.classList.add('show');
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

function generateStarRating(rating) {
    const fullStars = Math.floor(rating);
    const halfStar = rating % 1 >= 0.5;
    const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
    
    let stars = '';
    
    // Full stars
    for (let i = 0; i < fullStars; i++) {
        stars += '<i class="fas fa-star"></i>';
    }
    
    // Half star
    if (halfStar) {
        stars += '<i class="fas fa-star-half-alt"></i>';
    }
    
    // Empty stars
    for (let i = 0; i < emptyStars; i++) {
        stars += '<i class="far fa-star"></i>';
    }
    
    return stars;
}

function truncateText(text, maxLength) {
    if (!text) return "";
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength) + '...';
}

function renderPagination() {
    const totalPages = Math.ceil(currentSupplements.length / itemsPerPage);
    
    if (totalPages <= 1) {
        paginationContainer.innerHTML = '';
        return;
    }
    
    let pagination = '';
    
    // Previous button
    pagination += `
        <button class="page-btn ${currentPage === 1 ? 'disabled' : ''}" 
                ${currentPage === 1 ? 'disabled' : ''} 
                data-page="${currentPage - 1}" aria-label="Previous page">
            <i class="fas fa-chevron-left"></i>
        </button>
    `;
    
    // Page numbers
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
    
    if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }
    
    for (let i = startPage; i <= endPage; i++) {
        pagination += `
            <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                    data-page="${i}" aria-label="Page ${i}">
                ${i}
            </button>
        `;
    }
    
    // Next button
    pagination += `
        <button class="page-btn ${currentPage === totalPages ? 'disabled' : ''}"
                ${currentPage === totalPages ? 'disabled' : ''}
                data-page="${currentPage + 1}" aria-label="Next page">
            <i class="fas fa-chevron-right"></i>
        </button>
    `;
    
    paginationContainer.innerHTML = pagination;
    
    // Add event listeners to pagination buttons
    document.querySelectorAll('.page-btn:not(.disabled)').forEach(btn => {
        btn.addEventListener('click', () => {
            currentPage = parseInt(btn.dataset.page);
            fetchAndDisplaySupplements();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    });
}

function showDetailModal(supplement) {
    const isBookmarked = bookmarkedItems.includes(supplement.id);
    
    modalBody.innerHTML = `
        <div class="modal-tabs">
            <div class="modal-tab active" data-tab="overview">Overview</div>
            <div class="modal-tab" data-tab="brain">Brain Enhancement</div>
            <div class="modal-tab" data-tab="ingredients">Ingredients</div>
            <div class="modal-tab" data-tab="research">Research</div>
            <div class="modal-tab" data-tab="compare">Compare</div>
        </div>
        
        <div class="modal-header">
            <div class="modal-img-container">
                <img src="${supplement.image}" class="modal-img" alt="${supplement.name}">
            </div>
            <div class="modal-title-group">
                <h2>${supplement.name}</h2>
                <p>${supplement.brand}</p>
                <div class="health-tags">
                    ${supplement.benefits.map(b => `<span class="health-tag">${b}</span>`).join('')}
                </div>
                
                <div class="modal-brain-scores">
                    <div class="brain-score">
                        <div class="score-circle neurogenesis-score">${supplement.neurogenesis}</div>
                        <span class="score-name">Neural Genesis</span>
                    </div>
                    <div class="brain-score">
                        <div class="score-circle neuroplasticity-score">${supplement.neuroplasticity}</div>
                        <span class="score-name">Neuroplasticity</span>
                    </div>
                    <div class="brain-score">
                        <div class="score-circle cognitive-score">${supplement.cognitive}</div>
                        <span class="score-name">Cognitive</span>
                    </div>
                </div>
                
                <div style="margin-top: 1rem;">
                    <div style="font-size: 1.5rem; font-weight: 600; color: var(--primary);">$${supplement.price.toFixed(2)}</div>
                    <div style="margin-top: 0.5rem;">
                        <span class="rating-stars">
                            ${generateStarRating(supplement.rating)}
                        </span>
                        <span style="font-weight: 500;">${supplement.rating}/5</span> 
                        <span>(${supplement.reviews} reviews)</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="action-btn primary-btn">
                        <i class="fas fa-shopping-cart"></i> Buy Now
                    </button>
                    <button class="action-btn secondary-btn bookmark-action" data-id="${supplement.id}">
                        <i class="fas ${isBookmarked ? 'fa-bookmark' : 'fa-bookmark'}"></i> 
                        ${isBookmarked ? 'Bookmarked' : 'Bookmark'}
                    </button>
                </div>
            </div>
        </div>
        
        <div class="modal-info">
            <div class="tab-content active" data-tab="overview">
                <div class="info-section">
                    <h3 class="section-title">Description</h3>
                    <p>${supplement.description}</p>
                </div>
                
                <div class="info-section">
                    <h3 class="section-title">Key Benefits</h3>
                    <div class="benefits-list">
                        ${supplement.benefits.map(b => `<span class="health-tag">${b}</span>`).join('')}
                    </div>
                    <p style="margin-top: 1rem;">
                        This supplement is designed to support ${supplement.benefits.join(', ')}.
                    </p>
                </div>
                
                <div class="info-section">
                    <h3 class="section-title">Dosage</h3>
                    <p><strong>Recommended Use:</strong> ${supplement.dosage}</p>
                    <p><strong>Form:</strong> ${supplement.form}</p>
                    <p><strong>Servings:</strong> ${supplement.servings} servings per container</p>
                </div>
                
                <div class="info-section">
                    <h3 class="section-title">Key Nutrients</h3>
                    <div class="info-grid">
                        ${Object.entries(supplement.nutrients).map(([key, value]) => `
                            <div class="nutrient-item">
                                <div class="nutrient-name">${key}</div>
                                <div class="nutrient-value">${value} mg</div>
                                <div class="nutrient-progress">
                                    <div class="nutrient-progress-bar" style="width: ${Math.min(100, (value/100) * 10)}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="info-section">
                    <h3 class="section-title">Sustainability</h3>
                    <p>
                        <span class="eco-score ${supplement.ecoScore}" style="margin-right: 1rem;">
                            Eco-score: ${supplement.ecoScore.toUpperCase()}
                        </span>
                        Nova score: ${supplement.novaScore}/5
                    </p>
                    <p style="margin-top: 0.5rem;">
                        ${getEcoScoreDescription(supplement.ecoScore)}
                    </p>
                </div>
            </div>
            
            <div class="tab-content" data-tab="brain">
                <div class="info-section">
                    <h3 class="section-title">Brain Enhancement Profile</h3>
                    <p>This supplement has been analyzed for its potential effects on brain health and cognitive function based on ingredient analysis, clinical research, and reported benefits.</p>
                    
                    <div style="margin-top: 1.5rem;">
                        <h4 style="margin-bottom: 0.8rem; color: var(--neurogenesis);">
                            <i class="fas fa-brain"></i> Neural Genesis Score: ${supplement.neurogenesis}/10
                        </h4>
                        <div class="nutrient-progress">
                            <div class="nutrient-progress-bar" style="width: ${supplement.neurogenesis * 10}%; background: var(--neurogenesis);"></div>
                        </div>
                        <p style="margin-top: 0.5rem;">
                            ${getNeurogenesisDescription(supplement.neurogenesis)}
                        </p>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <h4 style="margin-bottom: 0.8rem; color: var(--neuroplasticity);">
                            <i class="fas fa-network-wired"></i> Neuroplasticity Score: ${supplement.neuroplasticity}/10
                        </h4>
                        <div class="nutrient-progress">
                            <div class="nutrient-progress-bar" style="width: ${supplement.neuroplasticity * 10}%; background: var(--neuroplasticity);"></div>
                        </div>
                        <p style="margin-top: 0.5rem;">
                            ${getNeuroplasticityDescription(supplement.neuroplasticity)}
                        </p>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <h4 style="margin-bottom: 0.8rem; color: var(--cognitive);">
                            <i class="fas fa-lightbulb"></i> Cognitive Boost Score: ${supplement.cognitive}/10
                        </h4>
                        <div class="nutrient-progress">
                            <div class="nutrient-progress-bar" style="width: ${supplement.cognitive * 10}%; background: var(--cognitive);"></div>
                        </div>
                        <p style="margin-top: 0.5rem;">
                            ${getCognitiveDescription(supplement.cognitive)}
                        </p>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3 class="section-title">Brain Enhancement Mechanisms</h3>
                    <div class="brain-mechanisms">
                        ${supplement.brainMechanisms.map(mechanism => `
                            <div class="mechanism-card">
                                <div class="mechanism-header">
                                    <div class="mechanism-icon" style="background: var(--primary);">
                                        <i class="fas fa-synapse"></i>
                                    </div>
                                    <h4 class="mechanism-title">${mechanism.name}</h4>
                                </div>
                                <p>${mechanism.description}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="info-section">
                    <h3 class="section-title">Optimal Use for Brain Enhancement</h3>
                    <p>
                        Based on the cognitive profile of this supplement, here are recommendations for optimal use to maximize brain health benefits:
                    </p>
                    <ul style="margin-top: 0.8rem; margin-left: 1.5rem;">
                        <li>Timing: ${getBrainEnhancementTiming(supplement)}</li>
                        <li>Synergistic Compounds: ${getSynergisticCompounds(supplement)}</li>
                        <li>Duration: ${getBrainEnhancementDuration(supplement)}</li>
                        <li>User Profile: ${getBrainEnhancementUserProfile(supplement)}</li>
                    </ul>
                </div>
            </div>
            
            <div class="tab-content" data-tab="ingredients">
                <div class="info-section">
                    <h3 class="section-title">Ingredients</h3>
                    <p>${supplement.ingredients}</p>
                </div>
                
                <div class="info-section">
                    <h3 class="section-title">Ingredient Breakdown</h3>
                    <div class="info-grid">
                        ${Object.entries(supplement.nutrients).map(([key, value]) => `
                            <div class="nutrient-item">
                                <div class="nutrient-name">${key}</div>
                                <div class="nutrient-value">${value} mg</div>
                                <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">
                                    ${getIngredientDescription(key)}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="info-section">
                    <h3 class="section-title">Allergen Information</h3>
                    <p>Free from: Gluten, Dairy, Soy, Tree Nuts, Peanuts, Wheat, Egg, Fish, Shellfish</p>
                    <p style="margin-top: 0.5rem;">Manufactured in a facility that processes other products which may contain these allergens.</p>
                </div>
            </div>
            
            <div class="tab-content" data-tab="research">
                <div class="info-section">
                    <h3 class="section-title">Research & Studies</h3>
                    ${supplement.research.length > 0 ? 
                        supplement.research.map(r => `
                            <div class="research-card">
                                <h4 class="research-title">${r.title}</h4>
                                <p>${r.summary}</p>
                            </div>
                        `).join('') : 
                        `<p>No specific research studies available for this supplement.</p>`
                    }
                </div>
                
                <div class="info-section">
                    <h3 class="section-title">How It Works</h3>
                    <p>${getHowItWorksDescription(supplement.category, supplement.name)}</p>
                </div>
            </div>
            
            <div class="tab-content" data-tab="compare">
                <div class="info-section">
                    <h3 class="section-title">Compare With Similar Products</h3>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Neural Genesis</th>
                                <th>Neuroplasticity</th>
                                <th>Cognitive</th>
                                <th>Key Benefits</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${getSimilarProducts(supplement).map(p => `
                                <tr>
                                    <td>${p.name}</td>
                                    <td>$${p.price.toFixed(2)}</td>
                                    <td style="text-align: center;">${p.neurogenesis}</td>
                                    <td style="text-align: center;">${p.neuroplasticity}</td>
                                    <td style="text-align: center;">${p.cognitive}</td>
                                    <td>${p.benefits.slice(0, 2).join(', ')}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;
    
    // Add event listeners to tabs
    const tabs = modalBody.querySelectorAll('.modal-tab');
    const tabContents = modalBody.querySelectorAll('.tab-content');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const tabName = tab.dataset.tab;
            
            // Update active tab
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // Show corresponding content
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.dataset.tab === tabName) {
                    content.classList.add('active');
                }
            });
        });
    });
    
    // Bookmark action
    const bookmarkAction = modalBody.querySelector('.bookmark-action');
    bookmarkAction.addEventListener('click', () => {
        const id = bookmarkAction.dataset.id;
        const isCurrentlyBookmarked = bookmarkedItems.includes(id);
        
        toggleBookmark(id);
        
        // Update button text
        bookmarkAction.innerHTML = `
            <i class="fas ${isCurrentlyBookmarked ? 'fa-bookmark' : 'fa-bookmark'}"></i> 
            ${isCurrentlyBookmarked ? 'Bookmark' : 'Bookmarked'}
        `;
        
        // Update all bookmark buttons on the page with this ID
        document.querySelectorAll(`.bookmark-btn[data-id="${id}"]`).forEach(btn => {
            if (isCurrentlyBookmarked) {
                btn.classList.remove('active');
                btn.innerHTML = '<i class="fas fa-bookmark"></i>';
            } else {
                btn.classList.add('active');
                btn.innerHTML = '<i class="fas fa-bookmark"></i>';
            }
        });
    });
    
    // Animate nutrient progress bars
    setTimeout(() => {
        const progressBars = modalBody.querySelectorAll('.nutrient-progress-bar');
        progressBars.forEach(bar => {
            const width = bar.style.width;
            bar.style.width = '0';
            setTimeout(() => {
                bar.style.width = width;
            }, 50);
        });
    }, 100);
    
    modal.classList.add('open');
    document.body.style.overflow = 'hidden';
}

function getNeurogenesisDescription(score) {
    const descriptions = [
        "No significant neural genesis support.", // 0
        "Minimal support for neural genesis processes.", // 1
        "Slight potential to support the brain's ability to generate new neurons.", // 2
        "Modest support for neural growth factors.", // 3
        "Moderate potential to enhance neural genesis in specific brain regions.", // 4
        "Good support for neural genesis processes, may stimulate growth factors.", // 5
        "Strong potential to promote neural genesis through multiple pathways.", // 6
        "Excellent support for neural genesis with evidence from multiple studies.", // 7
        "Very high potential to enhance the brain's ability to generate new neurons.", // 8
        "Exceptional support for neural genesis, backed by substantial research.", // 9
        "Maximum support for neural genesis through multiple, well-documented mechanisms." // 10
    ];
    
    return descriptions[score] || descriptions[0];
}

function getNeuroplasticityDescription(score) {
    const descriptions = [
        "No significant neuroplasticity support.", // 0
        "Minimal support for neuroplasticity processes.", // 1
        "Slight potential to support the brain's ability to form new neural connections.", // 2
        "Modest support for synaptic plasticity.", // 3
        "Moderate potential to enhance neuroplasticity in key brain regions.", // 4
        "Good support for neuroplasticity, may enhance synaptic connections.", // 5
        "Strong potential to promote neuroplasticity through multiple pathways.", // 6
        "Excellent support for neuroplasticity with evidence from multiple studies.", // 7
        "Very high potential to enhance the brain's ability to reorganize and form new connections.", // 8
        "Exceptional support for neuroplasticity, backed by substantial research.", // 9
        "Maximum support for neuroplasticity through multiple, well-documented mechanisms." // 10
    ];
    
    return descriptions[score] || descriptions[0];
}

function getCognitiveDescription(score) {
    const descriptions = [
        "No significant cognitive enhancement effects.", // 0
        "Minimal cognitive support potential.", // 1
        "Slight potential cognitive benefits, primarily supporting baseline function.", // 2
        "Modest cognitive enhancement, may improve mental clarity slightly.", // 3
        "Moderate cognitive benefits, supporting focus and mental processing.", // 4
        "Good cognitive enhancement potential, supporting multiple aspects of cognition.", // 5
        "Strong cognitive benefits, enhancing focus, memory, and mental processing.", // 6
        "Excellent cognitive enhancement with noticeable effects on mental performance.", // 7
        "Very high cognitive boost potential across multiple cognitive domains.", // 8
        "Exceptional cognitive enhancement effects backed by substantial evidence.", // 9
        "Maximum cognitive enhancement through multiple, well-documented mechanisms." // 10
    ];
    
    return descriptions[score] || descriptions[0];
}

function getBrainEnhancementTiming(supplement) {
    const options = [
        "Take in the morning for daytime cognitive benefits.",
        "Take 30 minutes before cognitive tasks requiring focus and attention.",
        "Take consistently at the same time each day for cumulative benefits.",
        "Take with meals to maximize absorption of fat-soluble compounds.",
        "Take in the evening to support overnight neural repair processes."
    ];
    
    // Select based on supplement characteristics
    if (supplement.category === "nootropic") {
        return options[1];
    } else if (supplement.neurogenesis > 7) {
        return options[4];
    } else if (supplement.cognitive > 7) {
        return options[0];
    } else {
        return options[2];
    }
}

function getSynergisticCompounds(supplement) {
    const synergies = {
        "nootropic": "Omega-3 fatty acids, B vitamins, and antioxidants",
        "vitamin": "Minerals, adaptogenic herbs, and healthy fats for absorption",
        "mineral": "B vitamins, vitamin C, and complementary minerals",
        "herbal": "Bioperine (black pepper extract) for improved absorption",
        "amino": "B6, magnesium, and zinc as cofactors",
        "protein": "Digestive enzymes and probiotics for optimal utilization"
    };
    
    return synergies[supplement.category] || "Other antioxidants and complementary nutrients";
}

function getBrainEnhancementDuration(supplement) {
    // Base recommendation on neuroplasticity score
    if (supplement.neuroplasticity >= 8) {
        return "Benefits may build over 8-12 weeks of consistent use";
    } else if (supplement.neuroplasticity >= 5) {
        return "Consistent use for 4-8 weeks recommended to observe full benefits";
    } else {
        return "Allow 2-4 weeks of consistent use to evaluate effects";
    }
}

function getBrainEnhancementUserProfile(supplement) {
    // Determine ideal user based on scores
    const totalScore = supplement.neurogenesis + supplement.neuroplasticity + supplement.cognitive;
    
    if (totalScore > 24) {
        return "Ideal for individuals seeking significant cognitive enhancement and long-term brain health support";
    } else if (totalScore > 18) {
        return "Well-suited for knowledge workers, students, and those with cognitively demanding tasks";
    } else if (totalScore > 12) {
        return "Appropriate for adults seeking general brain health maintenance and moderate cognitive support";
    } else {
        return "May provide basic nutritional support for general brain health maintenance";
    }
}

function getSimilarProducts(supplement) {
    // Find products in the same category with similar brain enhancement profiles
    const similarity = (a, b) => {
        const neuroDiff = Math.abs(a.neurogenesis - b.neurogenesis);
        const plasticityDiff = Math.abs(a.neuroplasticity - b.neuroplasticity);
        const cognitiveDiff = Math.abs(a.cognitive - b.cognitive);
        
        return neuroDiff + plasticityDiff + cognitiveDiff;
    };
    
    return MOCK_SUPPLEMENTS
        .filter(s => s.id !== supplement.id)
        .sort((a, b) => similarity(a, supplement) - similarity(b, supplement))
        .slice(0, 3);
}

function getEcoScoreDescription(score) {
    const descriptions = {
        'a': 'Excellent environmental impact. This product is produced using sustainable practices with minimal environmental footprint.',
        'b': 'Good environmental impact. This product is made with attention to environmental considerations.',
        'c': 'Moderate environmental impact. Some aspects of production consider sustainability.',
        'd': 'High environmental impact. There are significant opportunities to improve the sustainability of this product.',
        'e': 'Very high environmental impact. This product is produced using practices that have a substantial environmental footprint.'
    };
    
    return descriptions[score] || 'Environmental impact information not available.';
}

function getIngredientDescription(ingredient) {
    const descriptions = {
        "Beta Glucans": "Polysaccharides that may support immune function and help maintain healthy cholesterol levels.",
        "Polysaccharides": "Complex carbohydrates with potential immune-modulating and prebiotic properties.",
        "Erinacines": "Compounds found in Lion's Mane that may promote nerve growth factor (NGF) production.",
        "Vitamin D3": "Essential fat-soluble vitamin important for bone health, immune function, and overall wellness.",
        "Vitamin K2": "Works synergistically with vitamin D to support proper calcium utilization for bone and cardiovascular health.",
        "MCT Oil": "Medium-chain triglycerides that provide readily available energy and may support cognitive function.",
        "Magnesium Glycinate": "Highly bioavailable form of magnesium bound to glycine, which may support relaxation and sleep quality.",
        "Magnesium Malate": "Form of magnesium bound to malic acid, which may support energy production and muscle function.",
        "Magnesium Threonate": "Form of magnesium that may effectively cross the blood-brain barrier to support cognitive function.",
        "Curcumin": "Active compound in turmeric with powerful antioxidant and anti-inflammatory properties.",
        "BioPerine": "Black pepper extract that enhances the bioavailability of various nutrients, particularly curcumin.",
        "Turmerones": "Bioactive compounds in turmeric that may have additional anti-inflammatory and antioxidant effects.",
        "Withanolides": "Active compounds in ashwagandha that may help the body manage stress and support overall wellness.",
        "Ashwagandha Extract": "Adaptogenic herb that may help the body respond to stress, support energy, and promote balance.",
        "L-Leucine": "Essential branched-chain amino acid (BCAA) that plays a key role in protein synthesis and muscle recovery.",
        "L-Isoleucine": "Essential BCAA involved in energy production and muscle recovery.",
        "L-Valine": "Essential BCAA that supports muscle metabolism, tissue repair, and energy production.",
        "Sodium": "Electrolyte essential for hydration, nerve function, and muscle contractions.",
        "Potassium": "Key electrolyte for muscle function, nerve signaling, and fluid balance.",
        "Collagen": "Structural protein that supports skin elasticity, joint health, and connective tissue.",
        "Vitamin C": "Essential antioxidant vitamin important for immune function, collagen synthesis, and overall health.",
        "Hyaluronic Acid": "Compound that helps maintain skin hydration and joint lubrication.",
        "Protein": "Essential macronutrient composed of amino acids that supports muscle recovery, tissue repair, and various bodily functions.",
        "BCAAs": "Branched-chain amino acids (leucine, isoleucine, and valine) that support muscle protein synthesis and recovery.",
        "Fiber": "Dietary component that supports digestive health and may help maintain healthy blood sugar levels.",
        "Iron": "Essential mineral vital for oxygen transport, energy production, and immune function.",
        "Zinc": "Essential mineral important for immune function, protein synthesis, wound healing, and DNA synthesis.",
        "Quercetin": "Flavonoid with antioxidant properties that may support immune function and reduce inflammation.",
        "Bacosides": "Active compounds in Bacopa monnieri that may support memory, learning, and overall cognitive function.",
        "Alpha-GPC": "A choline-containing compound that supports acetylcholine production, important for memory and cognitive function.",
        "Choline": "Essential nutrient that serves as a precursor to acetylcholine, a neurotransmitter involved in memory and muscle control."
    };
    
    return descriptions[ingredient] || "Supports overall health and wellness.";
}

function getHowItWorksDescription(category, name) {
    const categoryDescriptions = {
        "nootropic": "This cognitive-supporting supplement works by enhancing neurotransmitter function, supporting healthy blood flow to the brain, and providing neuroprotective benefits. It may help optimize brain function by supporting the health of neurons and promoting efficient communication between brain cells.",
        "vitamin": "This vitamin supplement works by addressing potential nutritional gaps and providing essential micronutrients that serve as cofactors in hundreds of enzymatic reactions throughout the body. These nutrients are crucial for energy production, immune function, and overall cellular health.",
        "mineral": "This mineral supplement works by providing essential minerals that serve as cofactors for enzymes involved in various bodily processes. These minerals support structural integrity, fluid balance, nerve transmission, and muscle function, among many other vital functions.",
        "herbal": "This herbal supplement works through the action of its bioactive compounds, which may modulate various physiological pathways. These natural compounds interact with cell receptors and signaling molecules to support the body's natural processes and promote overall balance and wellness.",
        "amino": "This amino acid supplement works by providing the building blocks needed for protein synthesis and neurotransmitter production. These amino acids support muscle recovery, energy production, and various metabolic functions throughout the body.",
        "protein": "This protein supplement works by providing essential amino acids needed for muscle repair and growth. It supports recovery after exercise, helps maintain lean body mass, and contributes to overall protein intake for optimal health and function."
    };
    
    const specificDescriptions = {
        "Premium Lion's Mane Extract": "Lion's Mane contains compounds called erinacines and hericenones that may stimulate the production of nerve growth factor (NGF), a protein that promotes the growth and maintenance of neurons. This may support cognitive function, neural health, and overall brain performance.",
        "Vitamin D3 + K2 Complex": "This combination works synergistically to support both bone and cardiovascular health. Vitamin D3 enhances calcium absorption, while vitamin K2 helps direct calcium to bones rather than soft tissues, potentially supporting arterial health in addition to bone strength.",
        "Ashwagandha KSM-66": "Ashwagandha works as an adaptogen, helping the body respond to stress by modulating cortisol levels and supporting adrenal function. The withanolides in KSM-66 Ashwagandha may help promote balance in various body systems affected by stress.",
        "Alpha-GPC Cognitive Support": "Alpha-GPC rapidly delivers choline to the brain where it serves as a precursor for the neurotransmitter acetylcholine, crucial for learning and memory formation. It also supports phospholipid synthesis in neuronal membranes, enhancing signal transmission between neurons.",
        "Bacopa Monnieri Extract": "Bacopa contains active compounds called bacosides that modulate key neurotransmitter systems and enhance synaptic communication. It supports dendrite branching, helping neurons form new connections while providing neuroprotective and antioxidant effects that preserve cognitive function."
    };
    
    return specificDescriptions[name] || categoryDescriptions[category] || "This supplement provides targeted support for overall health and wellness through its carefully selected ingredients.";
}

function closeModal() {
    modal.classList.remove('open');
    document.body.style.overflow = '';
}

function showLoading() {
    isLoading = true;
    loaderElement.style.display = 'block';
    resultsContainer.innerHTML = viewMode === 'grid' ? 
        generateSkeletonCards(6, 'grid') : 
        generateSkeletonCards(6, 'list');
}

function hideLoading() {
    isLoading = false;
    loaderElement.style.display = 'none';
}

function showError() {
    errorMessage.style.display = 'block';
}

function hideError() {
    errorMessage.style.display = 'none';
}

function showNoResults() {
    noResultsMessage.style.display = 'block';
    resultsContainer.innerHTML = '';
}

function hideNoResults() {
    noResultsMessage.style.display = 'none';
}

function generateSkeletonCards(count, type = 'grid') {
    let skeletons = '';
    for (let i = 0; i < count; i++) {
        skeletons += type === 'grid' ? 
            `<div class="skeleton-loader skeleton-card"></div>` : 
            `<div class="skeleton-loader skeleton-list-item"></div>`;
    }
    return skeletons;
}
</script>
</body>
</html>
