<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Android Web Clone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sys-light-bg: #f8f9fa;
            --sys-light-surface: #ffffff;
            --sys-light-text: #202124;
            --sys-dark-bg: #121212;
            --sys-dark-surface: #1e1e1e;
            --sys-dark-text: #e8eaed;
            --primary-color: #1a73e8;
            --wallpaper: linear-gradient(135deg, #8BC6EC 0%, #9599E2 100%);
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #2c3e50;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        /* Phone Hardware Wrapper */
        #device {
            width: 360px;
            height: 740px;
            background-color: var(--sys-light-bg);
            border-radius: 40px;
            border: 14px solid #111;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), inset 0 0 0 2px #333;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease;
        }

        /* Dynamic Theme Classes */
        #device.dark-mode {
            background-color: var(--sys-dark-bg);
            color: var(--sys-dark-text);
        }
        
        #device.dark-mode .app-surface { background-color: var(--sys-dark-surface); color: var(--sys-dark-text); }
        #device:not(.dark-mode) .app-surface { background-color: var(--sys-light-surface); color: var(--sys-light-text); }
        
        #device.dark-mode .border-theme { border-color: #333; }
        #device:not(.dark-mode) .border-theme { border-color: #eee; }

        #device.dark-mode .bg-theme-muted { background-color: #2a2a2a; }
        #device:not(.dark-mode) .bg-theme-muted { background-color: #f1f3f4; }

        /* Hide scrollbars but keep functionality */
        ::-webkit-scrollbar { display: none; }
        * { scrollbar-width: none; }

        /* Screen Elements */
        .wallpaper-bg { background: var(--wallpaper); background-size: cover; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        #device.dark-mode .glass-panel {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* Animations */
        @keyframes appOpen {
            from { opacity: 0; transform: scale(0.9) translateY(20px); border-radius: 40px; }
            to { opacity: 1; transform: scale(1) translateY(0); border-radius: 0px; }
        }
        @keyframes appClose {
            from { opacity: 1; transform: scale(1) translateY(0); }
            to { opacity: 0; transform: scale(0.9) translateY(20px); }
        }
        .animate-app-open { animation: appOpen 0.25s cubic-bezier(0.2, 0, 0, 1) forwards; }
        .animate-app-close { animation: appClose 0.2s cubic-bezier(0.2, 0, 0, 1) forwards; }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); }
            to { transform: translateX(100%); }
        }
        .slide-in-right { animation: slideInRight 0.25s cubic-bezier(0.2, 0, 0, 1) forwards; }
        .slide-out-right { animation: slideOutRight 0.2s cubic-bezier(0.2, 0, 0, 1) forwards; }

        /* App Icon Grid */
        .app-icon-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .app-icon-btn:active { transform: scale(0.9); }
        .app-icon {
            width: 52px;
            height: 52px;
            border-radius: 22%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .app-label {
            font-size: 11px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            color: white;
            font-weight: 500;
        }

        /* Camera Hole */
        .camera-hole {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 16px;
            background-color: #000;
            border-radius: 50%;
            z-index: 100;
            box-shadow: inset 0 -1px 2px rgba(255,255,255,0.2);
        }
    </style>
</head>
<body>

    <div id="device">
        <div class="camera-hole"></div>

        <!-- Lock Screen -->
        <div id="lock-screen" class="absolute inset-0 wallpaper-bg z-50 flex flex-col items-center justify-between py-12 transition-transform duration-500 text-white">
            <div class="mt-16 flex flex-col items-center drop-shadow-lg">
                <div id="lock-time" class="text-7xl font-light tracking-tighter">12:00</div>
                <div id="lock-date" class="text-base font-medium mt-2">Mon, Jan 1</div>
            </div>
            
            <div class="flex flex-col items-center mb-8 opacity-80 animate-bounce">
                <svg class="w-6 h-6 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
                <span class="text-sm font-medium">Swipe up to unlock</span>
            </div>
        </div>

        <!-- Status Bar -->
        <div id="status-bar" class="absolute top-0 w-full h-8 px-5 flex justify-between items-center z-40 text-xs font-medium text-white drop-shadow-md transition-colors duration-300 pointer-events-none">
            <div id="status-time" class="pl-2">12:00</div>
            <div class="flex items-center space-x-1.5 pr-2">
                <svg id="status-wifi" class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3C7.8 3 3.9 4.8 1 7.8L12 21 23 7.8C20.1 4.8 16.2 3 12 3zm0 14l-6.4-7.5C7.2 8.3 9.5 7.5 12 7.5s4.8.8 6.4 2L12 17z"/></svg>
                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M17 4h-3V2h-4v2H7v18h10V4z"/></svg>
            </div>
        </div>

        <!-- Home Screen -->
        <div id="home-screen" class="absolute inset-0 wallpaper-bg z-10 flex flex-col pt-10 pb-12 px-4">
            <!-- At a Glance Widget -->
            <div class="mt-8 px-2 text-white drop-shadow-md cursor-pointer" onclick="openApp('clock')">
                <div class="text-3xl font-light mb-1" id="widget-time">12:00</div>
                <div class="text-sm font-medium flex items-center">
                    <span id="widget-date">Mon, Jan 1</span>
                    <span class="mx-2">•</span>
                    <span>22°C</span>
                    <svg class="w-4 h-4 ml-1 text-yellow-300" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18.75a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25a.75.75 0 01.75-.75zM6.166 18.894a.75.75 0 001.06 1.06l1.59-1.591a.75.75 0 10-1.06-1.061l-1.59 1.59zM4.5 12a.75.75 0 01-.75.75H1.5a.75.75 0 010-1.5h2.25a.75.75 0 01.75.75zM6.166 5.106a.75.75 0 00-1.06 1.06l1.591 1.59a.75.75 0 101.06-1.061l-1.59-1.59z"/></svg>
                </div>
            </div>

            <!-- Google Search Bar Mock -->
            <div class="mt-6 mx-2 glass-panel rounded-full h-12 flex items-center px-4 shadow-lg cursor-pointer hover:bg-white/30 transition" onclick="openApp('browser')">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                <div class="ml-3 text-white/80 text-sm font-medium flex-grow">Search...</div>
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
            </div>

            <div class="flex-grow"></div>

            <!-- Swipe Up indicator -->
            <div class="flex justify-center mb-2 cursor-pointer" onclick="toggleDrawer()">
                <svg class="w-6 h-6 text-white opacity-70 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
            </div>

            <!-- Dock -->
            <div class="glass-panel rounded-3xl mx-1 px-2 py-3 flex justify-around items-center mb-2">
                <div class="app-icon-btn" onclick="openApp('phone')">
                    <div class="app-icon bg-green-500"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M20 15.5c-1.2 0-2.4-.2-3.6-.6-.3-.1-.7 0-1 .2l-2.2 2.2c-2.8-1.4-5.1-3.8-6.6-6.6l2.2-2.2c.3-.3.4-.7.2-1-.4-1.1-.6-2.3-.6-3.5 0-.6-.4-1-1-1H3c-.6 0-1 .4-1 1 0 9.4 7.6 17 17 17 .6 0 1-.4 1-1v-4.5c0-.6-.4-1-1-1z"/></svg></div>
                </div>
                <div class="app-icon-btn" onclick="openApp('messages')">
                    <div class="app-icon bg-blue-500"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg></div>
                </div>
                <div class="app-icon-btn" onclick="openApp('browser')">
                    <div class="app-icon bg-red-500"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg></div>
                </div>
                <div class="app-icon-btn" onclick="openApp('camera')">
                    <div class="app-icon bg-gray-800"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></div>
                </div>
            </div>
        </div>

        <!-- App Drawer -->
        <div id="app-drawer" class="absolute inset-0 z-20 glass-panel transform translate-y-full transition-transform duration-300 flex flex-col pt-12 pb-16 px-4">
            <div class="w-full relative mb-6 mt-4">
                <input type="text" placeholder="Search apps" class="w-full bg-white/30 text-white placeholder-white/70 px-4 py-2 rounded-full outline-none focus:bg-white/40 transition text-sm">
            </div>
            <div class="grid grid-cols-4 gap-y-6 gap-x-2 overflow-y-auto pb-10" id="drawer-grid">
                <!-- Injected via JS -->
            </div>
        </div>

        <!-- Notifications / Quick Settings Panel -->
        <div id="notifications-panel" class="absolute inset-0 z-30 transform -translate-y-full transition-transform duration-300 flex flex-col pointer-events-none">
            <div class="glass-panel h-full w-full p-4 pt-10 flex flex-col text-white pointer-events-auto">
                <!-- Quick Toggles -->
                <div class="grid grid-cols-4 gap-4 mb-6 mt-4">
                    <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="toggleSetting('wifi')">
                        <div id="qt-wifi" class="w-12 h-12 rounded-full bg-blue-500 flex items-center justify-center transition-colors"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3C7.8 3 3.9 4.8 1 7.8L12 21 23 7.8C20.1 4.8 16.2 3 12 3zm0 14l-6.4-7.5C7.2 8.3 9.5 7.5 12 7.5s4.8.8 6.4 2L12 17z"/></svg></div>
                        <span class="text-xs">Wi-Fi</span>
                    </div>
                    <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="toggleSetting('bluetooth')">
                        <div id="qt-bt" class="w-12 h-12 rounded-full bg-blue-500 flex items-center justify-center transition-colors"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M17.71 7.71L12 2h-1v7.59L6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM13 5.83l1.88 1.88L13 9.59V5.83zm1.88 10.46L13 18.17v-3.76l1.88 1.88z"/></svg></div>
                        <span class="text-xs">Bluetooth</span>
                    </div>
                    <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="toggleSetting('darkmode')">
                        <div id="qt-dark" class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center transition-colors"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg></div>
                        <span class="text-xs">Dark Theme</span>
                    </div>
                    <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="toggleSetting('airplane')">
                        <div id="qt-air" class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center transition-colors"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></svg></div>
                        <span class="text-xs">Airplane</span>
                    </div>
                </div>
                
                <!-- Brightness Slider -->
                <div class="flex items-center gap-3 px-2 mb-6">
                    <svg class="w-5 h-5 text-white/70" fill="currentColor" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41.39.39 1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41.39.39 1.03.39 1.41 0l1.06-1.06z"/></svg>
                    <div class="flex-grow h-1.5 bg-white/30 rounded-full overflow-hidden">
                        <div class="h-full bg-white w-3/4 rounded-full"></div>
                    </div>
                </div>

                <!-- Notifications List -->
                <div class="flex-grow overflow-y-auto space-y-3 pb-8">
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-4 flex gap-3 items-start">
                        <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center shrink-0"><svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg></div>
                        <div>
                            <div class="text-xs text-white/70 mb-0.5">System Update • Now</div>
                            <div class="text-sm font-medium">All Apps Activated</div>
                            <div class="text-xs text-white/80 mt-1">Every app is now fully functional. Try the Camera, Phone, or Messages!</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Pull Handle -->
            <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2 w-12 h-1.5 bg-white/50 rounded-full cursor-pointer pointer-events-auto" onclick="closeNotifications()"></div>
        </div>

        <!-- App Container (Dynamic Injection) -->
        <div id="app-container" class="absolute inset-0 z-20 hidden app-surface flex-col pt-8 pb-12 transition-colors duration-300">
            <!-- App Content Goes Here -->
        </div>

        <!-- Navigation Bar -->
        <div id="nav-bar" class="absolute bottom-0 w-full h-12 flex justify-around items-center z-40 text-white/80 bg-black/20 backdrop-blur-sm">
            <div class="w-12 h-12 flex items-center justify-center cursor-pointer active:bg-white/20 rounded-full transition" onclick="goBack()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/></svg>
            </div>
            <div class="w-12 h-12 flex items-center justify-center cursor-pointer active:bg-white/20 rounded-full transition" onclick="goHome()">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="6"/></svg>
            </div>
            <div class="w-12 h-12 flex items-center justify-center cursor-pointer active:bg-white/20 rounded-full transition" onclick="goHome()">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
            </div>
        </div>

        <!-- Gesture overlay for Status Bar swipe down -->
        <div id="status-bar-touch-zone" class="absolute top-0 w-full h-10 z-50 cursor-ns-resize"></div>
    </div>

    <script>
        // --- State Management ---
        let state = {
            locked: true,
            drawerOpen: false,
            notificationsOpen: false,
            currentApp: null,
            settings: { wifi: true, bluetooth: true, darkmode: false, airplane: false },
            notes: [],
            photos: [],
            messages: [
                { id: 1, name: 'Mom', preview: 'Call me back!', history: [{sender:'them', text:'Are you there?'}, {sender:'them', text:'Call me back!'}] },
                { id: 2, name: 'Google', preview: 'Your security code is 849204', history: [{sender:'them', text:'Your security code is 849204'}] }
            ],
            emails: [
                { sender: 'Gemini', subject: 'Welcome to your new OS', body: 'Hello! Every app in this simulated OS is fully functional. Enjoy exploring the Camera, Maps, and Browser!', time: '12:00 PM', read: false },
                { sender: 'GitHub', subject: 'Deploy successful', body: 'Your latest commit has been successfully deployed to production.', time: '10:30 AM', read: true }
            ]
        };

        // --- App Definitions ---
        const appsData = [
            { id: 'calculator', name: 'Calculator', color: 'bg-green-600', icon: '<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>' },
            { id: 'clock', name: 'Clock', color: 'bg-indigo-500', icon: '<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' },
            { id: 'notes', name: 'Notes', color: 'bg-yellow-500', icon: '<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>' },
            { id: 'settings', name: 'Settings', color: 'bg-gray-600', icon: '<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>' },
            { id: 'calendar', name: 'Calendar', color: 'bg-blue-400', icon: '<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>' },
            { id: 'photos', name: 'Photos', color: 'bg-purple-500', icon: '<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>' },
            { id: 'maps', name: 'Maps', color: 'bg-green-400', icon: '<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path></svg>' },
            { id: 'mail', name: 'Mail', color: 'bg-red-400', icon: '<svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>' }
        ];

        // --- Init & UI Setup ---
        const drawerGrid = document.getElementById('drawer-grid');
        appsData.forEach(app => {
            drawerGrid.innerHTML += `
                <div class="app-icon-btn" onclick="openApp('${app.id}')">
                    <div class="app-icon ${app.color}">${app.icon}</div>
                    <span class="app-label mt-1 text-white">${app.name}</span>
                </div>
            `;
        });

        // --- Gesture Handling ---
        let startY = 0;
        const lockScreen = document.getElementById('lock-screen');
        const statusBarZone = document.getElementById('status-bar-touch-zone');
        
        lockScreen.addEventListener('mousedown', e => startY = e.clientY);
        lockScreen.addEventListener('mouseup', e => { if (startY - e.clientY > 50) unlockDevice(); });
        lockScreen.addEventListener('touchstart', e => startY = e.touches[0].clientY);
        lockScreen.addEventListener('touchend', e => { if (startY - e.changedTouches[0].clientY > 50) unlockDevice(); });

        statusBarZone.addEventListener('mousedown', e => startY = e.clientY);
        statusBarZone.addEventListener('mouseup', e => { if (e.clientY - startY > 30) openNotifications(); });
        statusBarZone.addEventListener('touchstart', e => startY = e.touches[0].clientY);
        statusBarZone.addEventListener('touchend', e => { if (e.changedTouches[0].clientY - startY > 30) openNotifications(); });

        function unlockDevice() {
            state.locked = false;
            lockScreen.style.transform = 'translateY(-100%)';
            setTimeout(() => lockScreen.style.display = 'none', 500);
        }

        function toggleDrawer() {
            if (state.locked || state.currentApp || state.notificationsOpen) return;
            state.drawerOpen = !state.drawerOpen;
            document.getElementById('app-drawer').style.transform = state.drawerOpen ? 'translateY(0)' : 'translateY(100%)';
        }

        function openNotifications() {
            if (state.locked) return;
            state.notificationsOpen = true;
            document.getElementById('notifications-panel').style.transform = 'translateY(0)';
            document.getElementById('status-bar').style.color = '#fff';
        }

        function closeNotifications() {
            state.notificationsOpen = false;
            document.getElementById('notifications-panel').style.transform = 'translateY(-100%)';
            updateStatusBarColor();
        }

        function goHome() {
            if (state.locked) return;
            closeNotifications();
            if (state.currentApp) {
                closeApp();
            } else if (state.drawerOpen) {
                toggleDrawer();
            }
        }

        function goBack() {
            if (state.notificationsOpen) {
                closeNotifications();
                return;
            }
            // App specific back handling
            if (state.currentApp === 'messages' && currentChatId) {
                closeChat();
                return;
            }
            if (state.currentApp === 'mail' && currentEmailIndex !== -1) {
                closeEmail();
                return;
            }
            if (state.currentApp === 'notes' && document.getElementById('note-editor').style.transform === 'translateY(0px)') {
                closeNoteEditor();
                return;
            }

            if (state.currentApp) {
                closeApp();
            } else if (state.drawerOpen) {
                toggleDrawer();
            }
        }

        function updateStatusBarColor() {
            const statusBar = document.getElementById('status-bar');
            if (state.currentApp && !state.settings.darkmode && !['camera', 'photos'].includes(state.currentApp)) {
                statusBar.classList.remove('text-white');
                statusBar.classList.add('text-black');
            } else {
                statusBar.classList.remove('text-black');
                statusBar.classList.add('text-white');
            }
        }

        // --- App Engine ---
        function openApp(appId) {
            if(state.locked) return;
            
            const appContainer = document.getElementById('app-container');
            let appContent = '';
            let appInit = null;

            switch(appId) {
                case 'calculator': appContent = getCalculatorHTML(); appInit = initCalculator; break;
                case 'clock': appContent = getClockHTML(); appInit = initClockApp; break;
                case 'settings': appContent = getSettingsHTML(); break;
                case 'notes': appContent = getNotesHTML(); appInit = initNotes; break;
                case 'phone': appContent = getPhoneHTML(); break;
                case 'messages': appContent = getMessagesHTML(); appInit = initMessages; break;
                case 'browser': appContent = getBrowserHTML(); break;
                case 'camera': appContent = getCameraHTML(); appInit = initCamera; break;
                case 'calendar': appContent = getCalendarHTML(); appInit = initCalendar; break;
                case 'photos': appContent = getPhotosHTML(); appInit = initPhotos; break;
                case 'maps': appContent = getMapsHTML(); break;
                case 'mail': appContent = getMailHTML(); appInit = initMail; break;
            }

            appContainer.innerHTML = appContent;
            appContainer.classList.remove('hidden', 'animate-app-close');
            appContainer.classList.add('animate-app-open');
            
            state.currentApp = appId;
            if(state.drawerOpen) toggleDrawer();
            
            updateStatusBarColor();
            if(appInit) setTimeout(appInit, 50);
        }

        function closeApp() {
            const appContainer = document.getElementById('app-container');
            appContainer.classList.remove('animate-app-open');
            appContainer.classList.add('animate-app-close');
            
            // Cleanups
            if (state.currentApp === 'clock') cleanupClock();
            if (state.currentApp === 'camera') cleanupCamera();

            setTimeout(() => {
                appContainer.classList.add('hidden');
                appContainer.innerHTML = '';
                state.currentApp = null;
                updateStatusBarColor();
            }, 250);
        }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-full text-sm z-[9999] transition-opacity duration-300 shadow-lg whitespace-nowrap';
            toast.textContent = msg;
            document.getElementById('device').appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 2000);
        }

        // --- System Settings Logic ---
        function toggleSetting(setting) {
            state.settings[setting] = !state.settings[setting];
            const btn = document.getElementById(`qt-${setting.substring(0,3)}`) || document.getElementById('qt-dark');
            
            if (state.settings[setting]) {
                btn.classList.replace('bg-white/20', 'bg-blue-500');
            } else {
                btn.classList.replace('bg-blue-500', 'bg-white/20');
            }

            if (setting === 'wifi') {
                document.getElementById('status-wifi').style.opacity = state.settings.wifi ? '1' : '0.3';
            }
            if (setting === 'darkmode') {
                const device = document.getElementById('device');
                if(state.settings.darkmode) device.classList.add('dark-mode');
                else device.classList.remove('dark-mode');
                updateStatusBarColor();
                if(state.currentApp === 'settings') openApp('settings');
            }
            if (setting === 'airplane') {
                state.settings.wifi = !state.settings.airplane;
                document.getElementById('status-wifi').style.opacity = state.settings.wifi ? '1' : '0.3';
                document.getElementById('qt-wif').classList.replace(state.settings.wifi ? 'bg-white/20' : 'bg-blue-500', state.settings.wifi ? 'bg-blue-500' : 'bg-white/20');
            }
        }

        // --- Time Management ---
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const dateStr = now.toLocaleDateString([], { weekday: 'short', month: 'short', day: 'numeric' });
            
            document.getElementById('status-time').textContent = timeStr;
            document.getElementById('lock-time').textContent = timeStr;
            document.getElementById('widget-time').textContent = timeStr;
            document.getElementById('lock-date').textContent = dateStr;
            document.getElementById('widget-date').textContent = dateStr;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // ==========================================
        // APP IMPLEMENTATIONS
        // ==========================================

        // --- 1. Calculator ---
        function getCalculatorHTML() {
            return `
                <div class="flex-grow flex flex-col h-full bg-inherit">
                    <div class="flex-grow flex flex-col justify-end p-6 text-right">
                        <div id="calc-history" class="text-xl opacity-60 min-h-[1.75rem] mb-2 truncate"></div>
                        <div id="calc-display" class="text-6xl font-light truncate">0</div>
                    </div>
                    <div class="grid grid-cols-4 gap-3 p-4 bg-black/5 dark:bg-white/5 rounded-t-3xl pb-16">
                        ${['C', '(', ')', '/', '7', '8', '9', '*', '4', '5', '6', '-', '1', '2', '3', '+', '0', '.', '⌫', '='].map(btn => {
                            let colorClass = "bg-white dark:bg-gray-800 text-inherit";
                            if(['C','(',')','/','*','-','+','='].includes(btn)) colorClass = "bg-gray-200 dark:bg-gray-700 text-primary-color font-medium";
                            if(btn === '=') colorClass = "bg-blue-500 text-white font-bold";
                            return `<button onclick="calcPress('${btn}')" class="h-16 rounded-full text-2xl flex items-center justify-center active:scale-95 transition-transform ${colorClass} shadow-sm">${btn}</button>`;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        let calcExpr = '';
        function initCalculator() { calcExpr = ''; }
        function calcPress(val) {
            const display = document.getElementById('calc-display');
            const history = document.getElementById('calc-history');
            
            if (val === 'C') { calcExpr = ''; display.textContent = '0'; history.textContent = ''; return; }
            if (val === '⌫') { calcExpr = calcExpr.slice(0, -1); display.textContent = calcExpr || '0'; return; }
            if (val === '=') {
                try {
                    let safeExpr = calcExpr.replace(/[^0-9\+\-\*\/\.\(\)]/g, '');
                    let result = new Function('return ' + safeExpr)();
                    result = Math.round(result * 100000000) / 100000000;
                    history.textContent = calcExpr + ' =';
                    display.textContent = result;
                    calcExpr = result.toString();
                } catch(e) { display.textContent = 'Error'; calcExpr = ''; }
                return;
            }
            if(calcExpr === '0' && val !== '.') calcExpr = '';
            calcExpr += val;
            display.textContent = calcExpr;
        }

        // --- 2. Clock App ---
        let stopwatchInterval; let stopwatchTime = 0;
        function getClockHTML() {
            return `
                <div class="flex-grow flex flex-col h-full bg-inherit">
                    <div class="flex justify-around p-4 border-b border-theme">
                        <button class="font-medium text-blue-500 border-b-2 border-blue-500 pb-1">Clock</button>
                        <button class="font-medium opacity-60 pb-1" onclick="document.getElementById('clock-view').classList.add('hidden'); document.getElementById('stopwatch-view').classList.remove('hidden'); this.classList.add('text-blue-500', 'border-b-2', 'border-blue-500', 'opacity-100'); this.previousElementSibling.classList.remove('text-blue-500', 'border-b-2', 'border-blue-500'); this.previousElementSibling.classList.add('opacity-60')">Stopwatch</button>
                    </div>
                    <div id="clock-view" class="flex-grow flex flex-col items-center justify-center relative">
                        <div class="w-64 h-64 rounded-full border-8 border-theme shadow-xl relative flex items-center justify-center bg-white dark:bg-gray-900">
                            <div id="hand-h" class="absolute w-1.5 h-16 bg-black dark:bg-white rounded-full origin-bottom" style="bottom: 50%;"></div>
                            <div id="hand-m" class="absolute w-1 h-24 bg-gray-500 rounded-full origin-bottom" style="bottom: 50%;"></div>
                            <div id="hand-s" class="absolute w-0.5 h-28 bg-red-500 rounded-full origin-bottom" style="bottom: 50%;"></div>
                            <div class="w-3 h-3 bg-red-500 rounded-full z-10"></div>
                        </div>
                        <div class="mt-10 text-4xl font-light" id="app-clock-time">12:00:00</div>
                    </div>
                    <div id="stopwatch-view" class="flex-grow flex flex-col items-center justify-center hidden">
                        <div id="sw-display" class="text-6xl font-light font-mono mb-12">00:00.00</div>
                        <div class="flex gap-6">
                            <button onclick="resetStopwatch()" class="w-16 h-16 rounded-full bg-theme-muted flex items-center justify-center shadow-md active:scale-95 transition-transform"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button>
                            <button id="sw-btn" onclick="toggleStopwatch()" class="w-16 h-16 rounded-full bg-blue-500 text-white flex items-center justify-center shadow-md active:scale-95 transition-transform"><svg class="w-8 h-8 ml-1" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button>
                        </div>
                    </div>
                </div>
            `;
        }
        function initClockApp() {
            function updateAppClock() {
                if(state.currentApp !== 'clock') return;
                const d = new Date();
                document.getElementById('hand-h').style.transform = `rotate(${d.getHours()*30 + d.getMinutes()/2}deg)`;
                document.getElementById('hand-m').style.transform = `rotate(${d.getMinutes()*6}deg)`;
                document.getElementById('hand-s').style.transform = `rotate(${d.getSeconds()*6}deg)`;
                document.getElementById('app-clock-time').textContent = d.toLocaleTimeString([], { hour12: false });
                requestAnimationFrame(updateAppClock);
            }
            updateAppClock();
        }
        function toggleStopwatch() {
            const btn = document.getElementById('sw-btn');
            if (stopwatchInterval) {
                clearInterval(stopwatchInterval); stopwatchInterval = null;
                btn.innerHTML = '<svg class="w-8 h-8 ml-1" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
                btn.classList.replace('bg-red-500', 'bg-blue-500');
            } else {
                let start = Date.now() - stopwatchTime;
                stopwatchInterval = setInterval(() => {
                    stopwatchTime = Date.now() - start;
                    let ms = Math.floor((stopwatchTime % 1000) / 10);
                    let s = Math.floor((stopwatchTime / 1000) % 60);
                    let m = Math.floor((stopwatchTime / 60000));
                    document.getElementById('sw-display').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}.${ms.toString().padStart(2,'0')}`;
                }, 10);
                btn.innerHTML = '<svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
                btn.classList.replace('bg-blue-500', 'bg-red-500');
            }
        }
        function resetStopwatch() { if (stopwatchInterval) toggleStopwatch(); stopwatchTime = 0; document.getElementById('sw-display').textContent = '00:00.00'; }
        function cleanupClock() { if (stopwatchInterval) clearInterval(stopwatchInterval); }

        // --- 3. Settings ---
        function getSettingsHTML() {
            const isDark = state.settings.darkmode;
            const isWifi = state.settings.wifi;
            return `
                <div class="flex-grow flex flex-col h-full bg-inherit overflow-y-auto pb-16">
                    <h1 class="text-3xl font-normal px-6 pt-4 pb-6">Settings</h1>
                    <div class="space-y-1">
                        <div class="px-6 py-4 flex items-center justify-between active:bg-black/5 dark:active:bg-white/5 cursor-pointer" onclick="toggleSetting('wifi'); openApp('settings')">
                            <div class="flex items-center gap-4">
                                <div class="w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-500 flex items-center justify-center"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3C7.8 3 3.9 4.8 1 7.8L12 21 23 7.8C20.1 4.8 16.2 3 12 3zm0 14l-6.4-7.5C7.2 8.3 9.5 7.5 12 7.5s4.8.8 6.4 2L12 17z"/></svg></div>
                                <div><div class="text-lg">Wi-Fi</div><div class="text-sm opacity-60">${isWifi ? 'Connected to Network' : 'Off'}</div></div>
                            </div>
                            <div class="w-10 h-5 rounded-full relative transition-colors ${isWifi ? 'bg-blue-500' : 'bg-gray-300 dark:bg-gray-600'}">
                                <div class="w-4 h-4 bg-white rounded-full absolute top-0.5 transition-all ${isWifi ? 'left-5' : 'left-0.5'}"></div>
                            </div>
                        </div>
                        <div class="px-6 py-4 flex items-center justify-between active:bg-black/5 dark:active:bg-white/5 cursor-pointer" onclick="toggleSetting('darkmode');">
                            <div class="flex items-center gap-4">
                                <div class="w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900 text-purple-500 flex items-center justify-center"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg></div>
                                <div><div class="text-lg">Dark Theme</div><div class="text-sm opacity-60">System wide</div></div>
                            </div>
                            <div class="w-10 h-5 rounded-full relative transition-colors ${isDark ? 'bg-blue-500' : 'bg-gray-300 dark:bg-gray-600'}">
                                <div class="w-4 h-4 bg-white rounded-full absolute top-0.5 transition-all ${isDark ? 'left-5' : 'left-0.5'}"></div>
                            </div>
                        </div>
                        <div class="px-6 py-4 flex items-center justify-between active:bg-black/5 dark:active:bg-white/5 cursor-pointer" onclick="showToast('Storage: 32GB / 128GB Used')">
                            <div class="flex items-center gap-4">
                                <div class="w-8 h-8 rounded-full bg-green-100 dark:bg-green-900 text-green-500 flex items-center justify-center"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"/></svg></div>
                                <div><div class="text-lg">Storage</div><div class="text-sm opacity-60">25% used</div></div>
                            </div>
                        </div>
                        <div class="px-6 py-4 flex items-center justify-between active:bg-black/5 dark:active:bg-white/5 cursor-pointer" onclick="showToast('Android Web Clone v2.0')">
                            <div class="flex items-center gap-4">
                                <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 flex items-center justify-center"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/></svg></div>
                                <div><div class="text-lg">About Phone</div><div class="text-sm opacity-60">Fake Pixel Device</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- 4. Notes ---
        let editingNoteIndex = -1;
        function getNotesHTML() {
            return `
                <div class="flex-grow flex flex-col h-full bg-inherit relative">
                    <div class="px-6 py-4 flex justify-between items-center z-10 border-b border-theme">
                        <h1 class="text-2xl font-medium">Notes</h1>
                        <button onclick="newNote()" class="text-yellow-500"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button>
                    </div>
                    <div id="notes-list" class="flex-grow overflow-y-auto p-4 space-y-3 pb-16"></div>
                    <div id="note-editor" class="absolute inset-0 bg-inherit z-20 transform translate-y-full transition-transform flex flex-col">
                        <div class="px-4 py-3 flex justify-between items-center border-b border-theme">
                            <button onclick="closeNoteEditor()" class="p-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></button>
                            <button onclick="saveNote()" class="text-yellow-500 font-medium p-2">Save</button>
                        </div>
                        <textarea id="note-input" class="flex-grow w-full p-6 bg-transparent outline-none resize-none text-lg" placeholder="Start typing..."></textarea>
                    </div>
                </div>
            `;
        }
        function initNotes() {
            if(state.notes.length === 0) { state.notes = [{ content: 'This is a fully functional mock notes app.\n\nTry creating a new one!' }]; }
            renderNotes();
        }
        function renderNotes() {
            const list = document.getElementById('notes-list');
            if(!list) return;
            if(state.notes.length === 0) { list.innerHTML = '<div class="text-center mt-10 opacity-50">No notes yet</div>'; return; }
            list.innerHTML = state.notes.map((n, i) => `
                <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-2xl cursor-pointer active:scale-95 transition-transform border border-yellow-100 dark:border-yellow-900/50" onclick="editNote(${i})">
                    <h3 class="font-medium truncate">${n.content.split('\n')[0].substring(0, 30) || 'Empty Note'}</h3>
                    <p class="text-sm opacity-60 mt-1 truncate">${n.content.substring(0, 50)}</p>
                </div>
            `).join('');
        }
        function newNote() {
            editingNoteIndex = -1;
            document.getElementById('note-input').value = '';
            document.getElementById('note-editor').style.transform = 'translateY(0)';
            document.getElementById('note-input').focus();
        }
        function editNote(index) {
            editingNoteIndex = index;
            document.getElementById('note-input').value = state.notes[index].content;
            document.getElementById('note-editor').style.transform = 'translateY(0)';
        }
        function closeNoteEditor() { document.getElementById('note-editor').style.transform = 'translateY(100%)'; }
        function saveNote() {
            const val = document.getElementById('note-input').value.trim();
            if(val) {
                if(editingNoteIndex >= 0) state.notes[editingNoteIndex].content = val;
                else state.notes.unshift({ content: val });
            } else if (editingNoteIndex >= 0) { state.notes.splice(editingNoteIndex, 1); }
            renderNotes(); closeNoteEditor();
        }

        // --- 5. Phone ---
        let dialedNumber = '';
        function getPhoneHTML() {
            dialedNumber = '';
            return `
                <div class="flex-grow flex flex-col h-full bg-inherit relative">
                    <div id="calling-screen" class="absolute inset-0 z-30 bg-blue-600 text-white flex flex-col items-center justify-center transform translate-y-full transition-transform">
                        <div class="text-xl mb-2 opacity-80">Calling...</div>
                        <div id="calling-number" class="text-3xl font-light mb-12"></div>
                        <div class="w-24 h-24 rounded-full bg-white/20 flex items-center justify-center mb-16 animate-pulse"><svg class="w-12 h-12" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>
                        <button onclick="endCall()" class="w-16 h-16 rounded-full bg-red-500 flex items-center justify-center shadow-lg active:scale-95 transition-transform"><svg class="w-8 h-8 transform rotate-[135deg]" fill="currentColor" viewBox="0 0 24 24"><path d="M20 15.5c-1.2 0-2.4-.2-3.6-.6-.3-.1-.7 0-1 .2l-2.2 2.2c-2.8-1.4-5.1-3.8-6.6-6.6l2.2-2.2c.3-.3.4-.7.2-1-.4-1.1-.6-2.3-.6-3.5 0-.6-.4-1-1-1H3c-.6 0-1 .4-1 1 0 9.4 7.6 17 17 17 .6 0 1-.4 1-1v-4.5c0-.6-.4-1-1-1z"/></svg></button>
                    </div>
                    <div class="flex-grow flex flex-col items-center justify-end pb-8">
                        <div id="dial-display" class="text-4xl font-light h-12 mb-6 tracking-widest text-center truncate w-full px-4"></div>
                        <div class="grid grid-cols-3 gap-6 px-10">
                            ${[
                                ['1',''],['2','ABC'],['3','DEF'],
                                ['4','GHI'],['5','JKL'],['6','MNO'],
                                ['7','PQRS'],['8','TUV'],['9','WXYZ'],
                                ['*',''],['0','+'],['#','']
                            ].map(k => `
                                <div class="w-16 h-16 rounded-full bg-theme-muted flex flex-col items-center justify-center active:bg-black/10 dark:active:bg-white/10 cursor-pointer" onclick="pressDial('${k[0]}')">
                                    <div class="text-2xl font-light leading-none">${k[0]}</div>
                                    <div class="text-[9px] font-bold opacity-50 uppercase tracking-widest">${k[1]}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="flex justify-center items-center w-full mt-8 relative">
                            <button onclick="makeCall()" class="w-16 h-16 rounded-full bg-green-500 text-white flex items-center justify-center shadow-lg active:scale-95 transition-transform"><svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M20 15.5c-1.2 0-2.4-.2-3.6-.6-.3-.1-.7 0-1 .2l-2.2 2.2c-2.8-1.4-5.1-3.8-6.6-6.6l2.2-2.2c.3-.3.4-.7.2-1-.4-1.1-.6-2.3-.6-3.5 0-.6-.4-1-1-1H3c-.6 0-1 .4-1 1 0 9.4 7.6 17 17 17 .6 0 1-.4 1-1v-4.5c0-.6-.4-1-1-1z"/></svg></button>
                            <button onclick="backspaceDial()" class="absolute right-12 opacity-50 active:opacity-100 p-2"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M3 12l6.414 6.414a2 2 0 001.414.586H19a2 2 0 002-2V7a2 2 0 00-2-2h-8.172a2 2 0 00-1.414.586L3 12z"></path></svg></button>
                        </div>
                    </div>
                </div>
            `;
        }
        function pressDial(num) { dialedNumber += num; document.getElementById('dial-display').textContent = dialedNumber; }
        function backspaceDial() { dialedNumber = dialedNumber.slice(0,-1); document.getElementById('dial-display').textContent = dialedNumber; }
        function makeCall() {
            if(!dialedNumber) return;
            document.getElementById('calling-number').textContent = dialedNumber;
            document.getElementById('calling-screen').style.transform = 'translateY(0)';
            setTimeout(endCall, 5000); // auto hang up after 5s
        }
        function endCall() {
            document.getElementById('calling-screen').style.transform = 'translateY(100%)';
            dialedNumber = '';
            document.getElementById('dial-display').textContent = '';
        }

        // --- 6. Messages ---
        let currentChatId = null;
        function getMessagesHTML() {
            return `
                <div class="flex-grow flex flex-col h-full bg-inherit relative overflow-hidden">
                    <div class="px-4 py-4 border-b border-theme flex justify-between items-center">
                        <h1 class="text-2xl font-medium">Messages</h1>
                        <button class="w-8 h-8 rounded-full bg-theme-muted flex items-center justify-center"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                    </div>
                    <div id="chat-list" class="flex-grow overflow-y-auto pb-16"></div>

                    <!-- Chat View -->
                    <div id="chat-view" class="absolute inset-0 bg-inherit z-20 flex flex-col transform translate-x-full transition-transform duration-200">
                        <div class="px-2 py-3 border-b border-theme flex items-center gap-2">
                            <button onclick="closeChat()" class="p-2 active:bg-black/5 dark:active:bg-white/5 rounded-full"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></button>
                            <div class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center text-sm font-bold" id="chat-avatar"></div>
                            <h2 class="font-medium text-lg" id="chat-name">Name</h2>
                        </div>
                        <div id="chat-history" class="flex-grow overflow-y-auto p-4 flex flex-col gap-3 pb-20"></div>
                        <div class="absolute bottom-12 w-full p-2 bg-inherit border-t border-theme flex items-center gap-2">
                            <input type="text" id="chat-input" class="flex-grow bg-theme-muted rounded-full px-4 py-2 outline-none text-sm" placeholder="Text message" onkeypress="if(event.key==='Enter') sendMessage()">
                            <button onclick="sendMessage()" class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center shrink-0"><svg class="w-4 h-4 transform rotate-45 -mt-0.5 -ml-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg></button>
                        </div>
                    </div>
                </div>
            `;
        }
        function initMessages() { renderChatList(); }
        function renderChatList() {
            const list = document.getElementById('chat-list');
            if(!list) return;
            list.innerHTML = state.messages.map(c => `
                <div class="px-4 py-4 border-b border-theme flex gap-4 items-center cursor-pointer active:bg-black/5 dark:active:bg-white/5" onclick="openChat(${c.id})">
                    <div class="w-12 h-12 rounded-full bg-blue-500 text-white flex items-center justify-center text-xl font-medium shrink-0">${c.name.charAt(0)}</div>
                    <div class="flex-grow overflow-hidden">
                        <div class="font-medium text-base">${c.name}</div>
                        <div class="text-sm opacity-60 truncate">${c.preview}</div>
                    </div>
                </div>
            `).join('');
        }
        function openChat(id) {
            currentChatId = id;
            const chat = state.messages.find(c => c.id === id);
            document.getElementById('chat-name').textContent = chat.name;
            document.getElementById('chat-avatar').textContent = chat.name.charAt(0);
            renderChatHistory();
            document.getElementById('chat-view').style.transform = 'translateX(0)';
        }
        function closeChat() {
            currentChatId = null;
            document.getElementById('chat-view').style.transform = 'translateX(100%)';
            renderChatList();
        }
        function renderChatHistory() {
            const historyDiv = document.getElementById('chat-history');
            const chat = state.messages.find(c => c.id === currentChatId);
            historyDiv.innerHTML = chat.history.map(m => `
                <div class="max-w-[75%] px-4 py-2 rounded-2xl text-sm ${m.sender==='me' ? 'bg-blue-500 text-white self-end rounded-br-sm' : 'bg-theme-muted self-start rounded-bl-sm'}">
                    ${m.text}
                </div>
            `).join('');
            historyDiv.scrollTop = historyDiv.scrollHeight;
        }
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if(!text || !currentChatId) return;
            
            const chat = state.messages.find(c => c.id === currentChatId);
            chat.history.push({ sender: 'me', text: text });
            chat.preview = "You: " + text;
            input.value = '';
            renderChatHistory();

            // Auto reply
            setTimeout(() => {
                if(currentChatId === chat.id) {
                    const replies = ["That's interesting!", "I'm just a simulated bot.", "Okay, got it.", "Sure thing!"];
                    const reply = replies[Math.floor(Math.random()*replies.length)];
                    chat.history.push({ sender: 'them', text: reply });
                    chat.preview = reply;
                    renderChatHistory();
                }
            }, 1000);
        }

        // --- 7. Browser ---
        function getBrowserHTML() {
            return `
                <div class="flex-grow flex flex-col h-full bg-white text-black">
                    <div class="flex items-center gap-2 p-2 bg-gray-100 border-b border-gray-300">
                        <input type="text" id="browser-url" value="https://en.wikipedia.org" class="flex-grow bg-white rounded-full px-4 py-1.5 text-sm border border-gray-300 outline-none focus:border-blue-500" onkeypress="if(event.key==='Enter') loadUrl()">
                        <button onclick="loadUrl()" class="p-2"><svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg></button>
                    </div>
                    <div class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 text-center border-b border-yellow-200">Note: Many sites block external embedding.</div>
                    <iframe id="browser-frame" src="https://en.wikipedia.org" class="flex-grow w-full border-none pb-12"></iframe>
                </div>
            `;
        }
        function loadUrl() {
            let url = document.getElementById('browser-url').value;
            if(!url.startsWith('http')) url = 'https://' + url;
            document.getElementById('browser-frame').src = url;
            document.getElementById('browser-url').value = url;
        }

        // --- 8. Camera ---
        let cameraStream = null;
        function getCameraHTML() {
            return `
                <div class="flex-grow flex flex-col h-full bg-black relative">
                    <video id="camera-feed" autoplay playsinline class="absolute inset-0 w-full h-full object-cover"></video>
                    <div id="camera-flash" class="absolute inset-0 bg-white opacity-0 pointer-events-none transition-opacity duration-100"></div>
                    
                    <div class="absolute top-4 left-0 right-0 flex justify-between px-6 z-10 text-white">
                        <button class="p-2"><svg class="w-6 h-6 drop-shadow-md" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></button>
                        <button class="p-2" onclick="showToast('Settings not available')"><svg class="w-6 h-6 drop-shadow-md" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg></button>
                    </div>

                    <div class="absolute bottom-12 left-0 right-0 flex justify-around items-center z-10 pb-4">
                        <div class="w-12 h-12 rounded-full overflow-hidden border-2 border-white/50 cursor-pointer" onclick="openApp('photos')" id="camera-preview">
                            <div class="w-full h-full bg-gray-800"></div>
                        </div>
                        <button onclick="takePhoto()" class="w-20 h-20 rounded-full border-4 border-white p-1 active:scale-95 transition-transform"><div class="w-full h-full bg-white rounded-full"></div></button>
                        <button class="p-3 text-white" onclick="showToast('Switch camera not implemented')"><svg class="w-8 h-8 drop-shadow-md" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button>
                    </div>
                    <canvas id="camera-canvas" class="hidden"></canvas>
                </div>
            `;
        }
        async function initCamera() {
            updateCameraPreview();
            const video = document.getElementById('camera-feed');
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                video.srcObject = cameraStream;
            } catch (err) {
                showToast("Camera access denied or unavailable.");
                video.parentElement.style.backgroundColor = '#333';
            }
            document.getElementById('status-bar').classList.add('text-white');
            document.getElementById('status-bar').classList.remove('text-black');
        }
        function takePhoto() {
            const video = document.getElementById('camera-feed');
            if(!cameraStream) { showToast("No camera feed"); return; }
            
            // Flash effect
            const flash = document.getElementById('camera-flash');
            flash.style.opacity = '1';
            setTimeout(() => flash.style.opacity = '0', 100);

            // Capture
            const canvas = document.getElementById('camera-canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            const dataUrl = canvas.toDataURL('image/jpeg');
            
            state.photos.unshift(dataUrl);
            updateCameraPreview();
        }
        function updateCameraPreview() {
            const p = document.getElementById('camera-preview');
            if(p && state.photos.length > 0) {
                p.innerHTML = `<img src="${state.photos[0]}" class="w-full h-full object-cover">`;
            }
        }
        function cleanupCamera() {
            if(cameraStream) { cameraStream.getTracks().forEach(t => t.stop()); cameraStream = null; }
        }

        // --- 9. Photos ---
        function getPhotosHTML() {
            return `
                <div class="flex-grow flex flex-col h-full bg-inherit">
                    <div class="px-4 py-3 border-b border-theme flex justify-between items-center">
                        <h1 class="text-xl font-medium">Photos</h1>
                    </div>
                    <div id="photos-grid" class="flex-grow overflow-y-auto grid grid-cols-3 gap-1 p-1 pb-16 align-content-start">
                        <!-- Injected -->
                    </div>
                </div>
            `;
        }
        function initPhotos() {
            const grid = document.getElementById('photos-grid');
            if(state.photos.length === 0) {
                grid.innerHTML = `<div class="col-span-3 text-center mt-10 opacity-50 text-sm">No photos yet.<br>Take some with the Camera app!</div>`;
                return;
            }
            grid.innerHTML = state.photos.map(url => `
                <div class="aspect-square bg-theme-muted relative">
                    <img src="${url}" class="w-full h-full object-cover absolute inset-0">
                </div>
            `).join('');
        }

        // --- 10. Calendar ---
        function getCalendarHTML() {
            return `
                <div class="flex-grow flex flex-col h-full bg-inherit">
                    <div class="px-4 py-3 flex justify-between items-center">
                        <h1 class="text-xl font-medium" id="cal-month-year">Month Year</h1>
                        <div class="flex gap-2">
                            <button class="p-2" onclick="changeMonth(-1)"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                            <button class="p-2" onclick="changeMonth(1)"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
                        </div>
                    </div>
                    <div class="grid grid-cols-7 text-center text-xs opacity-60 font-medium py-2">
                        <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
                    </div>
                    <div id="cal-grid" class="grid grid-cols-7 text-center gap-y-4 px-2"></div>
                </div>
            `;
        }
        let calDate = new Date();
        function initCalendar() { renderCalendar(); }
        function renderCalendar() {
            const grid = document.getElementById('cal-grid');
            if(!grid) return;
            grid.innerHTML = '';
            
            const monthYear = document.getElementById('cal-month-year');
            monthYear.textContent = calDate.toLocaleDateString([], { month: 'long', year: 'numeric' });

            const firstDay = new Date(calDate.getFullYear(), calDate.getMonth(), 1).getDay();
            const daysInMonth = new Date(calDate.getFullYear(), calDate.getMonth() + 1, 0).getDate();
            const today = new Date();

            for(let i = 0; i < firstDay; i++) { grid.innerHTML += `<div></div>`; }
            
            for(let d = 1; d <= daysInMonth; d++) {
                let isToday = (d === today.getDate() && calDate.getMonth() === today.getMonth() && calDate.getFullYear() === today.getFullYear());
                let cls = isToday ? "w-8 h-8 mx-auto bg-blue-500 text-white rounded-full flex items-center justify-center font-bold" : "w-8 h-8 mx-auto flex items-center justify-center";
                grid.innerHTML += `<div><div class="${cls}">${d}</div></div>`;
            }
        }
        function changeMonth(dir) {
            calDate.setMonth(calDate.getMonth() + dir);
            renderCalendar();
        }

        // --- 11. Maps ---
        function getMapsHTML() {
            return `
                <div class="flex-grow flex flex-col h-full bg-white relative">
                    <div class="absolute top-4 left-4 right-4 z-10 glass-panel rounded-full px-4 py-3 flex items-center shadow-lg bg-white/90 text-black">
                        <svg class="w-5 h-5 mr-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        <input type="text" placeholder="Search here" class="bg-transparent outline-none flex-grow text-sm">
                    </div>
                    <iframe width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=-0.14%2C51.5%2C-0.12%2C51.51&amp;layer=mapnik" class="pb-12" style="filter: ${state.settings.darkmode ? 'invert(90%) hue-rotate(180deg)' : 'none'}"></iframe>
                </div>
            `;
        }

        // --- 12. Mail ---
        let currentEmailIndex = -1;
        function getMailHTML() {
            return `
                <div class="flex-grow flex flex-col h-full bg-inherit relative overflow-hidden">
                    <div class="px-4 py-4 border-b border-theme flex justify-between items-center">
                        <h1 class="text-2xl font-medium">Inbox</h1>
                        <button class="w-8 h-8 rounded-full bg-theme-muted flex items-center justify-center"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                    </div>
                    <div id="mail-list" class="flex-grow overflow-y-auto pb-16"></div>

                    <div id="mail-view" class="absolute inset-0 bg-inherit z-20 flex flex-col transform translate-x-full transition-transform duration-200">
                        <div class="px-2 py-3 border-b border-theme flex items-center gap-2">
                            <button onclick="closeEmail()" class="p-2 active:bg-black/5 dark:active:bg-white/5 rounded-full"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></button>
                            <div class="flex-grow flex justify-end gap-2 pr-2">
                                <button class="p-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                            </div>
                        </div>
                        <div class="p-5 flex-grow overflow-y-auto pb-20">
                            <h2 class="text-2xl font-medium mb-4" id="mail-subject">Subject</h2>
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-10 h-10 rounded-full bg-red-500 text-white flex items-center justify-center font-bold" id="mail-avatar"></div>
                                <div>
                                    <div class="font-medium text-sm" id="mail-sender">Sender</div>
                                    <div class="text-xs opacity-60" id="mail-time">Time</div>
                                </div>
                            </div>
                            <div class="text-sm leading-relaxed whitespace-pre-wrap opacity-90" id="mail-body">Body</div>
                        </div>
                    </div>
                </div>
            `;
        }
        function initMail() { renderMailList(); }
        function renderMailList() {
            const list = document.getElementById('mail-list');
            if(!list) return;
            list.innerHTML = state.emails.map((e, i) => `
                <div class="px-4 py-4 border-b border-theme flex gap-4 cursor-pointer active:bg-black/5 dark:active:bg-white/5" onclick="openEmail(${i})">
                    <div class="w-10 h-10 rounded-full bg-red-400 text-white flex items-center justify-center font-bold shrink-0">${e.sender.charAt(0)}</div>
                    <div class="flex-grow overflow-hidden">
                        <div class="flex justify-between items-baseline mb-0.5">
                            <div class="font-medium text-base ${!e.read ? 'text-blue-500 font-bold' : ''}">${e.sender}</div>
                            <div class="text-xs opacity-60">${e.time}</div>
                        </div>
                        <div class="text-sm font-medium truncate ${!e.read ? '' : 'opacity-80'}">${e.subject}</div>
                        <div class="text-sm opacity-60 truncate">${e.body}</div>
                    </div>
                </div>
            `).join('');
        }
        function openEmail(idx) {
            currentEmailIndex = idx;
            const email = state.emails[idx];
            email.read = true;
            document.getElementById('mail-subject').textContent = email.subject;
            document.getElementById('mail-sender').textContent = email.sender;
            document.getElementById('mail-avatar').textContent = email.sender.charAt(0);
            document.getElementById('mail-time').textContent = email.time;
            document.getElementById('mail-body').textContent = email.body;
            document.getElementById('mail-view').style.transform = 'translateX(0)';
        }
        function closeEmail() {
            currentEmailIndex = -1;
            document.getElementById('mail-view').style.transform = 'translateX(100%)';
            renderMailList();
        }

    </script>
</body>
</html>
